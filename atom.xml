<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Programming Design Notes]]></title>
  <link href="http://pro.ctlok.com/atom.xml" rel="self"/>
  <link href="http://pro.ctlok.com/"/>
  <updated>2012-04-12T14:23:10+08:00</updated>
  <id>http://pro.ctlok.com/</id>
  <author>
    <name><![CDATA[Lawrence Cheung]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Design Pattern - Decorator]]></title>
    <link href="http://pro.ctlok.com/blog/2012/04/11/design-pattern-decorator.html"/>
    <updated>2012-04-11T15:29:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/04/11/design-pattern-decorator</id>
    <content type="html"><![CDATA[<p>Decorator Pattern 可以令到不用改動原本物件的程式碼，而又可以擴充一些功能在這個物件上，
就好像 Plugin 一樣。你可以想像一下，WordPress 的 Plugin 並不需要改動核心的程式，
但又可以増加一些功能。
Java 上的 InputStream 一樣採用這種模式去實現。</p>

<p>看看以下例子應該有助你明白這個模式:</p>

<!--more-->


<hr />

<p>公司要你開發一個手機用戶計費系統，因應用戶使用時間而去收費，
使用時間愈多折扣亦愈多。而用戶亦有分普通用戶或 VIP 用戶，
VIP 用戶亦有更多折扣。</p>

<p>一開始你可能會設計成這樣:</p>

<figure class='code'><figcaption><span> (User.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample1/User.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">vip</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">vip</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">();</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">vip</span> <span class="o">=</span> <span class="n">vip</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isVip</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">vip</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setVip</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">vip</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">vip</span> <span class="o">=</span> <span class="n">vip</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (MobilePayment.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample1/MobilePayment.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobilePayment</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">final</span> <span class="kt">double</span> <span class="n">moneyPerMinute</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MobilePayment</span><span class="o">(</span><span class="kt">double</span> <span class="n">moneyPerMinute</span><span class="o">){</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">moneyPerMinute</span> <span class="o">=</span> <span class="n">moneyPerMinute</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">charge</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="kt">int</span> <span class="n">minute</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">double</span> <span class="n">fee</span> <span class="o">=</span> <span class="n">minute</span> <span class="o">*</span> <span class="n">moneyPerMinute</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">fee</span> <span class="o">*=</span> <span class="mf">0.8</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">7000</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">fee</span> <span class="o">*=</span> <span class="mf">0.85</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">4000</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">fee</span> <span class="o">*=</span> <span class="mf">0.9</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">2000</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">fee</span> <span class="o">*=</span> <span class="mf">0.95</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">isVip</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">fee</span> <span class="o">*=</span> <span class="mf">0.9</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">fee</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Main.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample1/Main.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// $1.2 per minute</span>
</span><span class='line'>        <span class="n">MobilePayment</span> <span class="n">mobilePayment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MobilePayment</span><span class="o">(</span><span class="mf">1.2</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">User</span> <span class="n">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&quot;Lawrence&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'>        <span class="n">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&quot;Tony&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user1</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; usage: 10000 minute, charge: &quot;</span>
</span><span class='line'>                <span class="o">+</span> <span class="n">mobilePayment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user1</span><span class="o">,</span> <span class="mi">10000</span><span class="o">));</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; usage: 4000 minute, charge: &quot;</span>
</span><span class='line'>                <span class="o">+</span> <span class="n">mobilePayment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user2</span><span class="o">,</span> <span class="mi">4000</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>執行結果</span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='text'><span class='line'>Lawrence usage: 10000 minute, charge: 8640.0
</span><span class='line'>Tony usage: 4000 minute, charge: 4320.0
</span></code></pre></td></tr></table></div></figure>


<p>你可以看見所有計費的程式碼也在 <code>MobilePayment.charge</code> 內，如果再要增加計費條件
就要修改這個地方的程式碼。</p>

<hr />

<p>現在公司又要增加一些收費條件，因為提供額外的服務給公司客戶，需要收取額外 10% 服務費。
如果你只改動 <code>MobilePayment.charge</code> 內的程式碼，那愈來愈多條件時就難以維護，
現在我們使用 Decorator Pattern 去解決這些問題，收費條件亦可以隨時抽換。</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/uml.png"></p>

<figure class='code'><figcaption><span> (User.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/User.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">vip</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">company</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">vip</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">company</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">();</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">vip</span> <span class="o">=</span> <span class="n">vip</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">company</span> <span class="o">=</span> <span class="n">company</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isVip</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">vip</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setVip</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">vip</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">vip</span> <span class="o">=</span> <span class="n">vip</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isCompany</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">company</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCompany</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">company</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">company</span> <span class="o">=</span> <span class="n">company</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Payment.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/Payment.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Payment</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">charge</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="kt">int</span> <span class="n">minute</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (BasicMobilePayment.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/BasicMobilePayment.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicMobilePayment</span> <span class="kd">implements</span> <span class="n">Payment</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">final</span> <span class="kt">double</span> <span class="n">moneyPerMinute</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">BasicMobilePayment</span><span class="o">(</span><span class="kt">double</span> <span class="n">moneyPerMinute</span><span class="o">){</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">moneyPerMinute</span> <span class="o">=</span> <span class="n">moneyPerMinute</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">charge</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="kt">int</span> <span class="n">minute</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">minute</span> <span class="o">*</span> <span class="n">moneyPerMinute</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (AdditionalPayment.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/AdditionalPayment.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AdditionalPayment</span> <span class="kd">implements</span> <span class="n">Payment</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">protected</span> <span class="n">Payment</span> <span class="n">payment</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">AdditionalPayment</span><span class="o">(</span><span class="n">Payment</span> <span class="n">payment</span><span class="o">){</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">payment</span> <span class="o">=</span> <span class="n">payment</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">double</span> <span class="nf">charge</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="kt">int</span> <span class="n">minute</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (UsageAmountPayment.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/UsageAmountPayment.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UsageAmountPayment</span> <span class="kd">extends</span> <span class="n">AdditionalPayment</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">UsageAmountPayment</span><span class="o">(</span><span class="n">Payment</span> <span class="n">payment</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">payment</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">charge</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="kt">int</span> <span class="n">minute</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">7000</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">4000</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.9</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">minute</span> <span class="o">&gt;=</span> <span class="mi">2000</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">)</span> <span class="o">*</span> <span class="mf">0.95</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (VIPPayment.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/VIPPayment.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VIPPayment</span> <span class="kd">extends</span> <span class="n">AdditionalPayment</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">discount</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">VIPPayment</span><span class="o">(</span><span class="n">Payment</span> <span class="n">payment</span><span class="o">,</span> <span class="kt">double</span> <span class="n">discount</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">payment</span><span class="o">);</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">discount</span> <span class="o">=</span> <span class="n">discount</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">charge</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="kt">int</span> <span class="n">minute</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">isVip</span><span class="o">()){</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">)</span> <span class="o">*</span> <span class="n">discount</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (CompanyPayment.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/CompanyPayment.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompanyPayment</span> <span class="kd">extends</span> <span class="n">AdditionalPayment</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">serviceFee</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">CompanyPayment</span><span class="o">(</span><span class="n">Payment</span> <span class="n">payment</span><span class="o">,</span> <span class="kt">double</span> <span class="n">serviceFee</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">payment</span><span class="o">);</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">serviceFee</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">serviceFee</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">charge</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="kt">int</span> <span class="n">minute</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">isCompany</span><span class="o">()){</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">)</span> <span class="o">*</span> <span class="n">serviceFee</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">minute</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Main.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-decorator/sample2/Main.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// $1.2 per minute</span>
</span><span class='line'>        <span class="n">Payment</span> <span class="n">mobilePayment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicMobilePayment</span><span class="o">(</span><span class="mf">1.2</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Payment</span> <span class="n">usageAmountPayment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UsageAmountPayment</span><span class="o">(</span><span class="n">mobilePayment</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Payment</span> <span class="n">vipPayment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VIPPayment</span><span class="o">(</span><span class="n">usageAmountPayment</span><span class="o">,</span> <span class="mf">0.9</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Payment</span> <span class="n">companyPayment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CompanyPayment</span><span class="o">(</span><span class="n">vipPayment</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">companyPayment</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">User</span> <span class="n">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&quot;Lawrence&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span><span class='line'>        <span class="n">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&quot;Tony&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">User</span> <span class="n">user3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">&quot;ABC Company&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user1</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; usage: 10000 minute, charge: &quot;</span>
</span><span class='line'>                <span class="o">+</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user1</span><span class="o">,</span> <span class="mi">10000</span><span class="o">));</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user2</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; usage: 4000 minute, charge: &quot;</span>
</span><span class='line'>                <span class="o">+</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user2</span><span class="o">,</span> <span class="mi">4000</span><span class="o">));</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user3</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; usage: 10000 minute, charge: &quot;</span>
</span><span class='line'>                <span class="o">+</span> <span class="n">payment</span><span class="o">.</span><span class="na">charge</span><span class="o">(</span><span class="n">user3</span><span class="o">,</span> <span class="mi">10000</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>執行結果</span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='text'><span class='line'>Lawrence usage: 10000 minute, charge: 8640.0
</span><span class='line'>Tony usage: 4000 minute, charge: 4320.0
</span><span class='line'>ABC Company usage: 10000 minute, charge: 10560.0
</span></code></pre></td></tr></table></div></figure>


<p>這樣就可以隨時新增條件或移除條件而又不會影響到核心的程式碼。</p>

<hr />

<p>以下的圖片是描述 Singleton Pattern 的 Class Diagram。（From Wiki）</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Decorator_UML_class_diagram.svg/400px-Decorator_UML_class_diagram.svg.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Design Pattern - Singleton]]></title>
    <link href="http://pro.ctlok.com/blog/2012/04/04/design-pattern-singleton.html"/>
    <updated>2012-04-04T10:50:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/04/04/design-pattern-singleton</id>
    <content type="html"><![CDATA[<p>Singleton Pattern 幫助你創造出唯一一個實例，保證任何物件要使用這個物件時，也是使用相同的實例。
那唯一一個實例有什麼用呢? 可減少系統負擔，不用建立多個實例，尤其是建立實例是需要複雜的計算，
在情況許可下使用 Singleton Pattern 是有助提高系統效能。
或在某些情況下例如 Cache 和 Pool 這些要共用物件的設計，大多數是只有一個實例存在於應用程式。</p>

<p>看看以下例子應該有助你明白這個模式：</p>

<!--more-->


<hr />

<p>公司要你開發一個 Cache 服務，以供應用程式其他服務使用。
一開始你可能設計成這樣:</p>

<figure class='code'><figcaption><span> (Cache.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-singleton/sample1/Cache.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cache</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>這個看似沒有什麼問題，但其他物件可以使用 <code>new Cache()</code> 來建立實例，為了解決這個問題，
更改一下 <code>Constructor</code>:</p>

<figure class='code'><figcaption><span> (Cache.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-singleton/sample2/Cache.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cache</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="nf">Cache</span><span class="o">()</span> <span class="o">{}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Constructor 改為 <code>private</code> 就沒有其他物件建立到 Cache 實例，
這樣就可以避免了其他物件可以使用 <code>new Cache()</code> 來建立實例這個問題。</p>

<p>亦可以將 Class 改成 <code>abstract</code> 來解決這個問題。</p>

<figure class='code'><figcaption><span> (Cache.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-singleton/sample3/Cache.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Cache</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>有測試人員測試出建立 <code>java.util.HashMap</code> 是要複雜的計算，又使用了大量的記憶體(假設)，
而 Cache 這個物件又不是必須的，希望你可以改為使用到 Cache 時才建立相對應的物件 (Lazy Initialization)，
以節省記憶體和 CPU 使用量。</p>

<figure class='code'><figcaption><span> (Cache.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-singleton/sample4/Cache.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cache</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="nf">Cache</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Cache</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">InstanceHolder</span><span class="o">.</span><span class="na">instance</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">InstanceHolder</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Cache</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cache</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>你可能會奇怪，在 InstanceHolder 內不是有一句 <code>private static final Cache instance = new Cache();</code> 嗎。
那裡有 Lazy Initialization? 其實在 JVM 載入 Cache.class 時會檢查有那些 static field 需要初始化，
但這個過程並不包括 static class 亦即是 InstanceHolder。InstanceHolder 只會在執行 <code>Cache.getInstance()</code> 時
被 JVM 載入，JVM 載入 InstanceHolder.class 時亦會檢查有那些 static field 需要初始化，
那時就會將 InstanceHolder.instance 初始化。</p>

<p>更詳細說明可以參考 Wiki: <a href="http://en.wikipedia.org/wiki/Initialization-on-demand_holder_idiom">http://en.wikipedia.org/wiki/Initialization-on-demand_holder_idiom</a></p>

<hr />

<p>公司又下了一個要求，在正確環境中會使用到 <code>java.util.TreeMap</code>實現的 Cache，
而在測試環境中使用 <code>java.util.HashMap</code> 就可以了。</p>

<figure class='code'><figcaption><span> (Cache.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-singleton/sample5/Cache.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Cache</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">InstanceHolder</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">private</span> <span class="kd">static</span> <span class="n">Cache</span> <span class="n">instance</span><span class="o">;</span>
</span><span class='line'>        <span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">instance</span> <span class="o">=</span> <span class="o">(</span><span class="n">Cache</span><span class="o">)</span> <span class="n">cacheImplClass</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&quot;getInstance&quot;</span><span class="o">).</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cacheImplClass</span> <span class="o">+</span> <span class="s">&quot;.getInstance throw exception: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Use default cache &quot;</span> <span class="o">+</span> <span class="n">HashMapCache</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>                <span class="n">instance</span> <span class="o">=</span> <span class="n">HashMapCache</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Cache</span><span class="o">&gt;</span> <span class="n">cacheImplClass</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Cache</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">InstanceHolder</span><span class="o">.</span><span class="na">instance</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setCacheImplClass</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Cache</span><span class="o">&gt;</span> <span class="n">cacheImplClass</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">Cache</span><span class="o">.</span><span class="na">cacheImplClass</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
</span><span class='line'>            <span class="n">Cache</span><span class="o">.</span><span class="na">cacheImplClass</span> <span class="o">=</span> <span class="n">cacheImplClass</span><span class="o">;</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>          <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;Cache implementation class already exist&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (HashMapCache.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-singleton/sample5/HashMapCache.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMapCache</span> <span class="kd">extends</span> <span class="n">Cache</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="nf">HashMapCache</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Cache</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">InstanceHolder</span><span class="o">.</span><span class="na">instance</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">InstanceHolder</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Cache</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMapCache</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (TreeMapCache.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-singleton/sample5/TreeMapCache.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.TreeMap</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TreeMapCache</span> <span class="kd">extends</span> <span class="n">Cache</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>    <span class="kd">private</span> <span class="nf">TreeMapCache</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Cache</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">InstanceHolder</span><span class="o">.</span><span class="na">instance</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">InstanceHolder</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Cache</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeMapCache</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Main.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-singleton/sample5/Main.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">Cache</span><span class="o">.</span><span class="na">setCacheImplClass</span><span class="o">(</span><span class="n">TreeMapCache</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>      <span class="n">Cache</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span><span class='line'>      <span class="n">Cache</span> <span class="n">cache2</span> <span class="o">=</span> <span class="n">Cache</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cache</span><span class="o">);</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cache</span> <span class="o">==</span> <span class="n">cache2</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">,</span> <span class="s">&quot;Object&quot;</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cache2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>執行結果</span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='text'><span class='line'>TreeMapCache@4e82701e
</span><span class='line'>true
</span><span class='line'>Object
</span></code></pre></td></tr></table></div></figure>


<p>暫時只想到這個解決方法，如果你有更好的方法請告訴我。</p>

<hr />

<p>以下的圖片是描述 Singleton Pattern 的 Class Diagram。（From Wiki）</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Singleton_UML_class_diagram.svg/250px-Singleton_UML_class_diagram.svg.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Web Development Cheat Sheet]]></title>
    <link href="http://pro.ctlok.com/blog/2012/04/03/web-app-development-cheat-sheet.html"/>
    <updated>2012-04-03T23:06:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/04/03/web-app-development-cheat-sheet</id>
    <content type="html"><![CDATA[<p>在網上收集了一些 Cheat Sheet 是關於開發 Web Application 的，可以幫助你快速查找想要的功能。</p>

<h2>Git</h2>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/git-cheat-sheet.png" width="750" title="" >
from <a href="http://zrusin.blogspot.com/2007/09/git-cheat-sheet.html">http://zrusin.blogspot.com/2007/09/git-cheat-sheet.html</a></p>

<!--more-->


<hr />

<h2>HTML</h2>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/html5-cheat-sheet-tags.png" width="750" title="" >
from <a href="http://www.inmotionhosting.com/infographics/_img/html5_cheat_sheet_tags.png">http://www.inmotionhosting.com/infographics/_img/html5_cheat_sheet_tags.png</a></p>

<h3>HTML5 Web Applications</h3>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/html5-app-browser-cheat-sheet.png" width="750" title="" ></p>

<h3>HTML5 Graphics &amp; Embedded Content</h3>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/html5-support-browser-cheat-sheet.png" width="750" title="" ></p>

<h3>HTML5 Audio Codecs</h3>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/html5-audio-browser-cheat-sheet.png" width="750" title="" ></p>

<h3>HTML5 Video Codecs</h3>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/html5-video-browser-cheat-sheet.png" width="750" title="" ></p>

<h3>HTML5 Forms Inputs</h3>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/html5-form-browser-cheat-sheet.png" width="750" title="" ></p>

<h3>HTML5 Forms Attributes</h3>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/html5-form-attribute-browser-cheat-sheet.png" width="750" title="" >
from <a href="http://www.findmebyip.com/litmus/">http://www.findmebyip.com/litmus/</a></p>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/html-character-entities-cheat-sheet.png" width="750" title="" >
from <a href="http://www.addedbytes.com/download/html-character-entities-cheat-sheet/png">http://www.addedbytes.com/download/html-character-entities-cheat-sheet/png</a></p>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/html/web-safe-fonts-cheat-sheet.png" width="750" title="" >
from <a href="http://static.omglog.com/uploads/2010/06/web-safe-fonts-cheat-sheet-v1.png">http://static.omglog.com/uploads/2010/06/web-safe-fonts-cheat-sheet-v1.png</a></p>

<hr />

<h2>CSS</h2>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/css/css3-cheat-sheet1.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/css/css3-cheat-sheet2.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/css/css3-cheat-sheet3.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/css/css3-cheat-sheet4.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/css/css3-cheat-sheet5.png" width="750" title="" >
from <a href="http://media.smashingmagazine.com/wp-content/uploads/images/css3-cheat-sheet/css3-cheat-sheet.pdf">http://media.smashingmagazine.com/wp-content/uploads/images/css3-cheat-sheet/css3-cheat-sheet.pdf</a></p>

<h3>CSS3 Properties</h3>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/css/css3-properties-browser-cheat-sheet.png" width="750" title="" ></p>

<h3>CSS3 Selectors</h3>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/css/css3-selector-browser-cheat-sheet.png" width="750" title="" >
from <a href="http://www.findmebyip.com/litmus/">http://www.findmebyip.com/litmus/</a></p>

<hr />

<h2>Javascript</h2>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/javascript-cheat-sheet.png" width="750" title="" >
from <a href="http://www.addedbytes.com/cheat-sheets/javascript-cheat-sheet/">http://www.addedbytes.com/cheat-sheets/javascript-cheat-sheet/</a></p>

<hr />

<h2>jQuery</h2>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/jquery/jQuery-17-Visual-Cheat-Sheet1.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/jquery/jQuery-17-Visual-Cheat-Sheet2.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/jquery/jQuery-17-Visual-Cheat-Sheet3.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/jquery/jQuery-17-Visual-Cheat-Sheet4.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/jquery/jQuery-17-Visual-Cheat-Sheet5.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/jquery/jQuery-17-Visual-Cheat-Sheet6.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/jquery/jQuery-17-Visual-Cheat-Sheet7.png" width="750" title="" >
<img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/jquery/jQuery-17-Visual-Cheat-Sheet8.png" width="750" title="" >
from <a href="http://woorkup.com/wp-content/uploads/2011/12/jQuery-17-Visual-Cheat-Sheet1.pdf">http://woorkup.com/wp-content/uploads/2011/12/jQuery-17-Visual-Cheat-Sheet1.pdf</a></p>

<hr />

<h2>Regular Expressions</h2>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/regular-expressions-cheat-sheet.png" width="750" title="" >
from <a href="http://www.addedbytes.com/download/regular-expressions-cheat-sheet-v2/png/">http://www.addedbytes.com/download/regular-expressions-cheat-sheet-v2/png/</a></p>

<hr />

<h2>MySQL</h2>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/mysql-cheat-sheet.png" width="750" title="" >
from <a href="http://www.addedbytes.com/download/mysql-cheat-sheet-v1/png/">http://www.addedbytes.com/download/mysql-cheat-sheet-v1/png/</a></p>

<h2>Color Theory</h2>

<p><img src="http://pro.ctlok.com/downloads/code/web-app-development-cheat-sheet/color-theory-cheat-sheet.png" width="750">
from <a href="http://www.paper-leaf.com/blog/2010/01/color-theory-quick-reference-poster/">http://www.paper-leaf.com/blog/2010/01/color-theory-quick-reference-poster/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Maven + Jetty 測試  JSF 2 Annotation]]></title>
    <link href="http://pro.ctlok.com/blog/2012/04/03/maven-jetty-jsf-2.html"/>
    <updated>2012-04-03T14:37:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/04/03/maven-jetty-jsf-2</id>
    <content type="html"><![CDATA[<p>剛剛使用 Maven + Jetty 的組合去測試一 JSF 2.0，但很奇怪，所有的 <code>Java Bean</code> 都找不到。
原來要 JSF 自動搜索 <code>Java Bean</code> 是要包裝成 <code>WAR</code> 才可以。</p>

<p>原本運行 Jetty 使用 <code>mvn jetty:run</code> ，只要改成 <code>mvn jetty:run-war</code> 就可以了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Design Pattern - Abstract Factory]]></title>
    <link href="http://pro.ctlok.com/blog/2012/04/02/design-pattern-abstract-factory.html"/>
    <updated>2012-04-02T21:30:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/04/02/design-pattern-abstract-factory</id>
    <content type="html"><![CDATA[<p>上一篇已經介紹過的 Factory Pattern 可以將建立實例的程式碼抽取出來，
並可以提供絡不同的物件使用。Abstract Factory Pattern 其實和
Factory Pattern 很相似，但 Abstract Factory 比較偏向建立同一系統的物件。</p>

<p>同一系列的意思是彼此的物件有一定的關連，例如: 輪子、引擎、車架、方向盤、儀標板等等。
這些都是組成車子的組件，這些組件亦由可以由不同廠商去開發，Abstract Factory 扮演角色就是廠商。
更改廠商，就可以建立不同樣式的車子。</p>

<p>看看以下例子應該有助你明白這個模式：</p>

<!--more-->


<hr />

<p>公司要開發一款迷宮遊戲，建立迷宮的組件有：『牆壁』、『門』和『道路』。
遊戲在不同的關卡會顯示不同風格的迷宮，首先要將做出組件的介面和建立一個工廠介面。</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/uml.png"></p>

<p>組件介面:</p>

<figure class='code'><figcaption><span> (Component.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/Component.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Component</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Door.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/Door.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Door</span> <span class="kd">extends</span> <span class="n">Component</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Wall.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/Wall.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Wall</span> <span class="kd">extends</span> <span class="n">Component</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Road.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/Road.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Road</span> <span class="kd">extends</span> <span class="n">Component</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Labyrinth.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/Labyrinth.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">factory.LabyrinthComponentFactory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Labyrinth</span> <span class="kd">implements</span> <span class="n">Component</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">LabyrinthComponentFactory</span> <span class="n">labyrinthFactory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Labyrinth</span><span class="o">(</span><span class="n">LabyrinthComponentFactory</span> <span class="n">labyrinthFactory</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">labyrinthFactory</span> <span class="o">=</span> <span class="n">labyrinthFactory</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">switch</span> <span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">15</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>                <span class="n">labyrinthFactory</span><span class="o">.</span><span class="na">createDoor</span><span class="o">().</span><span class="na">draw</span><span class="o">();</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span><span class='line'>                <span class="n">labyrinthFactory</span><span class="o">.</span><span class="na">createRoad</span><span class="o">().</span><span class="na">draw</span><span class="o">();</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>            <span class="k">default</span><span class="o">:</span>
</span><span class='line'>                <span class="n">labyrinthFactory</span><span class="o">.</span><span class="na">createWall</span><span class="o">().</span><span class="na">draw</span><span class="o">();</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>藍色風格的組件:</p>

<figure class='code'><figcaption><span> (BlueDoor.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/blue/BlueDoor.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">.</span><span class="na">blue</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Door</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlueDoor</span> <span class="kd">implements</span> <span class="n">Door</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Blue Door&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (BlueWall.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/blue/BlueWall.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">.</span><span class="na">blue</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Wall</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlueWall</span> <span class="kd">implements</span> <span class="n">Wall</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Blue Wall&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (BlueRoad.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/blue/BlueRoad.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">.</span><span class="na">blue</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Road</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlueRoad</span> <span class="kd">implements</span> <span class="n">Road</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Blue Road&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>綠色風格的組件:</p>

<figure class='code'><figcaption><span> (GreenDoor.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/green/GreenDoor.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">.</span><span class="na">green</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Door</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreenDoor</span> <span class="kd">implements</span> <span class="n">Door</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Green Door&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (GreenWall.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/green/GreenWall.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">.</span><span class="na">green</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Wall</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreenWall</span> <span class="kd">implements</span> <span class="n">Wall</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Green Wall&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (GreenRoad.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/component/green/GreenRoad.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">component</span><span class="o">.</span><span class="na">green</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Road</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreenRoad</span> <span class="kd">implements</span> <span class="n">Road</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Green Road&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>工廠介面:</p>

<figure class='code'><figcaption><span> (LabyrinthComponentFactory.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/factory/LabyrinthComponentFactory.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">factory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Door</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Road</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Wall</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">LabyrinthComponentFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Wall</span> <span class="nf">createWall</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Door</span> <span class="nf">createDoor</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Road</span> <span class="nf">createRoad</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (BlueStyleLabyrinthComponentFactory.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/factory/BlueStyleLabyrinthComponentFactory.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">factory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Door</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Road</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Wall</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.blue.BlueDoor</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.blue.BlueRoad</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.blue.BlueWall</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlueStyleLabyrinthComponentFactory</span> <span class="kd">implements</span>
</span><span class='line'>        <span class="n">LabyrinthComponentFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Wall</span> <span class="nf">createWall</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">BlueWall</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Door</span> <span class="nf">createDoor</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">BlueDoor</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Road</span> <span class="nf">createRoad</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">BlueRoad</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (GreenStyleLabyrinthComponentFactory.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/factory/GreenStyleLabyrinthComponentFactory.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">factory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Door</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Road</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.Wall</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.green.GreenDoor</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.green.GreenRoad</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">component.green.GreenWall</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreenStyleLabyrinthComponentFactory</span> <span class="kd">implements</span>
</span><span class='line'>        <span class="n">LabyrinthComponentFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Wall</span> <span class="nf">createWall</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">GreenWall</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Door</span> <span class="nf">createDoor</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">GreenDoor</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Road</span> <span class="nf">createRoad</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">GreenRoad</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span> (Main.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-abstract-factory/sample1/Main.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">component.Labyrinth</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">factory.BlueStyleLabyrinthComponentFactory</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">factory.GreenStyleLabyrinthComponentFactory</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">factory.LabyrinthComponentFactory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">LabyrinthComponentFactory</span> <span class="n">blueStyleLabyrinthComponentFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BlueStyleLabyrinthComponentFactory</span><span class="o">();</span>
</span><span class='line'>        <span class="n">LabyrinthComponentFactory</span> <span class="n">greenStyleLabyrinthComponentFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GreenStyleLabyrinthComponentFactory</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Labyrinth</span> <span class="n">blueStyleLabyrinth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Labyrinth</span><span class="o">(</span><span class="n">blueStyleLabyrinthComponentFactory</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Labyrinth</span> <span class="n">greenStyleLabyrinth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Labyrinth</span><span class="o">(</span><span class="n">greenStyleLabyrinthComponentFactory</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">blueStyleLabyrinth</span><span class="o">.</span><span class="na">draw</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;------------------&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">greenStyleLabyrinth</span><span class="o">.</span><span class="na">draw</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>執行結果</span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='text'><span class='line'>Blue Road
</span><span class='line'>Blue Road
</span><span class='line'>Blue Road
</span><span class='line'>Blue Wall
</span><span class='line'>Blue Road
</span><span class='line'>Blue Door
</span><span class='line'>Blue Wall
</span><span class='line'>Blue Road
</span><span class='line'>Blue Road
</span><span class='line'>Blue Road
</span><span class='line'>------------------
</span><span class='line'>Green Wall
</span><span class='line'>Green Wall
</span><span class='line'>Green Wall
</span><span class='line'>Green Road
</span><span class='line'>Green Wall
</span><span class='line'>Green Wall
</span><span class='line'>Green Wall
</span><span class='line'>Green Road
</span><span class='line'>Green Wall
</span><span class='line'>Green Road
</span></code></pre></td></tr></table></div></figure>


<p>在建立 <code>Labyrinth</code> 時，只需將工廠交給 <code>Labyrinth</code> 就可以建立不同風格的迷宮。</p>

<p>要新增更多風格的組件，只需要建立相對應的工廠就可以了，完全不需要改動 <code>Labyrinth.draw</code> 的程式碼。</p>

<p>不過 Abstract Factory 有一個缺點，如果你要新増一個原先不存在的組件，例如加一個『陷阱』，
你便需要更改 <code>LabyrinthFactory</code> 這個介面。</p>

<hr />

<p>以下的圖片是描述 Abstract Factory Pattern 的 Class Diagram。（From Wiki）</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Abstract_factory.svg/517px-Abstract_factory.svg.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Design Pattern - Factory]]></title>
    <link href="http://pro.ctlok.com/blog/2012/04/02/design-pattern-factory.html"/>
    <updated>2012-04-02T10:32:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/04/02/design-pattern-factory</id>
    <content type="html"><![CDATA[<p>Factory Pattern 可以將創造實例的程式碼分離，令原本核心的程式碼不必太過依賴於某一個物件，
並可以令其他要用到同一物件的地方使用同一套程式碼，方便集中管理。</p>

<p>看看以下例子應該有助你明白這個模式：</p>

<!--more-->


<hr />

<p>公司要你開發一個 Logger (記錄器)，用於記錄程式內的變化，你一開始可能會設計成以下這樣:</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-factory/sample1/uml.png"></p>

<figure class='code'><figcaption><span> (Logger.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample1/Logger.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Logger</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">info</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">warn</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">error</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (ConsoleLogger.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample1/ConsoleLogger.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsoleLogger</span> <span class="kd">implements</span> <span class="n">Logger</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">ConsoleLogger</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">){</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">clazz</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;DEBUG&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">info</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;INFO&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">warn</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;WARN&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">error</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;ERROR&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="n">String</span> <span class="n">level</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; [&quot;</span> <span class="o">+</span> <span class="n">level</span> <span class="o">+</span> <span class="s">&quot;] &quot;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>其他程式要使用時會直接使用 <code>new ConsoleLogger()</code> 來取得 ConsoleLogger 的 Instance (實例)。</p>

<figure class='code'><figcaption><span> (AService.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample1/AService.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AService</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConsoleLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething start&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code...</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething end&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (BService.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample1/BService.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BService</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConsoleLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething start&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code...</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething end&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>有沒有發現什麼問題? 如果使用 Logger 的物件超過 100 個，要轉換 ConsoleLogger 為其他 Logger 就要更改 100 次程式碼。</p>

<hr />

<p>我們可以使用 Factory Pattern 來解決這個問題:</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-factory/sample2/uml.png"></p>

<figure class='code'><figcaption><span> (Logger.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample2/Logger.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Logger</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">info</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">warn</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">error</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (ConsoleLogger.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample2/ConsoleLogger.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsoleLogger</span> <span class="kd">implements</span> <span class="n">Logger</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">ConsoleLogger</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">){</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">clazz</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;DEBUG&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">info</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;INFO&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">warn</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;WARN&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">error</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;ERROR&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="n">String</span> <span class="n">level</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; [&quot;</span> <span class="o">+</span> <span class="n">level</span> <span class="o">+</span> <span class="s">&quot;] &quot;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (FileLogger.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample2/FileLogger.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.io.BufferedWriter</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.FileWriter</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileLogger</span> <span class="kd">implements</span> <span class="n">Logger</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">FileLogger</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">){</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">clazz</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;DEBUG&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">info</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;INFO&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">warn</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;WARN&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">error</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">log</span><span class="o">(</span><span class="s">&quot;ERROR&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="n">String</span> <span class="n">level</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">log</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; [&quot;</span> <span class="o">+</span> <span class="n">level</span> <span class="o">+</span> <span class="s">&quot;] &quot;</span> <span class="o">+</span> <span class="n">message</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">BufferedWriter</span> <span class="n">bw</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">bw</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="s">&quot;application.log&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">));</span>
</span><span class='line'>            <span class="n">bw</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">log</span><span class="o">);</span>
</span><span class='line'>            <span class="n">bw</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">bw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (LoggerFactory.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample2/LoggerFactory.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoggerFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="nf">createLogger</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">){</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">FileLogger</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>新增一個 LoggerFactory，用來建立 Logger 。</p>

<figure class='code'><figcaption><span> (AService.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample2/AService.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AService</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">createLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething start&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code...</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething end&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (BService.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample2/BService.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BService</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">createLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething start&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code...</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething end&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>以後要使用 Logger 時不必知道實際是使用 ConsoleLogger 或 FileLogger，只要物件實現了 Logger 這個介面就可以了。
這個 Factory Pattern 解決了一些問題，但仍然差一點，例如: 在測試環境中我想使用 ConsoleLogger，
但在正常環境中是使用 FileLogger，但以上的方法並不能解決這個問題。</p>

<hr />

<p>將 LoggerFactory 的 createLogger 變更為 Non-Static:</p>

<figure class='code'><figcaption><span> (LoggerFactory.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample3/LoggerFactory.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoggerFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Logger</span> <span class="nf">createLogger</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">){</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">FileLogger</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>新増一個 MockLoggerFactory 在測試環境:</p>

<figure class='code'><figcaption><span> (MockLoggerFactory.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample3/MockLoggerFactory.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MockLoggerFactory</span> <span class="kd">extends</span> <span class="n">LoggerFactory</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Logger</span> <span class="nf">createLogger</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">ConsoleLogger</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span> (AService.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample3/AService.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AService</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Logger</span> <span class="n">logger</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">AService</span><span class="o">(</span><span class="n">LoggerFactory</span> <span class="n">loggerFactory</span><span class="o">){</span>
</span><span class='line'>        <span class="n">logger</span> <span class="o">=</span> <span class="n">loggerFactory</span><span class="o">.</span><span class="na">createLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething start&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code...</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething end&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (BService.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample3/BService.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BService</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Logger</span> <span class="n">logger</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">BService</span><span class="o">(</span><span class="n">LoggerFactory</span> <span class="n">loggerFactory</span><span class="o">){</span>
</span><span class='line'>        <span class="n">logger</span> <span class="o">=</span> <span class="n">loggerFactory</span><span class="o">.</span><span class="na">createLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething start&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// code...</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;doSomething end&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span> (Main.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-factory/sample3/Main.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">LoggerFactory</span> <span class="n">loggerFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LoggerFactory</span><span class="o">();</span>
</span><span class='line'>        <span class="n">AService</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AService</span><span class="o">(</span><span class="n">loggerFactory</span><span class="o">);</span>
</span><span class='line'>        <span class="n">BService</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BService</span><span class="o">(</span><span class="n">loggerFactory</span><span class="o">);</span>
</span><span class='line'>        <span class="n">a</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
</span><span class='line'>        <span class="n">b</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//Unit Test</span>
</span><span class='line'>        <span class="n">loggerFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockLoggerFactory</span><span class="o">();</span>
</span><span class='line'>        <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AService</span><span class="o">(</span><span class="n">loggerFactory</span><span class="o">);</span>
</span><span class='line'>        <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BService</span><span class="o">(</span><span class="n">loggerFactory</span><span class="o">);</span>
</span><span class='line'>        <span class="n">a</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
</span><span class='line'>        <span class="n">b</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>這樣就可以在不同環境替換 LoggerFactory 來建立不同的 Logger。</p>

<hr />

<p>以下的圖片是描述 Factory Pattern 的 Class Diagram。（From Wiki）</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/FactoryMethod.svg/349px-FactoryMethod.svg.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Maven Setup Jetty Development Server]]></title>
    <link href="http://pro.ctlok.com/blog/2012/03/30/maven-setup-jetty-dev-server.html"/>
    <updated>2012-03-30T14:38:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/03/30/maven-setup-jetty-dev-server</id>
    <content type="html"><![CDATA[<p>在 Maven 使用 Jetty 作為 Web Server 是非常簡單，在 <code>pom.xml</code> 加入以下設定:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>org.mortbay.jetty<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>maven-jetty-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>6.1.26<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>        <span class="nt">&lt;stopPort&gt;</span>9966<span class="nt">&lt;/stopPort&gt;</span>
</span><span class='line'>        <span class="nt">&lt;stopKey&gt;</span>stop<span class="nt">&lt;/stopKey&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'><span class="nt">&lt;/plugin&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>以後只需要輸入 <code>mvn jetty:run</code> 就會啟動 Jetty Web Server，輸入 <code>mvn jetty:stop</code> 則關閉，
非常方便。啟動後打開 <code>http://localhost:8080</code> 就可以用了。</p>

<!--more-->


<hr />

<p>如果要在 Unit Test 測試 URL 或版面的 HTML 是否正確，可以參考以下的 <code>pom.xml</code> 設定:</p>

<figure class='code'><figcaption><span> (pom.xml)</span> <a href='http://pro.ctlok.com/downloads/code/maven-setup-jetty-dev-server/pom.xml'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>pro.ctlok.com<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>jetty<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;name&gt;</span>jetty<span class="nt">&lt;/name&gt;</span>
</span><span class='line'>    <span class="nt">&lt;url&gt;</span>http://maven.apache.org<span class="nt">&lt;/url&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dependencies&gt;</span>
</span><span class='line'>        <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactId&gt;</span>servlet-api<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;version&gt;</span>2.5<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupId&gt;</span>javax.servlet.jsp<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactId&gt;</span>jsp-api<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>        <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>            <span class="nt">&lt;version&gt;</span>4.10<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/dependencies&gt;</span>
</span><span class='line'>    <span class="nt">&lt;build&gt;</span>
</span><span class='line'>        <span class="nt">&lt;plugins&gt;</span>
</span><span class='line'>            <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>                <span class="nt">&lt;version&gt;</span>2.0.2<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>                <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;source&gt;</span>1.5<span class="nt">&lt;/source&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;target&gt;</span>1.5<span class="nt">&lt;/target&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>            <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>                <span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>                <span class="nt">&lt;version&gt;</span>2.12<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>            <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>                <span class="nt">&lt;groupId&gt;</span>org.mortbay.jetty<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>                <span class="nt">&lt;artifactId&gt;</span>maven-jetty-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>                <span class="nt">&lt;version&gt;</span>6.1.26<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>                <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;stopPort&gt;</span>9966<span class="nt">&lt;/stopPort&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;stopKey&gt;</span>stop<span class="nt">&lt;/stopKey&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>                <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>                    <span class="c">&lt;!-- Before test class execute, start Jetty web server first --&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;id&gt;</span>start-jetty<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;phase&gt;</span>test-compile<span class="nt">&lt;/phase&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;goal&gt;</span>run<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;scanIntervalSeconds&gt;</span>0<span class="nt">&lt;/scanIntervalSeconds&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;daemon&gt;</span>true<span class="nt">&lt;/daemon&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>                    <span class="c">&lt;!-- After test, stop Jetty web server --&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;id&gt;</span>stop-jetty<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;phase&gt;</span>test<span class="nt">&lt;/phase&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;goal&gt;</span>stop<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/plugins&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/build&gt;</span>
</span><span class='line'><span class="nt">&lt;/project&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上設定可以在測試前啟動 Jetty Web Server，測試完畢就會自動關閉。</p>

<figure class='code'><figcaption><span> (HelloServlet.java)</span> <a href='http://pro.ctlok.com/downloads/code/maven-setup-jetty-dev-server/HelloServlet.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">pro</span><span class="o">.</span><span class="na">ctlok</span><span class="o">.</span><span class="na">com</span><span class="o">.</span><span class="na">jetty</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">6496751289098922589L</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
</span><span class='line'>          <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;Hello World&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (UrlTest.java)</span> <a href='http://pro.ctlok.com/downloads/code/maven-setup-jetty-dev-server/UrlTest.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">pro</span><span class="o">.</span><span class="na">ctlok</span><span class="o">.</span><span class="na">com</span><span class="o">.</span><span class="na">jetty</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.net.HttpURLConnection</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.net.URL</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UrlTest</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Test</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;http://localhost:8080/jetty/index&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">HttpURLConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">assert</span> <span class="n">conn</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">()</span> <span class="o">==</span> <span class="mi">200</span><span class="o">;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">BufferedReader</span> <span class="n">rd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">try</span><span class="o">{</span>
</span><span class='line'>          <span class="k">assert</span> <span class="n">rd</span><span class="o">.</span><span class="na">readLine</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;Hello World&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">rd</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (web.xml)</span> <a href='http://pro.ctlok.com/downloads/code/maven-setup-jetty-dev-server/web.xml'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">&quot;2.5&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
</span><span class='line'><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;display-name&gt;</span>jetty<span class="nt">&lt;/display-name&gt;</span>
</span><span class='line'>    <span class="nt">&lt;session-config&gt;</span>
</span><span class='line'>        <span class="nt">&lt;session-timeout&gt;</span>30<span class="nt">&lt;/session-timeout&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/session-config&gt;</span>
</span><span class='line'>    <span class="nt">&lt;servlet&gt;</span>
</span><span class='line'>        <span class="nt">&lt;display-name&gt;</span>IndexServlet<span class="nt">&lt;/display-name&gt;</span>
</span><span class='line'>        <span class="nt">&lt;servlet-name&gt;</span>IndexServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>        <span class="nt">&lt;servlet-class&gt;</span>pro.ctlok.com.jetty.HelloServlet<span class="nt">&lt;/servlet-class&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/servlet&gt;</span>
</span><span class='line'>    <span class="nt">&lt;servlet-mapping&gt;</span>
</span><span class='line'>        <span class="nt">&lt;servlet-name&gt;</span>IndexServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span><span class='line'>        <span class="nt">&lt;url-pattern&gt;</span>/index<span class="nt">&lt;/url-pattern&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/servlet-mapping&gt;</span>
</span><span class='line'>    <span class="nt">&lt;welcome-file-list&gt;</span>
</span><span class='line'>        <span class="nt">&lt;welcome-file&gt;</span>index<span class="nt">&lt;/welcome-file&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/welcome-file-list&gt;</span>
</span><span class='line'><span class="nt">&lt;/web-app&gt;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Design Pattern - Observer]]></title>
    <link href="http://pro.ctlok.com/blog/2012/03/29/design-pattern-observer.html"/>
    <updated>2012-03-29T22:08:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/03/29/design-pattern-observer</id>
    <content type="html"><![CDATA[<p>Observer Pattern 有 2 個重要角色「主題」和「觀察者」，觀察者希望主題狀態有變更時會立即被告知。</p>

<p>你可以想像 Blog 上的 Email 訂閱服務（本 Blog 沒有），當你對這個 Blog 有興趣時，
你會用你的 Email 地址去訂閱服務，當有更新時你會立即收到通知，題示你有更新了，請去看看。
當你對 Blog 上千篇一律的內容感到無聊時，你亦可以取消這個訂閱，那以後有更新亦不會再通知你。</p>

<p>看看以下例子應該有助你明白這個模式：</p>

<!--more-->


<hr />

<p>公司要你開發一個即時新聞平台，用戶只需要打開程式就能夠看到即時新聞。</p>

<p>你一開始可能會用 Pull 的方法，每隔一段時間會主動去向主題拿取新的內容：</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-observer/sample1/uml.png"></p>

<figure class='code'><figcaption><span> (NewsTopic.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-observer/sample1/NewsTopic.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.UUID</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NewsTopic</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">getMessages</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">messages</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Assign unique ID to each message for determine is it old message.</span>
</span><span class='line'>        <span class="n">messages</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Client.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-observer/sample1/Client.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map.Entry</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.TimerTask</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="kd">extends</span> <span class="n">TimerTask</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">displayedIds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">NewsTopic</span> <span class="n">topic</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Client</span><span class="o">(</span><span class="n">NewsTopic</span> <span class="n">topic</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">topic</span> <span class="o">=</span> <span class="n">topic</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">displayNews</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">topic</span><span class="o">.</span><span class="na">getMessages</span><span class="o">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(!</span><span class="n">displayedIds</span><span class="o">.</span><span class="na">containsAll</span><span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="na">keySet</span><span class="o">()))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">messages</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(!</span><span class="n">displayedIds</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
</span><span class='line'>                            <span class="s">&quot;Client %s display message: %s at time: %s&quot;</span><span class="o">,</span>
</span><span class='line'>                            <span class="n">Integer</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()),</span>
</span><span class='line'>                            <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>
</span><span class='line'>                    <span class="n">displayedIds</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">displayNews</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Main.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-observer/sample1/Main.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Timer</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">NewsTopic</span> <span class="n">topic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NewsTopic</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Client</span> <span class="n">client1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">(</span><span class="n">topic</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Client</span> <span class="n">client2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">(</span><span class="n">topic</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Client</span> <span class="n">client3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">(</span><span class="n">topic</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Timer</span> <span class="n">timer1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">();</span>
</span><span class='line'>        <span class="n">timer1</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">client1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="mi">3000</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Timer</span> <span class="n">timer2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">();</span>
</span><span class='line'>        <span class="n">timer2</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">client2</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="mi">5000</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Timer</span> <span class="n">timer3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">();</span>
</span><span class='line'>        <span class="n">timer3</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="n">client3</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="mi">7000</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">topic</span><span class="o">.</span><span class="na">addMessage</span><span class="o">(</span><span class="s">&quot;News &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
</span><span class='line'>                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5000</span><span class="o">));</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">timer1</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
</span><span class='line'>        <span class="n">timer2</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
</span><span class='line'>        <span class="n">timer3</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>執行結果</span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='text'><span class='line'>Client 109a4c display message: News 0 at time: Fri Mar 30 00:41:23 CST 2012
</span><span class='line'>Client c40c80 display message: News 0 at time: Fri Mar 30 00:41:25 CST 2012
</span><span class='line'>Client c40c80 display message: News 1 at time: Fri Mar 30 00:41:25 CST 2012
</span><span class='line'>Client 109a4c display message: News 2 at time: Fri Mar 30 00:41:26 CST 2012
</span><span class='line'>Client 109a4c display message: News 1 at time: Fri Mar 30 00:41:26 CST 2012
</span></code></pre></td></tr></table></div></figure>


<p>每個 Client 接收到訊息的時間不一。</p>

<hr />

<p>有客戶抱怨，股票新聞不夠實時，害他掉了錢。公司要你改善一下程式，盡量減少延遲。</p>

<p>現在是 Observer Pattern 大派用場的時候，因為一有更新就會主動通知觀察者，大大減低新聞延遲的問題。</p>

<p>你可能會問，使用舊方法但將間隔縮短不就可以了嗎？
這個方法雖然可以解決延遲的問題，但如果客戶多達 10000 人時，每一個也不停重覆去檢查資料是非常浪費系統資源，
CPU 長期高工作量，會拖跨了系統的其他程式。</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-observer/sample2/uml.png"></p>

<figure class='code'><figcaption><span> (Subject.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-observer/sample2/Subject.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Subject</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerObserver</span><span class="o">(</span><span class="n">Observer</span> <span class="n">observer</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">unregisterObserver</span><span class="o">(</span><span class="n">Observer</span> <span class="n">observer</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyObservers</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Observer.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-observer/sample2/Observer.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Observer</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notify</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (NewsTopic.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-observer/sample2/NewsTopic.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NewsTopic</span> <span class="kd">implements</span> <span class="n">Subject</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">&gt;</span> <span class="n">obervers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Observer</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">pushMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
</span><span class='line'>        <span class="n">notifyObservers</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerObserver</span><span class="o">(</span><span class="n">Observer</span> <span class="n">observer</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">obervers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">unregisterObserver</span><span class="o">(</span><span class="n">Observer</span> <span class="n">observer</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">obervers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyObservers</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">Observer</span> <span class="nl">observer:</span> <span class="n">obervers</span><span class="o">){</span>
</span><span class='line'>            <span class="n">observer</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Client.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-observer/sample2/Client.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="kd">implements</span> <span class="n">Observer</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notify</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
</span><span class='line'>                <span class="s">&quot;Client %s display message: %s at time: %s&quot;</span><span class="o">,</span>
</span><span class='line'>                <span class="n">Integer</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()),</span> <span class="n">message</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Main.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-observer/sample2/Main.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">NewsTopic</span> <span class="n">topic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NewsTopic</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Client</span> <span class="n">client1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Client</span> <span class="n">client2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">();</span>
</span><span class='line'>        <span class="n">Client</span> <span class="n">client3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">topic</span><span class="o">.</span><span class="na">registerObserver</span><span class="o">(</span><span class="n">client1</span><span class="o">);</span>
</span><span class='line'>        <span class="n">topic</span><span class="o">.</span><span class="na">registerObserver</span><span class="o">(</span><span class="n">client2</span><span class="o">);</span>
</span><span class='line'>        <span class="n">topic</span><span class="o">.</span><span class="na">registerObserver</span><span class="o">(</span><span class="n">client3</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">topic</span><span class="o">.</span><span class="na">pushMessage</span><span class="o">(</span><span class="s">&quot;News &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
</span><span class='line'>                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">5000</span><span class="o">));</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>執行結果</span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='text'><span class='line'>Client 10b30a7 display message: News 0 at time: Fri Mar 30 00:54:03 CST 2012
</span><span class='line'>Client ca0b6 display message: News 0 at time: Fri Mar 30 00:54:03 CST 2012
</span><span class='line'>Client 14318bb display message: News 0 at time: Fri Mar 30 00:54:03 CST 2012
</span><span class='line'>Client 10b30a7 display message: News 1 at time: Fri Mar 30 00:54:07 CST 2012
</span><span class='line'>Client ca0b6 display message: News 1 at time: Fri Mar 30 00:54:07 CST 2012
</span><span class='line'>Client 14318bb display message: News 1 at time: Fri Mar 30 00:54:07 CST 2012
</span><span class='line'>Client 10b30a7 display message: News 2 at time: Fri Mar 30 00:54:09 CST 2012
</span><span class='line'>Client ca0b6 display message: News 2 at time: Fri Mar 30 00:54:09 CST 2012
</span><span class='line'>Client 14318bb display message: News 2 at time: Fri Mar 30 00:54:09 CST 2012
</span></code></pre></td></tr></table></div></figure>


<p>現在每一次發佈訊息時，每一個客戶都同時收到，大大減低了延遲和系統負荷。</p>

<hr />

<p>以下的圖片是描述 Observer Pattern 的 Class Diagram。（From Wiki）</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Observer.svg/500px-Observer.svg.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Design Pattern - Strategy]]></title>
    <link href="http://pro.ctlok.com/blog/2012/03/28/design-pattern-strategy-pattern.html"/>
    <updated>2012-03-28T22:34:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/03/28/design-pattern-strategy-pattern</id>
    <content type="html"><![CDATA[<p>近日拿出 Design Pattern 的書重溫，順便和大家分享一下。</p>

<p>Strategy Pattern 主要的目的是將一些有很大機會轉變的行為或演算法封裝起來，並抽出來，
令到在執行期間也可以替換。這樣做的好處是不用變動核心程式碼，而又做到變更行為等等功能。</p>

<p>以下的例子可能令你更明白這個模式的用途。</p>

<!--more-->


<hr />

<p>你的公司要你開發一個遊戲，這個遊戲是一個古代戰爭遊戲，每個人扮演一個特定角色。
公司希望可以隨時增加角色，你一開始的設計可能會這樣:</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample1/uml.png"></p>

<figure class='code'><figcaption><span> (Character.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample1/Character.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Character</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">hp</span><span class="o">,</span> <span class="kt">int</span> <span class="n">mp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">hp</span> <span class="o">=</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">mp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attack</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Attack&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHp</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHp</span><span class="o">(</span><span class="kt">int</span> <span class="n">hp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">hp</span> <span class="o">=</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMp</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMp</span><span class="o">(</span><span class="kt">int</span> <span class="n">mp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">mp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Human.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample1/Human.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Human</span> <span class="kd">extends</span> <span class="n">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Human</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Dwarve.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample1/Dwarve.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dwarve</span> <span class="kd">extends</span> <span class="n">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Dwarve</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="mi">150</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>這樣的設計原本符合公司規格，隨時可以新增角色，亦利用了 OO 的特性。</p>

<hr />

<p>公司高層認為每個角色的攻擊都一樣，太乏味了，建議你改一改程式去令每一個角色都拿不同武器去攻擊。
你可能會更改程式成為這樣:</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample2/uml.png"></p>

<figure class='code'><figcaption><span> (Character.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample2/Character.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Character</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">hp</span><span class="o">,</span> <span class="kt">int</span> <span class="n">mp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">hp</span> <span class="o">=</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">mp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">attack</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHp</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHp</span><span class="o">(</span><span class="kt">int</span> <span class="n">hp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">hp</span> <span class="o">=</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMp</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMp</span><span class="o">(</span><span class="kt">int</span> <span class="n">mp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">mp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Human.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample2/Human.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Human</span> <span class="kd">extends</span> <span class="n">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Human</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attack</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Sword attack&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Dwarve.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample2/Dwarve.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dwarve</span> <span class="kd">extends</span> <span class="n">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Dwarve</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="mi">150</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attack</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Axe attack&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Character 內的 attack() 改為 abstract ，每個角色自己實現自己的攻擊模式。
這樣看好像沒有什麼問題，但如果以後增加角色，而這個角色和現有角色的武器一樣，那不是要將程式碼複製出來？
同樣的程式碼可能會在不同角色內出現，以後維護起來便加倍困難。複製一次程式碼 = 連 Bug 也一起複製了。</p>

<hr />

<p>公司高層又想改一下遊戲，今次改動是可以令角色選擇不同武器。
上次的程式是不容許角色更換武器，因為在 attack() 內限制了角色使用的武器。
今次需要使用 Strategy Pattern 令程式更具彈性:</p>

<p><img src="http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample3/uml.png"></p>

<figure class='code'><figcaption><span> (Character.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample3/Character.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">AttackBehavior</span> <span class="n">attackBehavior</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Character</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">hp</span><span class="o">,</span> <span class="kt">int</span> <span class="n">mp</span><span class="o">,</span> <span class="n">AttackBehavior</span> <span class="n">attackBehavior</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">hp</span> <span class="o">=</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">mp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">attackBehavior</span> <span class="o">=</span> <span class="n">attackBehavior</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attack</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">attackBehavior</span><span class="o">.</span><span class="na">attack</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHp</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHp</span><span class="o">(</span><span class="kt">int</span> <span class="n">hp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">hp</span> <span class="o">=</span> <span class="n">hp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMp</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMp</span><span class="o">(</span><span class="kt">int</span> <span class="n">mp</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">mp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">AttackBehavior</span> <span class="nf">getAttackBehavior</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">attackBehavior</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttackBehavior</span><span class="o">(</span><span class="n">AttackBehavior</span> <span class="n">attackBehavior</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">attackBehavior</span> <span class="o">=</span> <span class="n">attackBehavior</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Human.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample3/Human.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Human</span> <span class="kd">extends</span> <span class="n">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Human</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">AttackBehavior</span> <span class="n">attackBehavior</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="n">attackBehavior</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (Dwarve.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample3/Dwarve.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dwarve</span> <span class="kd">extends</span> <span class="n">Character</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Dwarve</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">AttackBehavior</span> <span class="n">attackBehavior</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="mi">150</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="n">attackBehavior</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span> (AttackBehavior.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample3/AttackBehavior.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AttackBehavior</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attack</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (SwordAttackBehavior.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample3/SwordAttackBehavior.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SwordAttackBehavior</span> <span class="kd">implements</span> <span class="n">AttackBehavior</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attack</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Sword attack&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span> (AxeAttackBehavior.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample3/AxeAttackBehavior.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AxeAttackBehavior</span> <span class="kd">implements</span> <span class="n">AttackBehavior</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attack</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Axe attack&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span> (Main.java)</span> <a href='http://pro.ctlok.com/downloads/code/design-pattern-strategy/sample3/Main.java'>download</a></figcaption>
 <div class="highlight"><table><tr><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Character</span> <span class="n">character1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Human</span><span class="o">(</span><span class="s">&quot;Lawrence&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">AxeAttackBehavior</span><span class="o">());</span>
</span><span class='line'>        <span class="n">Character</span> <span class="n">character2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Human</span><span class="o">(</span><span class="s">&quot;Tony&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">SwordAttackBehavior</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">character1</span><span class="o">.</span><span class="na">attack</span><span class="o">();</span>
</span><span class='line'>        <span class="n">character2</span><span class="o">.</span><span class="na">attack</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">character1</span><span class="o">.</span><span class="na">setAttackBehavior</span><span class="o">(</span><span class="k">new</span> <span class="n">SwordAttackBehavior</span><span class="o">());</span>
</span><span class='line'>        <span class="n">character1</span><span class="o">.</span><span class="na">attack</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>現在只需要在建立角色時將攻擊行為也一起加到角色中就可以了，而且可以隨時更改攻擊行為。</p>

<hr />

<p>以下的圖片是描述 Strategy Pattern 的 Class Diagram。（From Wiki）</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/0/08/StrategyPatternClassDiagram.svg/400px-StrategyPatternClassDiagram.svg.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在 Windows 設定 Octopress]]></title>
    <link href="http://pro.ctlok.com/blog/2012/03/26/windows-install-octopress.html"/>
    <updated>2012-03-26T12:13:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/03/26/windows-install-octopress</id>
    <content type="html"><![CDATA[<p>因為公司的電腦是 Windows，又想閒來沒事時可以寫寫文章，所以需要在 Windows 上設定 Octopress。
在 Windows 上要設定好 <a href="http://octopress.org/">Octopress</a> 是比在 Mac 上麻煩得多。</p>

<h3>Install Ruby</h3>

<p>首先要安裝 <a href="http://www.ruby-lang.org">Ruby</a>，Windows 上使用 RubyInstaller 安裝 Ruby，
RubyInstaller 已經包括了 <a href="http://rubygems.org/">Gem</a>。</p>

<p>RubyInstaller 在這裡下載: <a href="http://rubyinstaller.org/downloads/">http://rubyinstaller.org/downloads/</a></p>

<p>我安裝的版本是 Ruby 1.9.3-p125</p>

<p>順便下載 Ruby 的 Development Kit: <code>DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe</code></p>

<p>安裝好 Ruby 後解壓 Development Kit，再到 Development Kit 資料夾內執行以下指令:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='sh'><span class='line'>ruby dk.rb init
</span><span class='line'>ruby dk.rb install
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<h3>Install Python</h3>

<p>安裝 Python 是因為 Octopress 處理文章內的程式碼是會用到 <a href="http://pygments.org/">Pygments syntax highlighting</a>。</p>

<p>Python 在這裡下載: <a href="http://www.python.org/getit/">http://www.python.org/getit/</a></p>

<p>版本是 2.7.2</p>

<p>更新: 我在 64bit 的 Windows 7 上安裝 64bit 的 Python 2.7.2 在執行 <code>rake generate</code> 時會出現找不到 <code>.dll</code> 的問題，轉了 32bit 的 Python 2.7.2 就沒有問題了。(奇怪)</p>

<h3>Install Git</h3>

<p>msysgit: <a href="http://code.google.com/p/msysgit/">http://code.google.com/p/msysgit/</a></p>

<h3>Setup Octopress</h3>

<p>輸入以下指令設定 Octopress:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='sh'><span class='line'>git clone git://github.com/imathis/octopress.git octopress
</span><span class='line'><span class="nb">cd </span>octopress
</span><span class='line'>gem install bundle
</span><span class='line'>bundle install
</span></code></pre></td></tr></table></div></figure>


<p>令 Octopress 支援中文，要將語言環境設定為台灣，編碼是 <code>UTF-8</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='sh'><span class='line'><span class="nb">set </span><span class="nv">LC_ALL</span><span class="o">=</span>zh_TW.UTF-8
</span><span class='line'><span class="nb">set </span><span class="nv">LANG</span><span class="o">=</span>zh_TW.UTF-8
</span></code></pre></td></tr></table></div></figure>


<h3>Setup Deploy Setting</h3>

<p>最後就是設定整個 Blog 會放置的地方。</p>

<p>放到 Github Page 上:</p>

<ol>
<li>到 Github 新增一個 Repo</li>
<li>名稱輸入 <code>\&lt;username\&gt;.github.com</code></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='sh'><span class='line'>rake setup_github_pages  <span class="c">#enter git@github.com:&lt;username&gt;/&lt;username&gt;.github.com.git</span>
</span><span class='line'>rake generate
</span><span class='line'>rake deploy
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[由 Blogspot 搬家到 Octopress Github Page]]></title>
    <link href="http://pro.ctlok.com/blog/2012/03/25/blogger-migrate-to-octopress-github-page.html"/>
    <updated>2012-03-25T15:41:00+08:00</updated>
    <id>http://pro.ctlok.com/blog/2012/03/25/blogger-migrate-to-octopress-github-page</id>
    <content type="html"><![CDATA[<p><img src="http://octopress.org/images/logo.png"></p>

<p>由於在 Blogspot 的 Blog 頁面引入太多的 Javascript、CSS 和圖片，令到瀏覽速度援慢。反正要來一個大修改，倒不如連平台亦一起換掉。</p>

<p>現在這個 Blog 是使用 Octopress Blogging Framework 管理文章並放到 Github page 上，速度算不錯，順便將廣告和一些不必要的功能全部移除掉，令整個版面更簡潔，閱讀起來比較舒服。</p>

<!--more-->


<p>Octopress 對比 Blogspot 的好處:</p>

<ul>
<li>方便插入程式碼，支援 Gist</li>
<li>使用 Markdown 來編排交章格式，比 HTML 簡單得多</li>
<li>快速，因為所有頁面都是靜態 HTML 內容</li>
<li>方便使用 Git 管理</li>
<li>高度自由，可自己寫一些 Plugin 或更改原有程式碼，製作 Theme 亦很簡單（我到現在亦不懂製作 Blogspot Theme）</li>
<li>放到 Github page 或 Heroku 上，中國網民都可以瀏覽得到</li>
</ul>


<p>當然 Octopress 對比 Blogspot 亦有一些壞處:</p>

<ul>
<li>不能隨時隨地修改文章（因為沒有 Web admin console）</li>
<li>對於普通用家來說，設定非常複雜</li>
</ul>


<p>其實要將 Blogspot 上的文章轉換成 Octopress 的文章格式亦很容易，已經有好心人提供了 Script 去轉換了。</p>

<p>但這個 Script 有一個限制，就是最多支援 500 篇文章，所有文章都是 HTML 格式，而不是 Markdown。</p>

<figure class='code'><figcaption><span>Blogspot posts migrate to Octopress posts</span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git clone git://gist.github.com/1807781
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>1807781
</span><span class='line'><span class="nv">$ </span>./bloggerImport.sh &lt;blogname&gt; <span class="c"># &lt;blogname&gt;.blogspot.com</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果你的 Blogspot 使用了其他 Domain name，你需要修改 bloggerImport.sh:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span> -z <span class="s2">&quot;$WGET&quot;</span> <span class="o">]</span> <span class="o">||</span> wget <span class="s2">&quot;http://${BLOGGER}.blogspot.com/feeds/posts/full?alt=rss&amp;max-results=500&quot;</span> -O <span class="k">${</span><span class="nv">BLOGGER</span><span class="k">}</span>.xml
</span><span class='line'><span class="o">[</span> -z <span class="s2">&quot;$CURL&quot;</span> <span class="o">]</span> <span class="o">||</span> curl <span class="s2">&quot;http://${BLOGGER}.blogspot.com/feeds/posts/full?alt=rss&amp;max-results=500&quot;</span> -o <span class="k">${</span><span class="nv">BLOGGER</span><span class="k">}</span>.xml
</span></code></pre></td></tr></table></div></figure>


<p>換為</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span> -z <span class="s2">&quot;$WGET&quot;</span> <span class="o">]</span> <span class="o">||</span> wget <span class="s2">&quot;http://&lt;your_domain&gt;/feeds/posts/full?alt=rss&amp;max-results=500&quot;</span> -O <span class="k">${</span><span class="nv">BLOGGER</span><span class="k">}</span>.xml
</span><span class='line'><span class="o">[</span> -z <span class="s2">&quot;$CURL&quot;</span> <span class="o">]</span> <span class="o">||</span> curl <span class="s2">&quot;http://&lt;your_domain&gt;/feeds/posts/full?alt=rss&amp;max-results=500&quot;</span> -o <span class="k">${</span><span class="nv">BLOGGER</span><span class="k">}</span>.xml
</span></code></pre></td></tr></table></div></figure>


<p>執行後會多了一個 _posts 的資料夾，將這個資料夾放左 source 就可以了。</p>

<p>以下是轉換程式的 Source Code:</p>

<div><script src='https://gist.github.com/1807781.js?file='></script>
<noscript><pre><code>jekyll
</code></pre></noscript></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Shacial 的資料庫設計]]></title>
    <link href="http://pro.ctlok.com/2012/03/shacial-database-design.html"/>
    <updated>2012-03-23T14:40:00+08:00</updated>
    <id>http://pro.ctlok.com/2012/03/shacial-database-design</id>
    <content type="html"><![CDATA[<a href="http://www.shacial.com">Shacial</a> 上線時間差不多有 4 星期了，雖然使用的人並不多，但仍然想再將這個服務做得更加好。<br />在這裡我先公開資料庫設計給大家看看。以後可能會再公開程式碼。(Open Source Project ?)<br /><br />以下就是 <a href="http://www.shacial.com">Shacial</a> 的 ERD:<br /><br /><a href="http://3.bp.blogspot.com/-IuTFgpUweFM/T2wZLbHTBhI/AAAAAAAAA94/r_OJn2IS4Cc/s1600/ERD.png" imageanchor="1" style=""><img border="0" height="345" width="400" src="http://3.bp.blogspot.com/-IuTFgpUweFM/T2wZLbHTBhI/AAAAAAAAA94/r_OJn2IS4Cc/s400/ERD.png" /></a><br /><br />已經設計好支援檔案版本控制。下一步應該要想想如何支援 <b>News Feed</b>，即時的信息傳遞。<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-987543225069631026?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[自行開發的檔案分享應用程式 - Shacial]]></title>
    <link href="http://pro.ctlok.com/2012/02/shacial-web-application.html"/>
    <updated>2012-02-28T18:21:00+08:00</updated>
    <id>http://pro.ctlok.com/2012/02/shacial-web-application</id>
    <content type="html"><![CDATA[用了 3 個多月時間，終於完成了這個應用程式。<br /><br />這個應用程式是一個網路硬碟，但不像一般網路硬碟只是拿來備份東西或發放某些東西，<b>Shacial</b> 著重於分享的功能，雖然現在還有很大部份功能仍然開發中，但基本的功能如: 共同協作、傳送檔案、圖片空間或公開檔案等等已經完成。<br /><br />背後儲存檔案的是 <b>Amazon S3</b> 加上 <b>EC2</b> 作為 <b>Web Server</b>，速度有一定保證。<br /><br />希望各位網友能夠試用這個應用程式並給小弟一點點意見。<br /><br />現時測試為每一個用戶提供 <b>2GB</b> 的空間，並不設類型限制和單一檔案容量上限 (只要不超過配額就可以上載)。<br /><br /><a href="http://www.shacial.com/">http://www.shacial.com/</a><br /><br />如有任何問題可用電子郵件聯絡我。<br /><br />2012-03-11: 提供 Facebook 和 Google account 登入<br /><br />測試貼圖:<br />193 KB<br /><a href="http://www.shacial.com/f/12/logo-java-blue.png"><img src="http://www.shacial.com/f/12/logo-java-blue.png" style="width:30%;height:30%" /></a><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-3995517410954114390?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[介紹一款 CSS 模組化工具 - LESS]]></title>
    <link href="http://pro.ctlok.com/2012/01/css.html"/>
    <updated>2012-01-31T16:38:00+08:00</updated>
    <id>http://pro.ctlok.com/2012/01/css</id>
    <content type="html"><![CDATA[<a href="http://1.bp.blogspot.com/-VdakltfXtKs/TyejMYxi6VI/AAAAAAAAA9I/3b5zk3zpi-4/s1600/logo%255B1%255D.png" imageanchor="1" style=""><img border="0" height="81" width="199" src="http://1.bp.blogspot.com/-VdakltfXtKs/TyejMYxi6VI/AAAAAAAAA9I/3b5zk3zpi-4/s400/logo%255B1%255D.png" /></a><br /><br />網站需要一個漂亮的介面來將資訊帶給用戶，開發這個介面除了要使用 <b>HTML Tag</b> 外，亦需要使用 <b>Cascading Style Sheets (CSS)</b> 去令這個介面更美觀。有人說: 你只要複製一次程式碼其實亦是複製了一個 <b>Bug</b>，所以我們在設計程式時也盡量不要將相同的程式碼複製到不同地方，在 <b>Java</b> 可以將一些程式碼包裝成 <b>Object</b> 以便不同地方也使用同一組程式碼，但在 <b>CSS</b> 又怎麼辦? 使用外部的 <b>CSS</b> 檔案其實已經很大程度地減少重複的外觀設置程式碼，但這仍然不足夠。<br /><br />今次介紹的工具能夠在 <b>CSS</b> 設置一些常用參數，外觀設置程式碼的組合，簡單的算法和使用 <b>Javascript</b> 功能等等。這款工具就是 <b>LESS</b> 了。<br /><br />以下例子可以對比普通 <b>CSS</b> 和 <b>LESS CSS</b> 的不同。<br /><br />參數:<br /><br />普通 <b>CSS</b>:<br /><pre class="brush:css">.header{<br />    background-color: #777;<br />    color: #f5f5f5;<br />}<br /><br />a{<br />    color: #777;<br />}<br /><br />p.desc{<br />    border: solid 1px #777;<br />    color: #777;<br />}<br /></pre><br />以上的 <b>CSS</b> 出現了好幾次 <b>#777</b> 這個顏色設置，如果網頁樣式改變了，需要將灰色設置為淺一點的灰色，只好一個一個 <b>#777</b> 找出來加以修改。<br /><br />使用 <b>LESS</b> 可以:<br /><pre class="brush:css">@gray: #777;<br />@smoke-white: #f5f5f5;<br />.header{<br />    background-color: @gray;<br />    color: @smoke-white;<br />}<br /><br />a{<br />    color: @gray;<br />}<br /><br />p.desc{<br />    border: solid 1px @gray;<br />    color: @gray;<br />}<br /></pre><br />這樣只需將 @gray 參數改變就可以一次轉換所有灰色了。<br /><br />除了參數還可以組合外觀設置程式碼:<br /><br />普通 <b>CSS</b>:<br /><pre class="brush:css">.header{<br />    border-radius: 5px;<br />    -moz-border-radius: 5px;<br />    -webkit-border-radius: 5px;<br />}<br /><br />ul.stack li{<br />    border-radius: 3px;<br />    -moz-border-radius: 3px;<br />    -webkit-border-radius: 3px;<br />}<br /></pre><br /><b>LESS CSS</b>:<br /><pre class="brush:css">.border-radius (@radius 5px) {<br />    border-radius: @radius;<br />    -moz-border-radius: @radius;<br />    -webkit-border-radius: @radius;<br />}<br /><br />.header{<br />    .border-radius;<br />}<br /><br />ul.stack li{<br />    .border-radius(3px);<br />}<br /></pre><br />因為不同的瀏覽器設置圓角的程式碼也不同，如果以後又有一款新瀏覽器提供圓角的樣式，就可以加一句到 .border-radius 就完成所有設置，方便得多。<br /><b>LESS</b> 的組合外觀設置程式碼提供了傳入參數和默認參數。<br /><br /><b>LESS</b> 可以令 <b>CSS</b> 程式碼更直觀:<br /><br />普通 <b>CSS</b>:<br /><pre class="brush:css">.header p{<br />    background-color: #777;<br />}<br /><br />.header p span{<br />    font-size: 18px;<br />}<br /><br />.header p span.brand a{<br />    color: #ccc;<br />}<br /><br />.header p span.brand a:hover{<br />    color: #f5f5f5;<br />}<br /></pre><br /><b>LESS CSS</b>:<br /><pre class="brush:css">.header{<br />    p{<br />        background-color: #777;<br /><br />        span{<br />            font-size: 18px;<br /><br />            &.brand{<br />                a{<br />                    color: #ccc;<br /><br />                    &:hover{<br />                        color: #f5f5f5;<br />                    }<br />                }<br />            }<br />        }<br />    }<br />}<br /></pre><br />這樣可以更加清楚知道 <b>.header</b> 內的所有風格。<br /><br />如要使用 <b>LESS</b> 有 <b>2</b> 種方法:<br /><ul><li>使用 <b>less.js</b> 在瀏覽器將 <b>LESS CSS</b> 轉換為普通 <b>CSS</b></li><li>下載 <b>Node.js</b> 然後使用 <b>npm</b> 去下載 <b>LESS</b> 並使用 <b>Command</b> 將 <b>LESS CSS</b> 轉換為普通 <b>CSS</b></li></ul><br />第一個方法在開發環境使用還好，在真實環境建議使用第 2 種方法。<br /><br />我弄了一個 <b>Node.js</b> 的 <b>script</b> 以方便大量轉換 <b>CSS</b>，有興趣可拿去用:<br /><pre class="brush:js">#!/usr/bin/env node<br /><br />var sys = require(&#39;util&#39;)<br />var fs = require(&#39;fs&#39;);<br />var less = require(&#39;less&#39;);<br /><br />var targetDir = &#39;public&#39;;<br />var currentDir = &#39;source&#39;;<br /><br />convertResource(currentDir);<br /><br />function convertResource(dirName){<br />    fs.readdir(dirName, function(err, files){<br />        if (err){<br />            console.log(err);<br />            return;<br />        }<br />        for (var i = 0; i &lt; files.length; i++){<br />            (function(){<br />                var sourceFile = dirName + &quot;/&quot; + files[i];<br />                var targetFile = sourceFile.replace(currentDir, targetDir);<br />                fs.lstat(sourceFile, function(e, stats){<br />                    if (stats.isDirectory()){<br />                        if (!isFileExist(targetFile)){<br />                            fs.mkdirSync(targetFile);<br />                        }<br />                        convertResource(sourceFile);<br />                    }else{<br />                        if (sourceFile.match(/^(.*)(\.css|\.less)$/i)){<br />                            complieCss(sourceFile, targetFile.replace(/^(.*)(\.css|\.less)$/i, &quot;$1.css&quot;));<br />                        }else{<br />                            var is = fs.createReadStream(sourceFile)<br />                            var os = fs.createWriteStream(targetFile);<br />                            sys.pump(is, os);<br />                        }<br />                    }<br />                });<br />            })();<br />        }<br />    });<br />}<br /><br />function complieCss(sourceFile, targetFile){<br />    fs.readFile(sourceFile, &quot;utf-8&quot;, function(e, data){<br />        new(less.Parser)({<br />            paths: [&quot;.&quot;, sourceFile.substring(0, sourceFile.lastIndexOf(&#39;/&#39;))],<br />            filename: sourceFile<br />        }).parse(data, function (err, tree) {<br />            if (err) {<br />                console.log(err);<br />            } else {<br />                try {<br />                    css = tree.toCSS({<br />                        yuicompress: true<br />                    });<br />                    if (targetFile) {<br />                        if (isFileExist(targetFile)){<br />                            fs.unlinkSync(targetFile);<br />                        }<br />                        var fd = fs.openSync(targetFile, &quot;w&quot;);<br />                        fs.writeSync(fd, css, 0, &quot;utf8&quot;);<br />                    }else{<br />                        sys.print(css);<br />                    }<br />                } catch (e) {<br />                    console.log(&quot;CSS file complie error. Ignore file: &quot; + sourceFile);<br />                }<br />            }<br />        });<br />    });<br />}<br /><br />function isFileExist (path) { <br />    try { <br />        fs.statSync(path); <br />        return true;<br />    } catch (e) { <br />        return false;<br />    } <br />}<br /></pre><br />更多的用法可在 <b>LESS</b> 官網找到:<br />官網: <a href="http://lesscss.org/">http://lesscss.org/</a><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-5259934493976644480?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[助你快速開發網站的 Twitter Bootstrap]]></title>
    <link href="http://pro.ctlok.com/2011/12/speed-up-develop-web-site-twitter.html"/>
    <updated>2011-12-28T23:00:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/12/speed-up-develop-web-site-twitter</id>
    <content type="html"><![CDATA[<a href="http://a1.twimg.com/profile_images/1540251533/bootstrap-avatar_reasonably_small.png" imageanchor="1" style=""><img border="0" height="72" width="72" src="http://a1.twimg.com/profile_images/1540251533/bootstrap-avatar_reasonably_small.png" /></a><br /><br /><b>Twitter Bootstrap</b> 有點像以前曾經介紹過的 <a href="http://pro.ctlok.com/2010/07/css-framework-blueprint.html">Blueprint</a> 和 <a href="http://960.gs/">960 Grid System</a> 這類的 <b>CSS Framework</b>。<b>Twitter Bootstrap</b> 一樣是能夠幫助你快速設置好網頁佈局的一個 <b>Framework</b>，那這個 <b>Twitter Bootstrap</b> 和前 2 者有什麼分別呢？<br /><br />介面對一個網站是極奇重要的，就算你背後的程式有多強多勁，但沒有一個好的介面也是會把用戶趕走的。<b>Twitter Bootstrap</b> 不單只幫助你設置網頁佈局，亦提供了一體化的介面及一些常用的網頁元件，這些元件都經過精心設計，就算不懂任何任何圖像軟件也能砌出一個美觀的網站（我一直最對網站設計最感頭痛的就是整體一致化）。<br /><b>CSS</b> 元件方面有：<br /><ol><li>網頁佈局的 <b>Grid</b> (有 <b>Fixed layout</b> 和 <b>Fluid layout</b>）</li><li>常用標題大小設置 <b>Typography</b></li><li>列舉 <b>List</b></li><li>提示貼紙 <b>Inline labels</b></li><li>媒體框架 <b>Media grid</b></li><li><b>Table</b></li><li><b>Input box</b></li><li><b>Select box</b></li><li>按鈕 <b>Button</b></li><li>導航列 <b>Navigation bar</b></li><li>標籤 <b>Taps</b></li><li>顯示層級目錄的元件 <b>Breadcrumbs</b></li><li>頁數工具 <b>Pagination</b></li><li>提示 <b>Alerts & Errors</b></li></ol><br />除了 <b>CSS</b> 外元件外，<b>Twitter Bootstrap</b> 亦包括了一些 <b>Javascript</b> 元件：<br /><ol><li>對話框 <b>Modals</b></li><li><b>Tooltips</b></li><li><b>Popovers</b></li></ol><br />元件方面真的比其他 <b>CSS Framework</b> 多太多了，使用了 <b>Twitter Bootstrap</b> 都可以做出一個不太差的網站。<br /><br />因為有些元件和我現有的 <b>CSS</b> 相衝，還是看示範比較好。<br /><br />有興趣可到 <a href="http://twitter.github.com/bootstrap/">http://twitter.github.com/bootstrap/</a> 玩玩看示範。<br />下載可到 <a href="https://github.com/twitter/bootstrap">https://github.com/twitter/bootstrap</a>。<br />到目前為止最新穩定版本是 <b>1.4</b>。<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-6552671825896734268?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[自訂 EclipseLink Logger]]></title>
    <link href="http://pro.ctlok.com/2011/12/customize-eclipselink-logger.html"/>
    <updated>2011-12-19T16:02:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/12/customize-eclipselink-logger</id>
    <content type="html"><![CDATA[<div class="separator" style="clear: both; text-align: center;"><a href="http://www.eclipse.org/eclipselink/images/logos/eclipselink-logo.png" imageanchor="1" style=""><img border="0" height="71" width="242" src="http://www.eclipse.org/eclipselink/images/logos/eclipselink-logo.png" /></a></div><br /><br />預設的 <b>EclipseLink logger</b> 是會將所有訊息都會打印到 <b>System.out</b> 去，但 <b>System.out</b> 的記錄通常很難查找。如果不同的應用程式都在同一台 <b>Server</b> 上運行就更加混亂，不同的應用程式都會向 <b>System.out</b> 送出資料，根本不能拿來分析特定一個應用程式的行為。通常做法是會將不同的應用程式都設定不同的日誌檔案，以便分析。<br /><br />要將 <b>EclipseLink</b> 的日誌寫到自己的日誌檔案是很簡單的，只需 <b>Extend</b> <b>org.eclipse.persistence.logging.AbstractSessionLog</b> 這個 <b>class</b>，並且實現 <b>public void log(SessionLogEntry sessionLogEntry)</b> 就可以了，以下有一個例子是將 <b>EclipseLink</b> 的日誌經由 <b>Slf4j</b> 傳送到自訂的日誌檔案中。<br /><br /><pre class="brush: java">package com.ctlok.pro.log<br /><br />import org.eclipse.persistence.logging.AbstractSessionLog;<br />import org.eclipse.persistence.logging.SessionLogEntry;<br /><br />import org.slf4j.Logger;<br />import org.slf4j.LoggerFactory;<br /><br />public class MyEclipseLinkLogger extends AbstractSessionLog {<br />    <br />    private static final Logger logger = LoggerFactory.getLogger(MyEclipseLinkLogger.class);<br />    <br />    @Override<br />    public void log(SessionLogEntry sessionLogEntry) {<br />        switch (sessionLogEntry.getLevel()) {<br />        case SEVERE:<br />            logger.error(sessionLogEntry.getMessage());<br />            break;<br />        case WARNING:<br />            logger.warn(sessionLogEntry.getMessage());<br />            break;<br />        case INFO:<br />            logger.info(sessionLogEntry.getMessage());<br />            break;<br />        case FINE:<br />        default:<br />            logger.debug(sessionLogEntry.getMessage());<br />        }<br />    }<br />    <br />}<br /></pre><br />然後在 persistence.xml 的 propertiese 中加上:<br /><pre class="brush:xml">&lt;property name=&quot;eclipselink.logging.logger&quot; value=&quot;com.ctlok.pro.log.MyEclipseLinkLogger &quot;/&gt;<br /></pre><br />這樣就可以令 <b>EclipseLink</b> 使用自訂的 <b>Logger</b> 去打印日誌了。<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-5255208762444246598?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP CodeIgniter 根據瀏覽器語言來顯示語言]]></title>
    <link href="http://pro.ctlok.com/2011/12/php-codeigniter-i18n-browser-locale.html"/>
    <updated>2011-12-18T16:48:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/12/php-codeigniter-i18n-browser-locale</id>
    <content type="html"><![CDATA[<a href="http://smashingweb.ge6.org/wp-content/uploads/2009/08/codeigniter-lg.gif" imageanchor="1" style=""><img border="0" height="200" width="200" src="http://smashingweb.ge6.org/wp-content/uploads/2009/08/codeigniter-lg.gif" /></a><br /><br /><br />近排為客戶製作一個網頁，因為客戶已經買下了虛擬主機空間，不能用 <b>Java</b> 去作 <b>Server side language</b>，只好使用 <b>PHP + CodeIgniter</b>。他要求有轉換語言的功能，但發覺 <b>CodeIgniter</b> 本身的 <b>i18n</b> 功能不太完善，只好自己製作一個。<br /><br />這個 <b>i18n</b> 有點像 <b>JSF</b> 的<b>i18n</b> 功能，是根據用戶的瀏覽器語言來判定顯示那一種語言，並且對 <b>Controller</b> 控制語言的程式碼減少(可以 1 行程式碼也不用寫就能夠自動設換各種語言)。這可以減少重複的程式碼和減低 <b>Controller</b> 的複雜性。<br /><br />我己經將這個 <b>Library</b> 放上 <b>github</b> 了，有興趣可以下載來試試 <a href="https://github.com/lawrence0819/php-ci-internationalization">https://github.com/lawrence0819/php-ci-internationalization</a>。<br /><br />以下就是 <b>I18n.php (Core)</b>，放到 <b>application/libraries/I18n.php</b>。<br /><pre class="brush:php">&lt;?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br /><br />/**<br /> * I18n class<br /> *<br /> * @package     CodeIgniter<br /> * @subpackage  Libraries<br /> * @category    Libraries<br /> * @author      Lawrence Cheung<br /> * @version     1.0<br /> * @link        https://github.com/lawrence0819<br /> */<br />class I18n{<br />    <br />    protected $CI;<br />    protected $auto = TRUE;<br />    protected $loaded = FALSE;<br />    protected $locale;<br />    <br />    /**<br />     * Constructor - get CI instance<br />     *<br />     */<br />    public function __construct(){<br />        $this -&gt; CI = get_instance(); <br />    }<br />    <br />    /**<br />     * Auto load language for CI HOOK<br />     *<br />     * @access  public<br />     * @return  void<br />     */<br />    public function auto_load_language(){<br />        if ($this -&gt; auto){<br />            $this -&gt; load_language();<br />        }<br />    }<br />    <br />    /**<br />     * Manual load language file<br />     *<br />     * @access  public<br />     * @return  void<br />     */<br />    public function load_language() {<br />        $lang = $this -&gt; get_current_locale();<br />        $language = $this -&gt; get_language_config();<br />        <br />        if (!$this -&gt; loaded) {<br />            $files = $language['files'];<br />            $locale = $language['locale'];<br /><br />            if (array_key_exists($lang, $locale)) {<br />                $folder = $locale[$lang];<br />            } else {<br />                $shortLang = substr($lang, 0, 2);<br />                if (array_key_exists($shortLang, $locale)) {<br />                    $folder = $locale[$shortLang];<br />                } else {<br />                    $folder = $locale['default'];<br />                }<br />            }<br /><br />            foreach ($files as $file) {<br />                $this -&gt; CI -&gt; lang -&gt; load($file, $folder);<br />            }<br />            <br />            $this -&gt; loaded = TRUE;<br />        }<br />    }<br />    <br />    /**<br />     * Prevent CI Hook to auto load language file<br />     *<br />     * @access  public<br />     * @return  void<br />     */<br />    public function prevent_auto(){<br />        $this -&gt; auto = FALSE;<br />    }<br />    <br />    /**<br />     * Set current user locale and save locale to cookies<br />     *<br />     * @access  public<br />     * @Param   string      the locale string: en-US, en-UK, zh-TW, zh-CN<br />     * @Param   integer     the cookies value expire time, default is 30 day<br />     * @Param   string      cookies key<br />     * @return  void<br />     */<br />    public function set_current_locale($locale, $expire = 259200, $cookie_key = 'locale') {<br />        setcookie($cookie_key, $locale, time() + $expire);<br />        $this -&gt; locale = $locale;<br />    }<br />    <br />    /**<br />     * Get current user locale<br />     *<br />     * @access  public<br />     * @Param   string      cookies key, if you changed the key at set_current_locale, please assign it<br />     * @return  string<br />     */<br />    public function get_current_locale($cookie_key = 'locale') {<br />        if (!$this -&gt; locale){<br />            if (isset($_COOKIE[$cookie_key])) {<br />                $lang = $_COOKIE[$cookie_key];<br />            } else {<br />                if (isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])) {<br />                    $lang = substr($_SERVER['HTTP_ACCEPT_LANGUAGE'], 0, 5);<br />                } else {<br />                    $language = $this -&gt; get_language_config();<br />                    $lang = $language['default_locale'];<br />                }<br />            }<br />            $this -&gt; locale = $lang;<br />        }<br />        return $this -&gt; locale;<br />    }<br />    <br />    /**<br />     * Get configuration values<br />     *<br />     * @access  default<br />     * @return  array<br />     */<br />    function get_language_config(){<br />        $this -&gt; CI -&gt; config -&gt; load('i18n');<br />        return $this -&gt; CI -&gt; config -&gt; item('language');<br />    }<br />    <br />}<br /><br />/* End of file I18n.php */<br />/* Location: ./application/libraries/I18N.php */<br /></pre><br />以下的是所需要的設定檔案 <b>i18n.php (Core)</b>，放到 <b>application/config/i18n.php</b>。<br /><pre class="brush:php">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');<br /><br />/**<br /> * I18n library configuration file<br /> *<br /> * @package     CodeIgniter<br /> * @subpackage  Libraries<br /> * @category    Libraries<br /> * @author      Lawrence Cheung<br /> * @version     1.0<br /> * @link        https://github.com/lawrence0819<br /> */<br /><br />//Add file in this array, if you want I18n library auto load them<br />$config['language']['files'] = array('messages');<br /><br />//If user locale not found, set this valus as a defaul user locale<br />$config['language']['default_locale'] = 'en';<br /><br />//Default language folder, if locale folder not found<br />$config['language']['locale']['default'] = 'tchinese';<br /><br />//zh-CN locale mapped to schinese folder<br />$config['language']['locale']['zh-CN'] = 'schinese';<br /><br />//zh-TW locale mapped to tchinese folder<br />$config['language']['locale']['zh-TW'] = 'tchinese';<br /><br />//en locale mapped to schinese folder<br />$config['language']['locale']['en'] = 'english';<br /><br />/* End of file i18n.php */<br />/* Location: ./application/config/i18n.php */<br /></pre><br />英文語言檔 <b>messages_lang.php</b>，放到 <b>application/language/english/messages_lang.php</b><br /><pre class="brush:php">&lt;?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br /><br />$lang['site_name'] = 'Example site';<br />$lang['message'] = 'Hello World!';<br /><br />/* End of file messages_lang.php */<br />/* Location: ./application/language/english/messages_lang.php */<br /></pre><br />正體中文語言檔 <b>messages_lang.php</b>，放到 <b>application/language/tchinese/messages_lang.php</b><br /><pre class="brush:php">&lt;?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br /><br />$lang['site_name'] = '範例網站';<br />$lang['message'] = '世界，你好！';<br /><br />/* End of file messages_lang.php */<br />/* Location: ./application/language/tchinese/messages_lang.php */<br /></pre><br />簡體中文語言檔 <b>messages_lang.php</b>，放到 <b>application/language/schinese/messages_lang.php</b><br /><pre class="brush:php">&lt;?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');<br /><br />$lang['site_name'] = '范例网站';<br />$lang['message'] = '世界，你好！';<br /><br />/* End of file messages_lang.php */<br />/* Location: ./application/language/schinese/messages_lang.php */<br /></pre><br /><br />設定就完成了，如果你有更多語言或不使用 <b>english</b>，<b>tchinese</b>，<b>schinese</b> 的名稱，請更改 <b>application/config/i18n.php</b>。<br /><br /><br />使用方法如下:<br /><br />手動選擇語言的 <b>Controller</b>:<br /><pre class="brush:php">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');<br /><br />class I18nmanual extends CI_Controller{<br /><br />    public function __construct(){<br />        parent::__construct();<br />        $this -&gt; load -&gt; library('i18n');<br />    }<br />    <br />    public function index(){<br />        $this -&gt; i18n -&gt; load_language();<br />        $this -&gt; load -&gt; view('i18ntest');<br />    }<br />    <br />}<br /><br />/* End of file i18nmanual.php */<br />/* Location: ./application/controller/i18nmanual.php */<br /></pre><br /><b>View</b>:<br /><pre class="brush:php">&lt;html&gt;<br />    &lt;head&gt;<br />        &lt;title&gt;&lt;?php echo $this-&gt;lang-&gt;line('site_name'); ?&gt;&lt;/title&gt;<br />    &lt;/head&gt;<br />    &lt;body&gt;<br />        &lt;?php echo $this-&gt;lang-&gt;line('message'); ?&gt;<br />    &lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br />將會見到和 <b>Browser</b> 相對應的語言。<br /><br />如果覺得要在 __construct 內加上<br /><pre class="brush:php">$this -&gt; load -&gt; library('i18n');<br /></pre><br />太麻煩，可以在 <b>application/config/autoload.php</b> 自動載入 <b>i18n library</b>:<br /><pre class="brush:php">$autoload['libraries'] = array('i18n');<br /></pre><br />開啟全自動的功能要先在 <b>application/config/config.php</b> 更改以下程式碼:<br /><pre class="brush:php">$config['enable_hooks'] = TRUE;<br /></pre><br />再將 <b>application/config/hooks.php</b> 加入以下程式碼:<br /><pre class="brush:php">$hook['post_controller_constructor'][] = array(<br />                                'class'    =&gt; 'I18n',<br />                                'function' =&gt; 'auto_load_language',<br />                                'filename' =&gt; 'I18n.php',<br />                                'filepath' =&gt; 'libraries'<br />                                );<br /></pre><br /><b>Controller</b>:<br /><pre class="brush:php">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');<br /><br />class I18nauto extends CI_Controller{<br /><br />    public function __construct(){<br />        parent::__construct();<br />        $this -&gt; load -&gt; library('i18n');<br />    }<br />    <br />    public function index(){<br />        $this -&gt; load -&gt; view('i18ntest');<br />    }<br />    <br />}<br /><br />/* End of file i18nauto.php */<br />/* Location: ./application/controller/i18nauto.php */<br /></pre><br />如果有設定自動載入 <b>i18n library</b>，就連 <b>__construct</b> 也不需要。<br /><br />如果開啟了全自動的功能，但有些 <b>Controller</b> 又不想自動選擇語言，可以在 <b>__construct</b> 加上:<br /><pre class="brush:php">&lt;?php if (!defined('BASEPATH')) exit('No direct script access allowed');<br /><br />class I18nmanual extends CI_Controller{<br /><br />    public function __construct(){<br />        parent::__construct();<br />        $this -&gt; load -&gt; library('i18n');<br />        //prevent auto load language<br />        $this -&gt; i18n -&gt; prevent_auto();<br />    }<br />    <br />    public function index(){<br />        $this -&gt; i18n -&gt; set_current_locale('zh-TW');<br />        $this -&gt; i18n -&gt; load_language();<br />        $this -&gt; load -&gt; view('i18ntest');<br />    }<br />    <br />}<br /><br />/* End of file i18nmanual.php */<br />/* Location: ./application/controller/i18nmanual.php */<br /></pre><br />一經切換的語系，就會自動將此更改儲存到 <b>Cookies</b>，下一次就會以 <b>Cookies</b> 的語系來選擇語言檔。<br /><br />說明完畢，有什麼問題可以留言給我。<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-5619452461244676124?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[放棄 Google App Engine 轉投 Amazon Web Service]]></title>
    <link href="http://pro.ctlok.com/2011/10/gae-aws.html"/>
    <updated>2011-10-25T18:06:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/10/gae-aws</id>
    <content type="html"><![CDATA[自從 <b>Google App Engine</b> 轉換收費模式後，已經計劃將現有的 <b>Project</b> 放到 <b>Amazon Web Service</b> 上，以前選用 <b>GAE</b> 的原因是因為便宜，而且有免費使用量。雖然限制很多，但我並不介意這些限制。例如將現有的 <b>Application</b> 移植到上 <b>GAE</b> 上是一件非常痛苦的事，<b>JPA</b> 有一大堆東西不能用，大部份 <b>Entity</b> 要重新規劃，資料移植又是另一件痛苦的事。因為每一個 <b>HTTP Request</b> 也有 30 秒限制，上傳檔案又要另外寫一次。因為價錢便宜，我不介意改。<br /><br />現在 <b>GAE</b> 有新的收費模式，不是以前只計 <b>CPU Hour</b> 的方式，是一個小時一個小時地計算。向 <b>Datasource</b> 存取資料又另外收費，新的收費模式:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-EJYNRtkgUws/TqaCTBMCXnI/AAAAAAAAA5M/68-DSN20SMk/s1600/Google%2Bcloud%2Bservices%2B%25E2%2580%2593%2BApp%2BEngine.png" imageanchor="1" style=""><img border="0" height="357" width="400" src="http://3.bp.blogspot.com/-EJYNRtkgUws/TqaCTBMCXnI/AAAAAAAAA5M/68-DSN20SMk/s400/Google%2Bcloud%2Bservices%2B%25E2%2580%2593%2BApp%2BEngine.png" /></a></div><br />新的收費模式很像 <b>Amazon Web Service</b>，我最不能接受的是 <b>GAE</b> 也跟 <b>AWS EC2</b> 以小時計算費用，<b>EC2</b> 收費如下:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-xGJOT4CKWDI/TqaEhWPZ77I/AAAAAAAAA5Y/XAQWvmUiCYM/s1600/Amazon%2BElastic%2BCompute%2BCloud%2B%2528Amazon%2BEC2%2529.png" imageanchor="1" style=""><img border="0" height="291" width="400" src="http://3.bp.blogspot.com/-xGJOT4CKWDI/TqaEhWPZ77I/AAAAAAAAA5Y/XAQWvmUiCYM/s400/Amazon%2BElastic%2BCompute%2BCloud%2B%2528Amazon%2BEC2%2529.png" /></a></div><br /><b>EC2</b> 一個小型 <b>(Small) Virtual Machine</b> 一小時才 <b>$0.085 USD</b>，<b>GAE</b> 一小時也要 <b>$0.080 USD</b>，但 <b>GAE</b> 的 <b>Virtual Machine</b> 全自動起動的，即是說你不能控制機器數目，雖然你可以設定 <b>Max Idle Instances</b> 數目，但系統在需要時也一樣會新增比你設定的最大數目還多的機器 (我試過好幾次)。如果你起動了 2 台機器，就是 <b>$0.080 USD * 2</b>，一小時收費 <b>$ 0.16 USD</b>。<b>EC2</b> 是可以一台機器放置多個 應用程式，而 <b>GAE</b> 只可以一台機器放置一個應用程式，還是 <b>EC2</b> 比較化算。<br /><br />最後如果你仍然選擇留守 <b>GAE</b>，這裡有幾個方法可幫助你省錢:<br /><br />1. 在 <b>appengine-web.xml</b> 加上:<br /><pre class="brush: xml">&lt;threadsafe&gt;true&lt;/threadsafe&gt;<br /></pre><br />可以令你的機器同時處理多個請求 <b>(Request)</b><br /><br />2. 設定 <b>Max Idle Instances</b> 令 <b>GAE</b> 盡量不起動超過這個數量的機器<br />3. 設定 <b>Min Pending Latency</b> 在機器處理一個請求超過這一個時間才新增機器 (其實我覺得這個設定很雞肋，每一個請求時間也不一樣，又不可以設定太高，亦不能設定太低)<br />4. 盡量用多一點 <b>Cache</b> ，減少存取 <b>Datasource</b><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-5183712475670212955?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用 Google Closure Compiler 在執行期間壓縮 Javascript]]></title>
    <link href="http://pro.ctlok.com/2011/10/closure-compiler-run-time-compress.html"/>
    <updated>2011-10-21T14:16:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/10/closure-compiler-run-time-compress</id>
    <content type="html"><![CDATA[趁有空又寫寫文章，今次介紹的是 <b>Google Closure Compiler</b>，其實之前已經介紹過一次: <a href="http://pro.ctlok.com/2010/01/javascript_22.html">線上 <b>Javascript</b> 工具</a>，這個工具可以將 <b>Javascript</b> 的大小大幅降低。<br /><br />使用線上工具去壓縮有一個缺點就是要將 <b>Javascript</b> 檔案儲存成 <b>2</b> 份，1 份是原始檔案，另 1 份是經壓縮內容的 <b>Javascript</b>，因為不可能更改經壓縮過的內容，每一次更改檔案就需要更改原始檔案，然後利用 <b>Google Closure Compiler</b> 線上工具再壓縮一次，再更新壓縮內容，而且經壓縮的 <b>Javascript</b> 在瀏覽器 <b>debug</b> 亦比較困難。雖然你可以在 <b>HTML</b> 將引入的 <b>Javascript</b> 檔案改為未經壓縮然後 <b>debug</b>，但萬一忘記改回就麻煩了。<br /><br />幸好 <b>Google Closure Compiler</b> 有提供到 <b>Java</b> 使用的 <b>API</b> 來達到執行期間 <b>(Run Time)</b> 將 <b>Javascript</b> 壓縮。<br /><br />首先到 <b>Google Code</b> 下載: <a href="http://code.google.com/p/closure-compiler/downloads/list">Google Closure Compiler</a><br /><br />可用以下其中一個方法去壓縮:<br /><pre class="brush: java">protected String compress(InputStream inputStream) throws IOException{<br />    Compiler compiler = new Compiler();<br />    <br />    CompilerOptions options = new CompilerOptions();<br />    CompilationLevel.SIMPLE_OPTIMIZATIONS<br />            .setOptionsForCompilationLevel(options);<br />    <br />    JSSourceFile extern = JSSourceFile.fromCode(&quot;externs.js&quot;, &quot; &quot;);<br />    JSSourceFile input = JSSourceFile.fromInputStream(&quot;origin.js&quot;, inputStream);<br />    compiler.compile(extern, input, options);<br />    <br />    return compiler.toSource();<br />}<br /><br />protected String compress(String str) throws IOException{<br />    Compiler compiler = new Compiler();<br />    <br />    CompilerOptions options = new CompilerOptions();<br />    CompilationLevel.SIMPLE_OPTIMIZATIONS<br />            .setOptionsForCompilationLevel(options);<br />    <br />    JSSourceFile extern = JSSourceFile.fromCode(&quot;externs.js&quot;, &quot; &quot;);<br />    JSSourceFile input = JSSourceFile.fromCode(&quot;origin.js&quot;, str);<br />    compiler.compile(extern, input, options);<br />    <br />    return compiler.toSource();<br />}<br /></pre><br />其中 CompilationLevel 分別有 3 個選項:<br /><ul><li>CompilationLevel.WHITESPACE_ONLY</li><li>CompilationLevel.SIMPLE_OPTIMIZATIONS</li><li>CompilationLevel.ADVANCED_OPTIMIZATIONS</li></ul><br /><b>WHITESPACE_ONLY</b> 只會移除 <b>Javascript</b> 的空白。<br /><br /><b>SIMPLE_OPTIMIZATIONS</b> 是最常用的一種，移除 <b>Javascript</b> 的空白，而且將一些 <b>Local Variable</b> 或 <b>Local Function</b> 名稱改變，並將一些沒有用到的 <b>Variable</b> 移除，大幅提高 <b>Javascript</b> 的壓縮率。<br /><br /><b>ADVANCED_OPTIMIZATIONS</b> 是最高壓縮率的模式，將所有 <b>Variable</b> 或 <b>Function</b> 的名稱改變，有使用 <b>Javascript Framework</b> 不建議使用這個選項。<br /><br />在真實環境中我們可以加入一個 <b>Filter</b> 去將 <b>Javascript</b> 壓縮:<br /><pre class="brush: js">package com.ctlok.pro.filter;<br /><br />import java.io.IOException;<br />import java.io.InputStream;<br />import java.util.HashMap;<br />import java.util.Map;<br />import java.util.logging.Level;<br /><br />import javax.servlet.Filter;<br />import javax.servlet.FilterChain;<br />import javax.servlet.FilterConfig;<br />import javax.servlet.ServletException;<br />import javax.servlet.ServletRequest;<br />import javax.servlet.ServletResponse;<br />import javax.servlet.http.HttpServletRequest;<br />import javax.servlet.http.HttpServletResponse;<br /><br />import com.google.javascript.jscomp.CompilationLevel;<br />import com.google.javascript.jscomp.Compiler;<br />import com.google.javascript.jscomp.CompilerOptions;<br />import com.google.javascript.jscomp.JSSourceFile;<br />import com.google.javascript.jscomp.WarningLevel;<br /><br />public class ClosureCompilerFilter implements Filter {<br /><br />    //for cache<br />    private final Map&lt;String, String&gt; compressedJs = new HashMap&lt;String, String&gt;();<br />    private FilterConfig filterConfig;<br />    <br />    public void init(FilterConfig filterConfig) throws ServletException {<br />        this.filterConfig = filterConfig;<br />        <br />        //Turn off the compiler log<br />        Compiler.setLoggingLevel(Level.OFF);<br />    }<br /><br />    public void destroy() {<br /><br />    }<br /><br />    public void doFilter(ServletRequest request, ServletResponse response,<br />            FilterChain chain) throws IOException, ServletException {<br />        <br />        HttpServletRequest req = (HttpServletRequest) request;<br />        HttpServletResponse resp = (HttpServletResponse) response;<br />        <br />        String uri = req.getRequestURI();<br />        <br />        //Prevent compress the compressed Javascript, such as jquery.min.js, mootools.min.js, etc.<br />        if (!uri.matches(&quot;.*\\.min\\.js$&quot;)){<br />            String js = null;<br />            <br />            if (compressedJs.containsKey(uri)){<br />                //get from cache<br />                js = compressedJs.get(uri);<br />            }else{<br />                String contextPath = req.getContextPath();<br />                String jsPath = uri.substring(contextPath.length());<br />                <br />                //get javascript file as stream<br />                //getResourceAsStream cannot include context path<br />                InputStream inputStream = filterConfig.getServletContext().getResourceAsStream(jsPath);<br />                js = compress(inputStream);<br />                <br />                //put to cache<br />                compressedJs.put(uri, js);<br />            }<br />            <br />            resp.getWriter().write(js);<br />            return;<br />        }<br />        <br />        chain.doFilter(request, response);<br />    }<br />    <br />    protected String compress(InputStream inputStream) throws IOException{<br />        Compiler compiler = new Compiler();<br />        <br />        CompilerOptions options = new CompilerOptions();<br />        CompilationLevel.SIMPLE_OPTIMIZATIONS<br />                .setOptionsForCompilationLevel(options);<br />        WarningLevel.QUIET.setOptionsForWarningLevel(options);<br />        <br />        JSSourceFile extern = JSSourceFile.fromCode(&quot;externs.js&quot;, &quot;&quot;);<br />        JSSourceFile input = JSSourceFile.fromInputStream(&quot;origin.js&quot;, inputStream);<br />        compiler.compile(extern, input, options);<br /><br />        return compiler.toSource();<br />    }<br /><br />}<br /></pre><br />在 web.xml 加上:<br /><pre class="brush: xml">&lt;filter&gt;<br />    &lt;display-name&gt;ClosureCompilerFilter&lt;/display-name&gt;<br />    &lt;filter-name&gt;ClosureCompilerFilter&lt;/filter-name&gt;<br />    &lt;filter-class&gt;com.ctlok.pro.filter.ClosureCompilerFilter&lt;/filter-class&gt;<br />&lt;/filter&gt;<br />&lt;filter-mapping&gt;<br />    &lt;filter-name&gt;ClosureCompilerFilter&lt;/filter-name&gt;<br />    &lt;url-pattern&gt;*.js&lt;/url-pattern&gt;<br />&lt;/filter-mapping&gt;<br /></pre><br />這樣就可以令到 <b>.js</b> 結尾的 <b>Javascript</b> 檔案經壓縮再傳出去，又不會將 <b>.min.js</b> 已經壓縮過的 <b>Javascript</b> 又再壓縮一次。<br />經過壓縮後會儲存在 <b>Map</b> 內，畢竟壓縮的時間也不短。<br /><br />例如我有一個 /js/myjs.js 的檔案:<br /><pre class="brush: js">function ctlok() {<br />    var self = this;<br />    var $ = jQuery;<br /><br />     this.publicFunction = function() {<br />           localFunction();<br />      };<br /><br />     var localFunction = function() {<br />          var aaaaa = &#39;aaaaa&#39;;<br />          $(&#39;:input&#39;).val(aaaaa);<br />     };<br />}<br /></pre><br />經壓縮後變成:<br /><pre class="brush: js">function ctlok(){var a=jQuery;this.publicFunction=function(){a(&quot;:input&quot;).val(&quot;aaaaa&quot;)}};<br /></pre><br />範例下載:: <a href="https://sites.google.com/site/lawrencespace/lawpronotes/download/Google-Closure-Compiler.zip">Google-Closure-Compiler.zip</a><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-3261921414800777822?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[試用 Google Cloud SQL]]></title>
    <link href="http://pro.ctlok.com/2011/10/google-cloud-sql.html"/>
    <updated>2011-10-12T15:25:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/10/google-cloud-sql</id>
    <content type="html"><![CDATA[<br /><b>Google</b> 剛剛出的新服務 - <b>Google Cloud SQL</b>，可能有太多人抱怨認為 <b>Google App Engine</b> 的 <b>Datastore</b> 太難用，而且現有的 <b>App</b> 移植到 <b>Google App Engine</b> 最大問題也是 <b>Datastore</b>。傳統的應用程式大多數使用 <b>Relational Database Management System (RDBMS)</b> 關聯式資料庫管理系統作為儲存資料的系統，但 RDBMS 是比較難去擴展整個系統，起初可以靠升級系統硬件去加強效能，但硬件升級愈高，性價比愈低。而 <b>Google App Engine</b> 的 <b>Datastore</b> 是 <b>NoSQL Database</b>，擴展系統是一件很容易的事，可以買 5 台中級機器去組成整個系統，不夠可以再加上去，可以無限地伸延 (理論上)。<b>NoSQL Database</b> 是沒有 <b>Join Table</b> 之類的語法，你只能靠應用程式層面實現 <b>Join Table</b>，這會提高應用程式開發難度。<br /><br /><b>Google Cloud SQL</b> 是用來解決傳統的應用程式移植或對使用 <b>RDBMS</b> 有開發經驗的程式員有多一個選擇。而 <b>Google Cloud SQL</b> 底層是使用 <b>MySQL</b> 實作的。<br /><br />打開 <b>Google Cloud SQL</b> 的 <b>Console</b> 是這個樣子:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-AFL_B5qOkts/TpU1gdRFDbI/AAAAAAAAA2w/w9ChEdPHgbA/s1600/Google%2BAPIs%2BConsole.png" imageanchor="1"><img border="0" height="271" src="http://2.bp.blogspot.com/-AFL_B5qOkts/TpU1gdRFDbI/AAAAAAAAA2w/w9ChEdPHgbA/s400/Google%2BAPIs%2BConsole.png" width="400" /></a></div>而容量方面有三個選擇，分別是 <b>1GB, 5GB</b> 和 <b>10GB</b><br /><div class="separator" style="clear: both; text-align: center;"><br /><a href="http://2.bp.blogspot.com/-GwMRdzzAYHc/TpU13HyeQsI/AAAAAAAAA28/JmzTqt_Vp-8/s1600/create.png" imageanchor="1"><img border="0" height="259" src="http://2.bp.blogspot.com/-GwMRdzzAYHc/TpU13HyeQsI/AAAAAAAAA28/JmzTqt_Vp-8/s400/create.png" width="400" /></a></div>試試新增一個 <b>MySQL Instance</b> (暫時只有 <b>Google App Engine</b> 可以存取到，只需加入 <b>GAE</b> 的 <b>ID</b> 就可以了):<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-Iv86h1Z3L2U/TpU2Jl8OyMI/AAAAAAAAA3I/orPzKAOFaCg/s1600/create2png.png" imageanchor="1"><img border="0" height="259" src="http://4.bp.blogspot.com/-Iv86h1Z3L2U/TpU2Jl8OyMI/AAAAAAAAA3I/orPzKAOFaCg/s400/create2png.png" width="400" /></a></div><br />處理中:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-IxvqvjC8jpY/TpU2m2NxVFI/AAAAAAAAA3U/FJl6SQ7Y9sU/s1600/proccess.png" imageanchor="1"><img border="0" height="259" src="http://4.bp.blogspot.com/-IxvqvjC8jpY/TpU2m2NxVFI/AAAAAAAAA3U/FJl6SQ7Y9sU/s400/proccess.png" width="400" /></a></div><br />完成後看一看 <b>Log</b>:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-LjLRu5ATrJA/TpU255TptoI/AAAAAAAAA3g/bNREUDBB72Y/s1600/log.png" imageanchor="1"><img border="0" height="243" src="http://4.bp.blogspot.com/-LjLRu5ATrJA/TpU255TptoI/AAAAAAAAA3g/bNREUDBB72Y/s400/log.png" width="400" /></a></div><br />再到 <b>Prompt</b> 看看:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-49KpC4a39f0/TpU3Fnw6LqI/AAAAAAAAA3s/qnBGRoU4PGI/s1600/prompt.png" imageanchor="1"><img border="0" height="259" src="http://4.bp.blogspot.com/-49KpC4a39f0/TpU3Fnw6LqI/AAAAAAAAA3s/qnBGRoU4PGI/s400/prompt.png" width="400" /></a></div><br />新增一個 <b>Database</b>，命名為 <b>mydb</b>:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-I9VIUW3JCT4/TpU3hqVeZ2I/AAAAAAAAA34/10YramRrLy0/s1600/create%2Bdb.png" imageanchor="1"><img border="0" height="259" src="http://4.bp.blogspot.com/-I9VIUW3JCT4/TpU3hqVeZ2I/AAAAAAAAA34/10YramRrLy0/s400/create%2Bdb.png" width="400" /></a></div><br />再新增一個 <b>Table</b> 命名為 <b>User:</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-r-8wljKeA54/TpU4nTtEIlI/AAAAAAAAA4E/JzBBbwSHiFg/s1600/create%2Buser.png" imageanchor="1"><img border="0" height="243" src="http://1.bp.blogspot.com/-r-8wljKeA54/TpU4nTtEIlI/AAAAAAAAA4E/JzBBbwSHiFg/s400/create%2Buser.png" width="400" /></a></div><br />我發現每一次只可以輸入一行指令，有分號隔著也不行，希望遲點會改善。<br />當然 <b>Google Cloud SQL</b> 有提供 <b>Import</b> 的功能，但檔案一定要存放在 <b>Google Cloud Storage</b> 上。<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-i504Lpps5q4/TpU7RL21tbI/AAAAAAAAA4c/NBmd8t3NNmg/s1600/import.png" imageanchor="1"><img border="0" height="243" src="http://1.bp.blogspot.com/-i504Lpps5q4/TpU7RL21tbI/AAAAAAAAA4c/NBmd8t3NNmg/s400/import.png" width="400" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-kDvbhJ22Js0/TpU7fXmKaeI/AAAAAAAAA4o/uAjXgZ-Be78/s1600/import-sql.png" imageanchor="1"><img border="0" height="243" src="http://3.bp.blogspot.com/-kDvbhJ22Js0/TpU7fXmKaeI/AAAAAAAAA4o/uAjXgZ-Be78/s400/import-sql.png" width="400" /></a></div><br /><br /><b>Import</b> 成功後就試試旗選取一埋資料:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-hVGDFOcJiSg/TpU82Jy9o4I/AAAAAAAAA40/quEBAuWWfiM/s1600/select%2Bcustomers.png" imageanchor="1" style=""><img border="0" height="400" width="116" src="http://1.bp.blogspot.com/-hVGDFOcJiSg/TpU82Jy9o4I/AAAAAAAAA40/quEBAuWWfiM/s400/select%2Bcustomers.png" /></a></div><br />再試試 <b>Join Table</b>:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-6nsvacH9BV0/TpU93-bZ4wI/AAAAAAAAA5A/SDrou4QGvHU/s1600/join%2Btable%2Border%2Border%2Bdetail.png" imageanchor="1" style=""><img border="0" height="400" width="74" src="http://4.bp.blogspot.com/-6nsvacH9BV0/TpU93-bZ4wI/AAAAAAAAA5A/SDrou4QGvHU/s400/join%2Btable%2Border%2Border%2Bdetail.png" /></a></div><br />一樣沒有問題。<br /><br /><b>SQL</b> 檔案: <a href="https://sites.google.com/site/lawrencespace/lawpronotes/download/sampledatabase.sql">sampledatabase.sql</a><br /><br />要申請 <b>Google Cloud SQL</b> 可到 <a href="https://code.google.com/apis/console/">https://code.google.com/apis/console/</a>，然後選取 <b>Service</b> 再在 <b>Google Cloud SQL</b> 按一下 <b>Request access</b>，填好表格後就等 <b>Google</b> 回覆就可以用了 (我是等了兩天才有回覆)。<br />遲一點再在 <b>GAE</b> 上試用。<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-8575963009302117038?l=lawpronotes.blogspot.com' alt='' /></div>
]]></content>
  </entry>
  
</feed>
