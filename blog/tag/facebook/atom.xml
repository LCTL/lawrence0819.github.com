<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Facebook | Programming Design Notes]]></title>
  <link href="http://pro.ctlok.com/blog/tag/facebook/atom.xml" rel="self"/>
  <link href="http://pro.ctlok.com/"/>
  <updated>2012-03-25T15:08:54+08:00</updated>
  <id>http://pro.ctlok.com/</id>
  <author>
    <name><![CDATA[Lawrence Cheung]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[使用 Java 開發 Facebook Web App - 3]]></title>
    <link href="http://pro.ctlok.com/2010/06/facebook-java-get-user-friend.html"/>
    <updated>2010-06-14T14:46:00+08:00</updated>
    <id>http://pro.ctlok.com/2010/06/facebook-java-get-user-friend</id>
    <content type="html"><![CDATA[<p>上一回:&nbsp;<a href="http://pro.ctlok.com/2010/06/java-develop-facebook-web-app-2.html">使用 Java 開發 Facebook Web App - 2</a><br /><br />今次我們將 IndexServlet 修改一下，不再顯示 Hello World，改為顯示用戶朋友的資料，這個功能應該是非常常用的。<br /><br />首先將 IndexServlet 的 doGet 清空，並加入以下程式碼:<br /><pre class="brush: java">protected void doGet(HttpServletRequest request,<br />        HttpServletResponse response) throws ServletException, IOException {<br />    HttpSession session = request.getSession();<br />    FacebookXmlRestClient xmlClient = FacebookFilter.getUserClient(session);<br />}<br /></pre><br />首先先取得用戶的 FacebookXmlRestClient，利用 FacebookXmlRestClient 提供的方法去存取用戶資料。而我比較喜歡用 FacebookJaxbRestClient，FacebookJaxbRestClient 可以將 Facebook 回傳的 XML 自動轉為 Java Object。<br /><br />對這種技術有興趣的朋友可以參考以下網址。<br />Java Architecture for XML Binding (JAXB): <a href="http://java.sun.com/developer/technicalArticles/WebServices/jaxb/">http://java.sun.com/developer/technicalArticles/WebServices/jaxb/</a><br /><br />那怎麼將 FacebookXmlRestClient 轉為使用 FacebookJaxbRestClient? 轉換方法非常簡單，加入以下程式碼:<br /><pre class="brush: java">FacebookJaxbRestClient jaxbClient = new FacebookJaxbRestClient(<br />        xmlClient.getApiKey(), xmlClient.getSecret(), xmlClient<br />                .getCacheSessionKey());<br /></pre><br />設定好 Rest Client 後可以開始進入正題，存取朋友資料前要先知道朋友的 ID 才行，以下程式碼是拿取用戶所有朋友 ID 後再將 ID 放到 List 內。<br /><pre class="brush: java">try {<br /><br />    // Get user friend list<br />    FriendsGetResponse friendResponse = (FriendsGetResponse) jaxbClient<br />            .friends_get(jaxbClient.getCacheUserId());<br />    List&lt;Long&gt; friends = friendResponse.getUid();<br />} catch (FacebookException e) {<br />    e.printStackTrace();<br />}<br /></pre><br />現在有一個 List 裝了所有的 ID，那便可以批次地拿到相對應 ID 的用戶資料。在這裡我只選擇拿取用戶 ID，名稱，性別和生日日期。<br /><pre class="brush: java">// Get friend info<br />UsersGetInfoResponse userResponse = jaxbClient.users_getInfo(<br />        friends, EnumSet.of(ProfileField.UID, ProfileField.NAME, ProfileField.SEX,<br />                ProfileField.BIRTHDAY));<br />List&lt;User&gt; friendsInfo = userResponse.getUser();<br /></pre><br />ProfileField API: <a href="http://mrepo.happyfern.com/sites/facebook-java-api/facebook-java-api/apidocs/index.html">ProfileField </a><br /><br />現在我們已經拿到用戶資料了。再來便是將資料傳給 JSP，讓 JSP 顯示出來。<br /><pre class="brush: java">Map&lt;String, Object&gt; model = new HashMap&lt;String, Object&gt;();<br />model.put(&quot;friendsInfo&quot;, friendsInfo);<br />request.setAttribute(&quot;model&quot;, model);<br /><br />RequestDispatcher dispatcher = request<br />        .getRequestDispatcher(&quot;/WEB-INF/pages/index.jsp&quot;);<br /><br />dispatcher.forward(request, response);<br /></pre><br />完整的 IndexServlet:<br /><pre class="brush: java">package com.blogspot.lawpronotes.servlet;<br /><br />import java.io.IOException;<br />import java.util.EnumSet;<br />import java.util.HashMap;<br />import java.util.List;<br />import java.util.Map;<br /><br />import javax.servlet.RequestDispatcher;<br />import javax.servlet.ServletException;<br />import javax.servlet.http.HttpServlet;<br />import javax.servlet.http.HttpServletRequest;<br />import javax.servlet.http.HttpServletResponse;<br />import javax.servlet.http.HttpSession;<br /><br />import com.blogspot.lawpronotes.filter.FacebookFilter;<br />import com.google.code.facebookapi.FacebookException;<br />import com.google.code.facebookapi.FacebookJaxbRestClient;<br />import com.google.code.facebookapi.FacebookXmlRestClient;<br />import com.google.code.facebookapi.ProfileField;<br />import com.google.code.facebookapi.schema.FriendsGetResponse;<br />import com.google.code.facebookapi.schema.User;<br />import com.google.code.facebookapi.schema.UsersGetInfoResponse;<br /><br />/<em>*<br /> * Servlet implementation class IndexServlet<br /> </em>/<br />public class IndexServlet extends HttpServlet {<br />    private static final long serialVersionUID = 1L;<br /><br />    public IndexServlet() {<br />        super();<br />    }<br /><br />    protected void doGet(HttpServletRequest request,<br />            HttpServletResponse response) throws ServletException, IOException {<br />        HttpSession session = request.getSession();<br />        FacebookXmlRestClient xmlClient = FacebookFilter.getUserClient(session);<br />        FacebookJaxbRestClient jaxbClient = new FacebookJaxbRestClient(<br />                xmlClient.getApiKey(), xmlClient.getSecret(), xmlClient<br />                        .getCacheSessionKey());<br />        try {<br /><br />            // Get user friend list<br />            FriendsGetResponse friendResponse = (FriendsGetResponse) jaxbClient<br />                    .friends_get(jaxbClient.getCacheUserId());<br />            List&lt;Long&gt; friends = friendResponse.getUid();<br /><br />            // Get friend info<br />            UsersGetInfoResponse userResponse = jaxbClient.users_getInfo(<br />                    friends, EnumSet.of(ProfileField.UID, ProfileField.NAME,<br />                            ProfileField.SEX, ProfileField.BIRTHDAY));<br />            List&lt;User&gt; friendsInfo = userResponse.getUser();<br /><br />            Map&lt;String, Object&gt; model = new HashMap&lt;String, Object&gt;();<br />            model.put(&quot;friendsInfo&quot;, friendsInfo);<br />            request.setAttribute(&quot;model&quot;, model);<br /><br />            RequestDispatcher dispatcher = request<br />                    .getRequestDispatcher(&quot;/WEB-INF/pages/index.jsp&quot;);<br />            dispatcher.forward(request, response);<br /><br />        } catch (FacebookException e) {<br />            // TODO Auto-generated catch block<br />            e.printStackTrace();<br />        }<br />    }<br />}<br /></pre><br />在 JSP 我選擇用 foreach 將所有朋友資料也列印出來，記得要加上:<br /><pre class="brush: xml">&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; <br />prefix=&quot;c&quot; %&gt;<br /></pre><br />完整的 JSP:<br /><pre class="brush: xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br />&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;<br />pageEncoding=&quot;UTF-8&quot; isELIgnored=&quot;false&quot; %&gt;<br />&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;<br /> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;<br />&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:fb=&quot;http://www.facebook.com/2008/fbml&quot;&gt;<br />    &lt;head&gt;<br />        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;<br />        &lt;title&gt;Index&lt;/title&gt;<br />    &lt;/head&gt;<br />    &lt;body&gt;<br />        &lt;table style=&quot;text-align:center;&quot;&gt;<br />            &lt;thead&gt;<br />                &lt;tr&gt;<br />                    &lt;th&gt;<br />                        Image<br />                    &lt;/th&gt;<br />                    &lt;th&gt;<br />                        Name<br />                    &lt;/th&gt;<br />     &lt;th&gt;<br />                        Sex<br />                    &lt;/th&gt;<br />     &lt;th&gt;<br />                        Birthday<br />                    &lt;/th&gt;<br />                &lt;/tr&gt;<br />            &lt;/thead&gt;<br />            &lt;c:forEach var=&quot;info&quot; items=&quot;${model[&#39;friendsInfo&#39;]}&quot;&gt;<br />                &lt;tr&gt;<br />                    &lt;td&gt;<br />                        &lt;img src=&quot;http://graph.facebook.com/${info[&#39;uid&#39;]}/picture/&quot; alt=&quot;profile image&quot; /&gt;<br />                    &lt;/td&gt;<br />                    &lt;td&gt;<br />                        ${info[&#39;name&#39;]}<br />                    &lt;/td&gt;<br />                    &lt;td&gt;<br />                        ${info[&#39;sex&#39;]}<br />                    &lt;/td&gt;<br />                    &lt;td&gt;<br />                        ${info[&#39;birthday&#39;]}<br />                    &lt;/td&gt;<br />                &lt;/tr&gt;<br />            &lt;/c:forEach&gt;<br />        &lt;/table&gt;<br />    &lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br />打開 http://apps.facebook.com/canvas_name/ 應該可以看到所有朋友的頭像，名稱，性別和生日日期。<br /><br />下一回繼續<br /><br />相關書籍: <a imageanchor="1" target="_blank"  href="http://www.amazon.com/Facebook-Dummies-Leah-Pearlman/dp/0470527617?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Facebook For Dummies" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0470527617&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0470527617" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Facebook-Cookbook-Building-Applications-Empire/dp/059651817X?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Facebook Cookbook: Building Applications to Grow Your Facebook Empire" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=059651817X&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=059651817X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Building-Facebook-Applications-Dummies-Computer/dp/0470277955?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Building Facebook Applications For Dummies (For Dummies (Computer/Tech))" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0470277955&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0470277955" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-1329939540364333915?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用 Java 開發 Facebook Web App - 2]]></title>
    <link href="http://pro.ctlok.com/2010/06/java-develop-facebook-web-app-2.html"/>
    <updated>2010-06-10T10:40:00+08:00</updated>
    <id>http://pro.ctlok.com/2010/06/java-develop-facebook-web-app-2</id>
    <content type="html"><![CDATA[<p>上一回: <a href="http://pro.ctlok.com/2010/06/java-facebook-apps-1.html">使用 Java 開發 Facebook Web App - 1</a><br /><br />上回提到使用 Filter 去將所有進來的 Request 也能夠取得用戶 ID 才可以顯示內容，拿取不到用戶 ID 會 Redirect 到 Facebook 的登入頁面，今次先試試在 Facebook 顯示 Hello World 字樣。<br /><br />新增一個 Servlet。<br />IndexServlet:<br /><pre class="brush: java">package com.blogspot.lawpronotes.servlet;<br /><br />import java.io.IOException;<br />import java.util.HashMap;<br />import java.util.Map;<br /><br />import javax.servlet.RequestDispatcher;<br />import javax.servlet.ServletException;<br />import javax.servlet.http.HttpServlet;<br />import javax.servlet.http.HttpServletRequest;<br />import javax.servlet.http.HttpServletResponse;<br /><br />/<em>*<br /> * Servlet implementation class IndexServlet<br /> </em>/<br />public class IndexServlet extends HttpServlet {<br />    private static final long serialVersionUID = 1L;<br /><br />    public IndexServlet() {<br />        super();<br />    }<br /><br />    protected void doGet(HttpServletRequest request,<br />            HttpServletResponse response) throws ServletException, IOException {<br />        <br />        Map&lt;String, Object&gt; model = new HashMap&lt;String, Object&gt;();<br />        model.put("message", "Hello World");<br />        request.setAttribute("model", model);<br /><br />        // Forward to JSP file to display message<br />        RequestDispatcher dispatcher = request<br />                .getRequestDispatcher("/WEB-INF/pages/index.jsp");<br />        dispatcher.forward(request, response);<br />    }<br />}<br /></pre><br />這個 Servlet 只作為控制器的角色，顯示方面交由 JSP 負責。<br />不懂得 MVC 架構可參考這篇: <a href="http://pro.ctlok.com/2010/02/mvc-servlet-jsp.html">最簡單的方式實現 MVC (Servlet + JSP)</a><br /><br />之後在 /WEB-INF 內新增一個 pages 目錄並建立 index.jsp 。<br />index.jsp:<br /><pre class="brush: html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;%@ page language="java" contentType="text/html; charset=UTF-8"<br />pageEncoding="UTF-8" isELIgnored="false" %&gt;<br /> &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;<br />&lt;html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml"&gt;<br />    &lt;head&gt;<br />        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;<br />        &lt;title&gt;Index&lt;/title&gt;<br />    &lt;/head&gt;<br />    &lt;body&gt;<br />        &lt;h1&gt;${ model['message'] }&lt;/h1&gt;<br />    &lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br />記得要在 html tag 加上 xmlns:fb="http://www.facebook.com/2008/fbml"<br />遲點使用 XFBML 時要用到。<br /><br />打開 http://apps.facebook.com/#your_canvas_name#/ 會見到 Hello World 字樣。<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/_fDN8R2Wgbcs/TBWPBG4w4yI/AAAAAAAAAgc/BXhquuNJS5k/s1600/java-facebook.gif" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="116" src="http://2.bp.blogspot.com/_fDN8R2Wgbcs/TBWPBG4w4yI/AAAAAAAAAgc/BXhquuNJS5k/s320/java-facebook.gif" width="320" /></a></div><br /><br />下一回: <a href="http://pro.ctlok.com/2010/06/facebook-java-get-user-friend.html">使用 Java 開發 Facebook Web App - 3</a><br /><br />相關書籍: <a href="http://www.amazon.com/Facebook-Cookbook-Building-Applications-Empire/dp/059651817X?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Facebook Cookbook: Building Applications to Grow Your Facebook Empire" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=059651817X&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=059651817X" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/FBML-Essentials-Facebook-Language-Fundamentals/dp/0596519184?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="FBML Essentials: Facebook Markup Language Fundamentals" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=0596519184&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=0596519184" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Facebook-Cookbook-Building-Applications-Empire/dp/059651817X?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Facebook Cookbook: Building Applications to Grow Your Facebook Empire" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=059651817X&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=059651817X" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-2846304609572768517?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用 Java 開發 Facebook Web App - 1]]></title>
    <link href="http://pro.ctlok.com/2010/06/java-facebook-apps-1.html"/>
    <updated>2010-06-03T13:13:00+08:00</updated>
    <id>http://pro.ctlok.com/2010/06/java-facebook-apps-1</id>
    <content type="html"><![CDATA[<p>第一步當然要先在 Facebook 建立一個應用程式。<br />網址:&nbsp;<a href="http://www.facebook.com/developers/createapp.php">http://www.facebook.com/developers/createapp.php</a><br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://3.bp.blogspot.com/_fDN8R2Wgbcs/TAy77FltOeI/AAAAAAAAAfk/HFzGKvlkSJA/s1600/java-facebook-1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="139" src="http://3.bp.blogspot.com/_fDN8R2Wgbcs/TAy77FltOeI/AAAAAAAAAfk/HFzGKvlkSJA/s320/java-facebook-1.png" width="320" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">輸入應用程式名稱和同意 Facebook 條款，按下 Create Application 到下一步。</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/_fDN8R2Wgbcs/TAy82GqzfII/AAAAAAAAAfo/Rt94KprgGKI/s1600/java-facebook-2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="102" src="http://2.bp.blogspot.com/_fDN8R2Wgbcs/TAy82GqzfII/AAAAAAAAAfo/Rt94KprgGKI/s320/java-facebook-2.png" width="320" /></a></div><br />建立完成後得到 API Key 和 Application Secret，請不要公開這 Application Secret 這項資料，別人得到了 API Key 和 Application Secret 便可以任意更改你的應用程式。<br /><br />在左邊的選單選取 Canvas。<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://3.bp.blogspot.com/_fDN8R2Wgbcs/TAy9hxixu_I/AAAAAAAAAfs/hlF90YN8IdM/s1600/java-facebook-3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="252" src="http://3.bp.blogspot.com/_fDN8R2Wgbcs/TAy9hxixu_I/AAAAAAAAAfs/hlF90YN8IdM/s320/java-facebook-3.png" width="320" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Canvas Page URL 是你的應用程式在 Facebook 的位置，每一個應用程式的 URL 都不會相同的，請輸入令人比較容易記的地址。</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Canvas Callback URL 是伺服器的位置，因為現在是試測性質，所以輸入本機的位置。如果你有自己的伺服器，可以輸入伺服器的位置，但初期測試不建議使用，因為在本機開發會比較快，待差不多完成再放上伺服器也可以。</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Post-Authorize Redirect URL 是用戶同意你的應用程式能夠存取他的資料後，Facebook 會將他跳到那一個位置。</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">在左邊的選單選取 Migrations，並將&nbsp;New Data Permissions 設為 Disable。</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://4.bp.blogspot.com/_fDN8R2Wgbcs/TA9n02XgmjI/AAAAAAAAAf0/aL8TMLAhGns/s1600/java-facebook-4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="128" src="http://4.bp.blogspot.com/_fDN8R2Wgbcs/TA9n02XgmjI/AAAAAAAAAf0/aL8TMLAhGns/s320/java-facebook-4.png" width="320" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">因為現在的 facebook-java-api 還是使用舊的 Facebook Rest Server，這個設定是給新的 Graph Api 用的。</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">按下 Save Change 儲存所有設定。</div><br />現在到 <a href="http://code.google.com/p/facebook-java-api/">facebook-java-api</a> 下載 Java 的 Facebook API Library，如果你是使用 Google App Engine 開發 Facebook 應用程式，使用官方的 Library 會有一點問題，可到這裡下載別人修改好的 <a href="http://bertrand.guiral.free.fr/facebook_generated_bg.zip">http://bertrand.guiral.free.fr/facebook_generated_bg.zip</a>。<br /><br />下載別人修改好的還要到 <a href="http://code.google.com/p/facebook-java-api/downloads/list">http://code.google.com/p/facebook-java-api/downloads/list</a> 下載依賴包。<br /><br />現在可以開始寫程式了，首先加入一個 Filter 確保所有進入這個頁面的用戶已經登入 Facebook。<br /><pre class="brush: java">package com.blogspot.lawpronotes.filter;<br /><br />import java.io.IOException;<br /><br />import javax.servlet.Filter;<br />import javax.servlet.FilterChain;<br />import javax.servlet.FilterConfig;<br />import javax.servlet.ServletException;<br />import javax.servlet.ServletRequest;<br />import javax.servlet.ServletResponse;<br />import javax.servlet.http.HttpServletRequest;<br />import javax.servlet.http.HttpServletResponse;<br />import javax.servlet.http.HttpSession;<br /><br />import org.w3c.dom.Document;<br /><br />import com.google.code.facebookapi.FacebookException;<br />import com.google.code.facebookapi.FacebookWebappHelper;<br />import com.google.code.facebookapi.FacebookXmlRestClient;<br />import com.google.code.facebookapi.IFacebookRestClient;<br /><br />public class FacebookFilter implements Filter {<br /><br />    private String api_key;<br />    private String secret;<br /><br />    public void init(FilterConfig fConfig) throws ServletException {<br />        // TODO Auto-generated method stub<br />        api_key = "your api key";<br />        secret = "your secret";<br />    }<br /><br />    public void destroy() {<br />        // TODO Auto-generated method stub<br />    }<br /><br />    public void doFilter(ServletRequest req, ServletResponse res,<br />            FilterChain chain) throws IOException, ServletException {<br />        HttpServletRequest request = (HttpServletRequest) req;<br />        HttpServletResponse response = (HttpServletResponse) res;<br /><br />        HttpSession session = request.getSession(true);<br />        IFacebookRestClient&lt;Document&gt; userClient = getUserClient(session);<br />        if (userClient == null) {<br />            userClient = new FacebookXmlRestClient(api_key, secret);<br />            session.setAttribute("facebook.user.client", userClient);<br />        }<br /><br />        FacebookWebappHelper&lt;Document&gt; facebook = new FacebookWebappHelper&lt;Document&gt;(<br />                request, response, api_key, secret, userClient);<br />        String nextPage = request.getRequestURI();<br />        nextPage = nextPage.substring(nextPage.indexOf("/", 1) + 1);<br />        boolean redirectOccurred = facebook.requireLogin(nextPage);<br /><br />        if (redirectOccurred) {<br />            return;<br />        }<br />        redirectOccurred = facebook.requireFrame(nextPage);<br />        if (redirectOccurred) {<br />            return;<br />        }<br /><br />        long facebookUserID;<br />        try {<br />            facebookUserID = userClient.users_getLoggedInUser();<br />        } catch (FacebookException ex) {</pre><pre class="brush: java">//Cannot get user's facebook ID<br />            response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR,<br />                    "Error while fetching user's facebook ID");<br />            return;<br />        }<br />        chain.doFilter(request, response);<br />    }<br /><br />    public static FacebookXmlRestClient getUserClient(HttpSession session) {<br />        return (FacebookXmlRestClient) session<br />                .getAttribute("facebook.user.client");<br />    }<br /><br />}<br /></pre><br />請自行更改 api_key 和 secret，然後在 web.xml 加上以下內容。<br /><pre class="brush: xml">&lt;filter&gt;<br />    &lt;display-name&gt;FacebookFilter&lt;/display-name&gt;<br />    &lt;filter-name&gt;FacebookFilter&lt;/filter-name&gt;<br />    &lt;filter-class&gt;com.blogspot.lawpronotes.filter.FacebookFilter&lt;/filter-class&gt;<br />&lt;/filter&gt;<br />&lt;filter-mapping&gt;<br />    &lt;filter-name&gt;FacebookFilter&lt;/filter-name&gt;<br />    &lt;url-pattern&gt;*&lt;/url-pattern&gt;<br />&lt;/filter-mapping&gt;<br /></pre><br />登出 Facebook 然後打開 <a href="http://apps.facebook.com/lawpronotes/">http://apps.facebook.com/lawpronotes/</a>&nbsp;頁面看看是否自動跳到 Facebook 登入頁面。<br /><br />下一回: <a href="http://pro.ctlok.com/2010/06/java-develop-facebook-web-app-2.html">使用 Java 開發 Facebook Web App - 2</a><br /><br />相關書籍: <a href="http://www.amazon.com/Facebook-Dummies-Leah-Pearlman/dp/0470527617?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Facebook For Dummies" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=0470527617&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=0470527617" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Facebook-Era-Networks-Products-Audiences/dp/0137152221?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="The Facebook Era: Tapping Online Social Networks to Build Better Products, Reach New Audiences, and Sell More Stuff" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=0137152221&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=0137152221" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Facebook-Missing-E-Vander-Veer/dp/0596517696?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Facebook: The Missing Manual" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=0596517696&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=0596517696" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-6365646868600068930?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Facebook 應用程式開發]]></title>
    <link href="http://pro.ctlok.com/2010/05/facebook.html"/>
    <updated>2010-05-20T23:17:00+08:00</updated>
    <id>http://pro.ctlok.com/2010/05/facebook</id>
    <content type="html"><![CDATA[<p>近來試試開發 Facebook 應用程式，弄得連打文章的時間也沒有了。<br /><br />有興趣的網友可以看看我開發的程式。<br /><br /><a href="http://apps.facebook.com/name_fight/">http://apps.facebook.com/name_fight/</a><br /><br /><a href="http://apps.facebook.com/sacreator/">http://apps.facebook.com/sacreator/</a><br /><br /><a href="http://apps.facebook.com/random-chat/">http://apps.facebook.com/random-chat/</a><br /><br />我是使用 Google App Engine 來作 Application Server，而 Library 方面則使用了 Spring Framework 3、dom4j、json、slf4j等等。 <br /><br />遲點會在這裡寫寫使用心得。<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-1255290890255331701?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
</feed>
