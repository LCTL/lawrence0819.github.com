<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Xstream | Programming Design Notes]]></title>
  <link href="http://pro.ctlok.com/blog/tag/xstream/atom.xml" rel="self"/>
  <link href="http://pro.ctlok.com/"/>
  <updated>2012-04-02T14:13:25+08:00</updated>
  <id>http://pro.ctlok.com/</id>
  <author>
    <name><![CDATA[Lawrence Cheung]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[使用 Xstream 程式庫去深層複製 Java 物件]]></title>
    <link href="http://pro.ctlok.com/2011/06/java-xstream-to-deep-clone-object.html"/>
    <updated>2011-06-13T15:54:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/06/java-xstream-to-deep-clone-object</id>
    <content type="html"><![CDATA[<p>在某些時候，為免改寫原本 <b>Object</b> 的數據，而需要複製一個一模一樣的 <b>Object</b> 出來，例如記下當時的 <b>Object</b> 狀態，然後備份等等。如果使用 <b>Getter</b> 和 <b>Setter</b> 一個一個數據去複製，一定會大大增加程式碼行數，亦只能對已知的 <b>Object</b> 去複製。當這個 <b>Object</b> 新增一項數據時，便要再重寫複製方法，所以這方法是很沒有效率的。<br /><br /><b>Xstream</b> 原本是 <b>Java</b> 操作 <b>XML</b> 的一個 <b>Library</b>，除此之外亦可以使用 <b>Xstream</b> 去複製 <b>Object</b> (將 <b>Java Object</b> 轉換成 <b>XML</b> 再轉換為 <b>Java Object</b>)。<br /><br /><b>Xstream</b> 官方網址: <a href="http://xstream.codehaus.org/">http://xstream.codehaus.org/</a><br /><br />下載後將 <b>.jar</b> 加到 <b>class path</b>。<br /><br />假設現在有 <b>Parent</b> 和 <b>Info</b> 2 個 <b>Object</b>，這 2 個 <b>Object</b> 都是作為傳遞數據的 <b>Object</b>。<br /><br /><b>Parent</b>:<br /><pre class="brush: java">package xstream.sample;<br /><br />public class Parent {<br /><br />    private String firstName;<br />    private String lastName;<br /><br />    public String getFirstName() {<br />        return firstName;<br />    }<br /><br />    public void setFirstName(String firstName) {<br />        this.firstName = firstName;<br />    }<br /><br />    public String getLastName() {<br />        return lastName;<br />    }<br /><br />    public void setLastName(String lastName) {<br />        this.lastName = lastName;<br />    }<br /><br />    @Override<br />    public String toString() {<br />        return &quot;Parent [firstName=&quot; + firstName + &quot;, lastName=&quot; + lastName<br />                + &quot;]&quot;;<br />    }<br /><br />}<br /></pre><br /><b>Info</b>:<br /><pre class="brush: java">package xstream.sample;<br /><br />import java.util.LinkedList;<br />import java.util.List;<br /><br />public class Info {<br /><br />    private String firstName;<br />    private String lastName;<br />    private int age;<br />    private List&lt;String&gt; hobbies;<br />    private Parent parent;<br />    <br />    public String getFirstName() {<br />        return firstName;<br />    }<br /><br />    public void setFirstName(String firstName) {<br />        this.firstName = firstName;<br />    }<br /><br />    public String getLastName() {<br />        return lastName;<br />    }<br /><br />    public void setLastName(String lastName) {<br />        this.lastName = lastName;<br />    }<br /><br />    public int getAge() {<br />        return age;<br />    }<br /><br />    public void setAge(int age) {<br />        this.age = age;<br />    }<br /><br />    public List&lt;String&gt; getHobbies() {<br />        return hobbies;<br />    }<br /><br />    public void setHobbies(List&lt;String&gt; hobbies) {<br />        this.hobbies = hobbies;<br />    }<br /><br />    public void addHobby(String hobby) {<br />        if (hobbies == null)<br />            hobbies = new LinkedList&lt;String&gt;();<br />        hobbies.add(hobby);<br />    }<br />    <br />    public Parent getParent() {<br />        return parent;<br />    }<br /><br />    public void setParent(Parent parent) {<br />        this.parent = parent;<br />    }<br /><br />    @Override<br />    public String toString() {<br />        return &quot;Info [firstName=&quot; + firstName + &quot;, lastName=&quot; + lastName<br />                + &quot;, age=&quot; + age + &quot;, hobbies=&quot; + hobbies + &quot;, parent=&quot;<br />                + parent + &quot;]&quot;;<br />    }<br />    <br />}<br /></pre><br />付責複製的 <b>Function</b>:<br /><br /><pre class="brush: java">package xstream.sample;<br /><br />import com.thoughtworks.xstream.XStream;<br />import com.thoughtworks.xstream.io.xml.DomDriver;<br /><br />public class Main {<br /><br />    private static final XStream XSTREAM = new XStream(new DomDriver());<br />    <br />    @SuppressWarnings(&quot;unchecked&quot;)<br />    public static &lt;T&gt; T cloneObject(T src){<br />        return (T) XSTREAM.fromXML(XSTREAM.toXML(src));<br />    }<br /><br />}<br /></pre><br />測試的程式:<br /><pre class="brush: java">package xstream.sample;<br /><br />import com.thoughtworks.xstream.XStream;<br />import com.thoughtworks.xstream.io.xml.DomDriver;<br /><br />public class Main {<br /><br />    private static final XStream XSTREAM = new XStream(new DomDriver());<br />    <br />    public static void main(String[] args) {<br />        //Create info object<br />        Info info = new Info();<br />        Parent parent = new Parent();<br />        <br />        //Set data<br />        info.setFirstName(&quot;Lawrence&quot;);<br />        info.setFirstName(&quot;Cheung&quot;);<br />        info.setAge(24);<br />        info.addHobby(&quot;Sports&quot;);<br />        info.addHobby(&quot;Reading&quot;);<br />        <br />        parent.setFirstName(&quot;Tom&quot;);<br />        parent.setLastName(&quot;Cheung&quot;);<br />        info.setParent(parent);<br />        <br />        //Print my info<br />        System.out.println(&quot;Original object: &quot; + info);<br />        <br />        System.out.println(&quot;Now, we are going to clone info object&quot;);<br />        System.out.println();<br />        Info clonedInfo = cloneObject(info);<br />        <br />        //Print cloned info<br />        System.out.println(&quot;Cloned object: &quot; + clonedInfo);<br />        System.out.println();<br />        <br />        //Modify original info<br />        System.out.println(&quot;Change original info age to 25 and parent first name set to John.&quot;);<br />        info.setAge(25);<br />        info.getParent().setFirstName(&quot;John&quot;);<br />        <br />        System.out.println();<br />        System.out.println(&quot;Original object: &quot; + info);<br />        System.out.println(&quot;Cloned object: &quot; + clonedInfo);<br />    }<br />    <br />    @SuppressWarnings(&quot;unchecked&quot;)<br />    public static &lt;T&gt; T cloneObject(T src){<br />        return (T) XSTREAM.fromXML(XSTREAM.toXML(src));<br />    }<br /><br />}<br /><br /></pre><br />結果顯示如下:<br /><pre class="brush: text">Original object: Info [firstName=Cheung, lastName=null, age=24, hobbies=[Sports, Reading], parent=Parent [firstName=Tom, lastName=Cheung]]<br />Now, we are going to clone info object<br /><br />Cloned object: Info [firstName=Cheung, lastName=null, age=24, hobbies=[Sports, Reading], parent=Parent [firstName=Tom, lastName=Cheung]]<br /><br />Change original info age to 25 and parent first name set to John.<br /><br />Original object: Info [firstName=Cheung, lastName=null, age=25, hobbies=[Sports, Reading], parent=Parent [firstName=John, lastName=Cheung]]<br />Cloned object: Info [firstName=Cheung, lastName=null, age=24, hobbies=[Sports, Reading], parent=Parent [firstName=Tom, lastName=Cheung]]<br /></pre><br />可以看出連 <b>Parent</b> 在內也一起複製了，就算更改了原本的 <b>Info Object</b> 也不會改動到複製出來的 <b>Object</b>，即是 2 個變數的 <b>Pointer</b> 不是指向同一個位置。<br /><br />相關書籍: <a imageanchor="1" target="_blank"  href="http://www.amazon.com/Head-First-Java-Kathy-Sierra/dp/0596009208?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Head First Java, 2nd Edition" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0596009208&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0596009208" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Effective-Java-2nd-Joshua-Bloch/dp/0321356683?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Effective Java (2nd Edition)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0321356683&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0321356683" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Sams-Teach-Yourself-Java-Hours/dp/0672330768?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Sams Teach Yourself Java in 24 Hours (5th Edition)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0672330768&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0672330768" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-4708286809936453118?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
</feed>
