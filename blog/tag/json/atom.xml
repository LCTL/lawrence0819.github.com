<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: JSON | Programming Design Notes]]></title>
  <link href="http://pro.ctlok.com/blog/tag/json/atom.xml" rel="self"/>
  <link href="http://pro.ctlok.com/"/>
  <updated>2012-03-25T14:31:50+08:00</updated>
  <id>http://pro.ctlok.com/</id>
  <author>
    <name><![CDATA[Lawrence Cheung]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Objective-C 將 JSON 轉為 Object]]></title>
    <link href="http://pro.ctlok.com/2010/08/objective-c-json-object.html"/>
    <updated>2010-08-27T15:45:00+08:00</updated>
    <id>http://pro.ctlok.com/2010/08/objective-c-json-object</id>
    <content type="html"><![CDATA[<p><b>JSON</b> 是現時流行的資料格式，與 <b>XML</b> 相比，<b>JSON</b> 更為輕巧。在傳輸相同資料時，<b>JSON</b> 在大部份情況也會較 <b>XML</b> 的檔案小，在手機網路上傳輸 <b>JSON</b> 亦會比 <b>XML</b> 快。<br /><br />在 <b>iPhone Cocoa Touch Framework</b> 中並沒有 <b>Library</b> 去操作 <b>JSON</b> 資料格式。幸好有一些人為 <b>Objective C</b> 製作了能夠操作 <b>JSON</b> 資料格式的 <b>Library</b>。<br /><br />而我使用的是這一款: <a href="http://code.google.com/p/json-framework/">json-framework</a><br /><br />下載完成後將整個 <b>JSON</b> 資料夾複製到 <b>Project</b> 內，然後那一個 <b>Class</b> 要使用到 <b>JSON Library</b> 只要引入 <b>JSON.h</b> 就可以了。<br /><br /><pre class="brush: obj-c">#import "JSON.h"<br /></pre><br />使用方法非常簡單，看看以下例子。<br /><br /><b>JSON</b> 資料 (轉自: <a href="http://www.json.org/example.html">http://www.json.org/example.html</a>):<br /><pre class="brush: text">{<br />    "glossary": {<br />        "title": "example glossary",<br />        "GlossDiv": {<br />            "title": "S",<br />            "GlossList": {<br />                "GlossEntry": {<br />                    "ID": "SGML",<br />                    "SortAs": "SGML",<br />                    "GlossTerm": "Standard Generalized Markup Language",<br />                    "Acronym": "SGML",<br />                    "Abbrev": "ISO 8879:1986",<br />                    "GlossDef": {<br />                        "para": "A meta-markup language, used to create markup languages such as DocBook.",<br />                        "GlossSeeAlso": ["GML", "XML"]<br />                    },<br />                    "GlossSee": "markup"<br />                }<br />            }<br />        }<br />    }<br />}<br /></pre><br />以上的資料我會放到一個 <b>data.json</b> 的檔案內。<br /><br />現在讀取這個檔案:<br /><pre class="brush: obj-c; highlight: [2, 5, 6, 8, 9, 14];">NSString <em>filePath = [[NSBundle mainBundle] pathForResource:@&quot;data&quot; ofType:@&quot;json&quot;];<br />    NSString </em>jsonStr = [NSString stringWithContentsOfFile:filePath encoding:NSUTF8StringEncoding error:nil];<br />    <br />    <br />    SBJsonParser <em>parser = [[SBJsonParser alloc] init];<br />    NSDictionary </em>json = [parser objectWithString:jsonStr error:nil];<br />    <br />    NSDictionary <em>glossary = [json objectForKey:@&quot;glossary&quot;];<br />    NSString </em>glossaryTitle = [glossary objectForKey:@&quot;title&quot;];<br />    <br />    NSDictionary <em>glossDiv = [glossary objectForKey:@&quot;GlossDiv&quot;];<br />    NSString </em>glossDivTitle = [glossDiv objectForKey:@&quot;title&quot;];<br />    <br />    NSArray <em>glossSeeAlso = [[[[glossDiv objectForKey:@&quot;GlossList&quot;] <br />                               objectForKey: @&quot;GlossEntry&quot;] <br />                                    objectForKey: @&quot;GlossDef&quot;] <br />                                        objectForKey: @&quot;GlossSeeAlso&quot;];<br />    <br />    NSLog(@&quot;Glossary Title: %@&quot;, glossaryTitle);<br />    NSLog(@&quot;GlossDiv Title : %@&quot;, glossDivTitle);<br />    <br />    NSLog(@&quot;GlossSeeAlso item 1: %@&quot;, [glossSeeAlso objectAtIndex:0]);<br />    NSLog(@&quot;GlossSeeAlso item 2: %@&quot;, [glossSeeAlso objectAtIndex:1]);<br /></pre><br />第 2 行是將檔案內容放到 <b>NSString</b> 內。<br /><br />第 5 行創造一個 <b>JSON Parser</b>，準備將 <b>JSON</b> 字串轉換成 <b>Object</b>。<br /><br />第 6 行將 <b>JSON</b> 字串轉換成 <b>NSDictionary</b>，而這一個 <b>NSDictionary</b> 內的 <b>Object</b> 亦已經被 <b>JSON Parser</b> 轉換成相對應的 Object，例如: <b>NSArray</b>, <b>NSDictionary</b>, <b>NSString</b> 等等。<br /><br />第 8 行是使用關鍵字 <b>"glossary"</b> 抽取 <b>Object</b>，因為這個 <b>Object</b> 是包含以下部份的資料:<br /><pre class="brush: text">{<br />        "title": "example glossary",<br />        "GlossDiv": {<br />            "title": "S",<br />            "GlossList": {<br />                "GlossEntry": {<br />                    "ID": "SGML",<br />                    "SortAs": "SGML",<br />                    "GlossTerm": "Standard Generalized Markup Language",<br />                    "Acronym": "SGML",<br />                    "Abbrev": "ISO 8879:1986",<br />                    "GlossDef": {<br />                        "para": "A meta-markup language, used to create markup languages such as DocBook.",<br />                        "GlossSeeAlso": ["GML", "XML"]<br />                    },<br />                    "GlossSee": "markup"<br />                }<br />            }<br />        }<br />    }<br /></pre><br />第 9 行是使用以上的資料再加上關鍵字 <b>"title"</b> 去抽取內容，以上資料加上關鍵字 <b>"title"</b> 內的內容是 <b>"example glossary"</b>，所以回傳的 <b>Object</b> 是一個 <b>NSString Object</b>。<br /><br />第 14 行則是抽取 <b>"GlossSeeAlso"</b> 的內容，以內容則是以下這些:<br /><pre class="brush: text">["GML", "XML"]<br /></pre><br />如你所見，這是一個 <b>Array</b>， 所以回傳的 <b>Object</b> 是一個 <b>NSArray Object</b>。<br /><br />最後打印出來的內容會是以下這些:<br /><pre class="brush: text">2010-08-27 15:15:44.003 JSON[47655:207] Glossary Title: example glossary<br />2010-08-27 15:15:44.049 JSON[47655:207] GlossDiv Title : S<br />2010-08-27 15:15:44.050 JSON[47655:207] GlossSeeAlso item 1: GML<br />2010-08-27 15:15:44.050 JSON[47655:207] GlossSeeAlso item 2: XML<br /></pre><br />如果 <b>JSON</b> 資料是經由網路去讀取，可以用以下方法:<br /><pre class="brush: obj-c">NSURLRequest </em>request = [NSURLRequest requestWithURL:[NSURL URLWithString:@&quot;http://pro.ctlok.com/data.json&quot;]];<br />    <br />NSData <em>response = [NSURLConnection sendSynchronousRequest:request returningResponse:nil error:nil];<br />    <br />NSString </em>jsonStr = [[NSString alloc] initWithData:response encoding:NSUTF8StringEncoding];<br /></pre><br />範例下載: <a href="https://sites.google.com/site/lawrencespace/lawpronotes/download/JSON.zip">JSON.zip</a><br /><br />相關書籍: <a imageanchor="1" target="_blank"  href="http://www.amazon.com/Beginning-iPhone-iPad-Development-iOS4/dp/143023024X?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Beginning iPhone and iPad Development with iOS4: Exploring the iPhone SDK" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=143023024X&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=143023024X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/iPhone-SDK-Advanced-Programming-Application/dp/0470971231?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="iPhone SDK 4 Advanced Programming: Advanced Application Development for Apple iPhone and iPod touch" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0470971231&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0470971231" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Beginning-iPhone-Programming-Objective-C-Programmer/dp/0470500972?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Beginning iPhone SDK Programming with Objective-C (Wrox Programmer to Programmer)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0470500972&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0470500972" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-1829791186413457186?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
</feed>
