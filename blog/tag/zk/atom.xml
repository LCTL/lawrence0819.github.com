<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ZK | Programming Design Notes]]></title>
  <link href="http://lawrence0819.github.com/blog/tag/zk/atom.xml" rel="self"/>
  <link href="http://lawrence0819.github.com/"/>
  <updated>2012-03-25T12:47:26+08:00</updated>
  <id>http://lawrence0819.github.com/</id>
  <author>
    <name><![CDATA[Lawrence Cheung]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ZK I18N Advanced]]></title>
    <link href="http://lawrence0819.github.com/2010/07/zk-i18n-advanced.html"/>
    <updated>2010-07-02T14:45:00+08:00</updated>
    <id>http://lawrence0819.github.com/2010/07/zk-i18n-advanced</id>
    <content type="html"><![CDATA[<p>以前也已經講解過 ZK 轉換語言的方法: <a href="http://pro.ctlok.com/2010/04/zk-internationalization-and.html">ZK I18N</a><br /><br />因為考慮到 ZK 頁面可能會由數個 ZK 元件組合出來，如果每一個元件也要加入 ZK Controller 來設定語言會很麻煩，所以想了一個方法去解決這個問題。<br /><br />在這裡我會在 <b>index.zul</b> 使用 <a href="http://docs.zkoss.org/wiki/StyleGuide_Borderlayout">Border Layout</a>，使以會有 5 個元件頁面，分別是 <b>North.zul</b>, <b>East.zul</b>, <b>Center.zul</b>, <b>West.zul</b>, <b>South.zul</b>。而 <b>Center.zul</b> 將會放一個控制語言的元件用作轉換其他元件的語言。<br /><br />首先在新增一個 <b>component folder</b>在 <b>WEB-INF</b> 內。<br /><br />再新增 <b>East.zul</b> 在 <b>component folder</b>內。<br />/WEB-INF/component/East.zul:<br /><pre class="brush: xml">&lt;window id="East" border="none"&gt;<br />    &lt;label id="pageName" value="East" /&gt;<br />    &lt;button id="btn" label="Button" /&gt;<br />&lt;/window&gt;<br /></pre><br />要記住每一個 zul 的頁面的 <b>Root Element id</b> 要跟 zul 頁面名稱一樣，之後用到時比較好分辨。<br /><br />/WEB-INF/component/North.zul:<br /><pre class="brush: xml">&lt;window id="North" border="none"&gt;<br />    &lt;label id="pageName" value="North" /&gt;<br />    &lt;button id="btn" label="Button" /&gt;<br />&lt;/window&gt;<br /></pre><br />/WEB-INF/component/South.zul:<br /><pre class="brush: xml">&lt;window id="South" border="none"&gt;<br />    &lt;label id="pageName" value="South" /&gt;<br />    &lt;button id="btn" label="Button" /&gt;<br />&lt;/window&gt;<br /></pre><br />/WEB-INF/component/West.zul:<br /><pre class="brush: xml">&lt;window id="West" border="none"&gt;<br />    &lt;label id="pageName" value="West" /&gt;<br />    &lt;button id="btn" label="Button" /&gt;<br />&lt;/window&gt;<br /></pre><br />現在新增 index.zul 在根目錄。<br />/index.zul:<br /><pre class="brush: xml">&lt;?page title="Index Page"?&gt;<br />&lt;zk&gt;<br />    &lt;borderlayout&gt;<br />        &lt;north&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/North.zul" /&gt;&lt;/north&gt;<br />        &lt;east&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/East.zul" /&gt;&lt;/east&gt;<br />        &lt;center&gt;&lt;/center&gt;<br />        &lt;west&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/West.zul" /&gt;&lt;/west&gt;<br />        &lt;south&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/South.zul" /&gt;&lt;/south&gt;<br />    &lt;/borderlayout&gt;<br />&lt;/zk&gt;<br /></pre><br />打開 <b>index.zul</b> 頂面看看是否這個樣子:<br /><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/_fDN8R2Wgbcs/TC1ySKbhD1I/AAAAAAAAAi8/1dq357dI2kY/s1600/zk-i18n.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="189" src="http://2.bp.blogspot.com/_fDN8R2Wgbcs/TC1ySKbhD1I/AAAAAAAAAi8/1dq357dI2kY/s320/zk-i18n.png" width="320" /></a></div><br />現在新增一個 Java Class 是轉換語言的核心元件。只是很簡單的程式碼，看不明再問我吧。<br />com.ctlok.pro.zk.language.I18N:<br /><pre class="brush: java">package com.ctlok.pro.zk.language;<br /><br />import java.util.List;<br /><br />import org.zkoss.util.resource.Labels;<br />import org.zkoss.zk.ui.Component;<br />import org.zkoss.zk.ui.IdSpace;<br />import org.zkoss.zul.Button;<br />import org.zkoss.zul.Label;<br /><br />public class I18N {<br /><br />    @SuppressWarnings("unchecked")<br />    public static void setLanguage(Component rootComponent) {<br />        List&lt;Component&gt; components = (List&lt;Component&gt;) rootComponent<br />                .getChildren();<br />        for (int i = 0; i &lt; components.size(); i++) {<br />            Component component = components.get(i);<br />            setComponentLanguage(component);<br />            if (component.getChildren().size() &gt; 0)<br />                setLanguage(component);<br />        }<br />    }<br />    <br />    private static void setComponentLanguage(Component component) {<br />        IdSpace owner = component.getSpaceOwner();<br />        if (owner instanceof Component) {<br />            String ownerId = ((Component)owner).getId();<br />            String i18n = Labels.getLabel(ownerId + "." + component.getId());<br />            if (i18n != null) {<br />                if (component instanceof Label)<br />                    ((Label) component).setValue(i18n);<br />                else if (component instanceof Button)<br />                    ((Button) component).setLabel(i18n);<br />            }<br />        }<br />    }<br />}<br /></pre><br />有了核心元件，也要有語言檔案才行。<br />/WEB-INF/i3-label.properties:<br /><pre class="brush: text">#i18n<br />North.pageName=North<br />North.btn=Button<br /><br />East.pageName=East<br />East.btn=Button<br /><br />South.pageName=South<br />South.btn=Button<br /><br />West.pageName=West<br />West.btn=Button<br /></pre><br />/WEB-INF/i3-label_zh.properties:<br /><pre class="brush: text">#i18n<br />North.pageName=北<br />North.btn=按鈕<br /><br />East.pageName=東<br />East.btn=按鈕<br /><br />South.pageName=南<br />South.btn=按鈕<br /><br />West.pageName=西<br />West.btn=按鈕<br /></pre><br />/WEB-INF/i3-label_en.properties:<br /><pre class="brush: text">#i18n<br />North.pageName=North<br />North.btn=Button<br /><br />East.pageName=East<br />East.btn=Button<br /><br />South.pageName=South<br />South.btn=Button<br /><br />West.pageName=West<br />West.btn=Button<br /></pre><br />/WEB-INF/i3-label_ja.properties:<br /><pre class="brush: text">#i18n<br />North.pageName=北<br />North.btn=ボタン<br /><br />East.pageName=東<br />East.btn=ボタン<br /><br />South.pageName=南<br />South.btn=ボタン<br /><br />West.pageName=西<br />West.btn=ボタン<br /></pre><br />一共有 4 個語言檔，而 i3-label.properties 是預設的語言檔案，當找不到合適的語言時便會用到。<br /><br />North.pageName=North 前面的 North 就是剛才提到的頁面 <b>Root Element id</b>，這樣便可以分到那一個元件是那一個 zul 頁面了，也不會怕和其他頁面的元件 ID 相撞。<br /><br />有了這些還不夠，還要有一個元件去結用戶去選擇語言才行。<br /><br />新增一個 com.ctlok.pro.zk.component.LanguageCombobox:<br /><pre class="brush: java">package com.ctlok.pro.zk.component;<br /><br />import java.util.Locale;<br /><br />import org.zkoss.util.Locales;<br />import org.zkoss.web.Attributes;<br />import org.zkoss.zk.ui.Session;<br />import org.zkoss.zk.ui.Sessions;<br />import org.zkoss.zul.Combobox;<br />import org.zkoss.zul.ListModel;<br />import org.zkoss.zul.SimpleListModel;<br /><br />import com.ctlok.pro.zk.language.I18N;<br /><br />public class LanguageCombobox extends Combobox {<br /><br />    private static final long serialVersionUID = 1L;<br /><br />    public LanguageCombobox() {<br />        Locale[] model = new Locale[3];<br />        model[0] = Locale.ENGLISH;<br />        model[1] = Locale.CHINESE;<br />        model[2] = Locale.JAPANESE;<br /><br />        setModel(new SimpleListModel(model));<br />    }<br /><br />    public void onInitRenderLater() throws InterruptedException {<br />        Locale locale = Locales.getThreadLocal();<br />        ListModel languages = this.getModel();<br />        setSelectedIndex(0);<br />        for (int i = 0; i &lt; languages.getSize(); i++) {<br />            if (locale.getDisplayLanguage().equals(<br />                    ((Locale) languages.getElementAt(i)).getDisplayLanguage())) {<br />                setSelectedIndex(i);<br />                return;<br />            }<br />        }<br />    }<br /><br />    public void onCreate() {<br />        I18N.setLanguage(getRoot());<br />    }<br /><br />    public void onChange() {<br />        Locale locale = (Locale) this.getModel().getElementAt(<br />                this.getSelectedIndex());<br />        setDefaultLanguage(locale);<br />        I18N.setLanguage(getRoot());<br />    }<br /><br />    public void setDefaultLanguage(Locale locale) {<br />        Session session = Sessions.getCurrent();<br />        session.setAttribute(Attributes.PREFERRED_LOCALE, locale);<br />        Locales.setThreadLocal(locale);<br />    }<br /><br />}<br /></pre>在 Constructor 內設定了 3 種語言選擇。  <br /><br />onInitRenderLater() 選取用戶現在正在使用的語言。  <br /><br />onCreate() 將頁面的語言轉換為用戶正在使用的語言，如果還用戶還未選擇語言，跟瀏覽器的語言來設定。  <br /><br />onChange() 用戶轉換語言時會將預設的語言設定為用戶所選擇語言。  <br /><br />setDefaultLanguage() 設定用戶預設語言。  <br /><br />加入此元件的頁面也會自動設定該頁面的語言，很方便吧。  <br /><br />現在元件已經有了，那放到 zul 頁面顯示出來。  <br /><br />新增 /WEB-INF/component/Center.zul: <br /><pre class="brush: xml">&lt;window id="Center" border="none"&gt;<br />    &lt;combobox use="com.ctlok.pro.zk.component.LanguageCombobox" /&gt;<br />&lt;/window&gt;<br /></pre>/index.zul 頁面亦要改一改。 index.zul: <br /><pre class="brush: xml">&lt;?page title="Index Page"?&gt;<br />&lt;zk&gt;<br />    &lt;borderlayout&gt;<br />        &lt;north&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/North.zul" /&gt;&lt;/north&gt;<br />        &lt;east&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/East.zul" /&gt;&lt;/east&gt;<br />        &lt;center&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/Center.zul" /&gt;&lt;/center&gt;<br />        &lt;west&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/West.zul" /&gt;&lt;/west&gt;<br />        &lt;south&gt;&lt;include src="http://lawrence0819.github.com/WEB-INF/component/South.zul" /&gt;&lt;/south&gt;<br />    &lt;/borderlayout&gt;<br />&lt;/zk&gt;<br /></pre><br />以下是轉換各種語言的樣子:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/_fDN8R2Wgbcs/TC2KU4VkGoI/AAAAAAAAAjE/4VShZwsKSvc/s1600/zk-i18n-1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="189" src="http://2.bp.blogspot.com/_fDN8R2Wgbcs/TC2KU4VkGoI/AAAAAAAAAjE/4VShZwsKSvc/s320/zk-i18n-1.png" width="320" /></a></div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://4.bp.blogspot.com/_fDN8R2Wgbcs/TC2KVTnuNUI/AAAAAAAAAjI/Du7dGjmLPDA/s1600/zk-i18n-2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="189" src="http://4.bp.blogspot.com/_fDN8R2Wgbcs/TC2KVTnuNUI/AAAAAAAAAjI/Du7dGjmLPDA/s320/zk-i18n-2.png" width="320" /></a></div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://4.bp.blogspot.com/_fDN8R2Wgbcs/TC2KUjBBNjI/AAAAAAAAAjA/Xlt4-XN-HvE/s1600/zk-i18n-3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="189" src="http://4.bp.blogspot.com/_fDN8R2Wgbcs/TC2KUjBBNjI/AAAAAAAAAjA/Xlt4-XN-HvE/s320/zk-i18n-3.png" width="320" /></a></div><br />範例: <a href="http://sites.google.com/site/lawrencespace/lawpronotes/download/zk-i18n-advanced.zip">zk-i18n-advanced.zip</a> (Eclipse Project)<br /><b><strong><strong> 需要自行加上 ZK 5.01 Library </strong></strong></b><br /><br />相關書籍: <a href="http://www.amazon.com/ZK-Ajax-without-Javascript-Framework/dp/1590599012?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="ZK: Ajax without the Javascript Framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=1590599012&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=1590599012" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Developers-Guide-Developing-applications-development/dp/1847192009?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="ZK Developer's Guide: Developing responsive user interfaces for web applications using Ajax, XUL, and the open source ZK rich web client development framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=1847192009&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=1847192009" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Head-First-Java-Kathy-Sierra/dp/0596009208?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Head First Java, 2nd Edition" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=0596009208&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=0596009208" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-9160651432083889603?l=pro.ctlok.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ZK Internationalization and localization (I18N)]]></title>
    <link href="http://lawrence0819.github.com/2010/04/zk-internationalization-and.html"/>
    <updated>2010-04-29T18:16:00+08:00</updated>
    <id>http://lawrence0819.github.com/2010/04/zk-internationalization-and</id>
    <content type="html"><![CDATA[<p>ZK 官方的 I18N 教學非常缺乏彈性。<br />網址: <a href="http://www.zkoss.org/smalltalks/i18n/i18n.dsp">http://www.zkoss.org/smalltalks/i18n/i18n.dsp</a><br /><br />官方的 I18N 教學是一個一個元件去設定語言，如果有一百個元件就會有一百行程式碼，所以另外想了一個方法去解決這個問題。<br /><br />首先新增一個 package 為 com.blogspot.lawpronotes.controller，並制作一個 Controller，名命為  IndexController。<br /><br />IndexController:<br /><pre class="brush: java">package com.blogspot.lawpronotes.controller;<br /><br />import org.zkoss.zk.ui.util.GenericForwardComposer;<br /><br />public class IndexController extends GenericForwardComposer {<br /><br />    private static final long serialVersionUID = 1L;<br /><br />    @Override<br />    public void doAfterCompose(Component comp) throws Exception {<br />        super.doAfterCompose(comp);<br />    }<br />}<br /></pre><br /><br />在 / 制作一個 index.zul 頁面<br /><br />index.zul:<br /><pre class="brush: xml">&lt;?page title="Auto Generated index.zul"?&gt;<br />&lt;zk&gt;<br />    &lt;window title="i18n" border="normal" width="500px"<br />        apply="com.blogspot.lawpronotes.controller.IndexController"&gt;<br />        &lt;panel&gt;<br />            &lt;toolbar&gt;<br />                &lt;button id="btnChinese" label="中文"/&gt;<br />                &lt;button id="btnEnglish" label="English"/&gt;<br />                &lt;button id="btnJapanese" label="日本語"/&gt;<br />                &lt;button id="btnFrench" label="Français"/&gt;<br />            &lt;/toolbar&gt;<br />            &lt;panelchildren&gt;<br />                &lt;grid&gt;<br />                    &lt;rows&gt;<br />                        &lt;row&gt;<br />                            &lt;label id="lbUsername" /&gt;<br />                            &lt;textbox id="txtUsername" type="text" width="98%" /&gt;<br />                        &lt;/row&gt;<br />                        &lt;row&gt;<br />                            &lt;label id="lbPassword" /&gt;<br />                            &lt;textbox id="txtPassword" type="password" width="98%" /&gt;<br />                        &lt;/row&gt;<br />                        &lt;row&gt;<br />                            &lt;space /&gt;<br />                            &lt;button id="btnSubmit" /&gt;<br />                        &lt;/row&gt;<br />                    &lt;/rows&gt;<br />                &lt;/grid&gt;<br />            &lt;/panelchildren&gt;<br />        &lt;/panel&gt;<br />    &lt;/window&gt;<br />&lt;/zk&gt;<br /></pre><br />現在 index.zul 頁面的 Label 是沒有任何文字的，現在新增五個語言檔案，分別為 i3-label.properties、i3-label_en.properties、i3-label_fr.properties、i3-label_jp.properties 和 i3-label_zh.properties。全部的 properties 檔案都是放到 /WEB-INF 內<br /><br /><strong>*ZK 的 properties 檔案是用 UTF-8 編碼。<br /><br />i3-label.properties:<br /><pre class="brush: text">#index.zul<br /><br />/index.zul/lbUsername=Username:<br />/index.zul/lbPassword=Password:<br />/index.zul/btnSubmit=Submit<br /></pre><br />i3-label_en.properties:<br /><pre class="brush: text">#index.zul<br /><br />/index.zul/lbUsername=Username:<br />/index.zul/lbPassword=Password:<br />/index.zul/btnSubmit=Submit<br /></pre><br />i3-label_fr.properties:<br /><pre class="brush: text">#index.zul<br /><br />/index.zul/lbUsername=Nom d'utilisateur:<br />/index.zul/lbPassword=Mot de passe:<br />/index.zul/btnSubmit=Soumettre<br /></pre><br />i3-label_jp.properties:<br /><pre class="brush: text">#index.zul<br /><br />/index.zul/lbUsername=ユーザー名:<br />/index.zul/lbPassword=パスワード:<br />/index.zul/btnSubmit=登録<br /></pre><br />i3-label_zh.properties:<br /><pre class="brush text">#index.zul<br /><br />/index.zul/lbUsername=用戶名稱:<br />/index.zul/lbPassword=密碼:<br />/index.zul/btnSubmit=確定<br /></pre><br />properties 檔案內的 /index.zul 是元件的頁面位置和名稱，而 /lbUsername，/lbPassword 和 /btnSubmit 是元件的 ID，這樣確保了名稱不會相同。<br /><br />現在有了語言檔，可以在 Controller 內讀取語言檔然後再加到元件上。<br />新增以下的方法到 IndexController 內。<br /><pre class="brush: java">@SuppressWarnings("unchecked")<br />    private void setLanguage(Component rootComponent) {<br />        List&lt;Component&gt; components = (List&lt;Component&gt;) rootComponent<br />                .getChildren();<br />        for (int i = 0; i &lt; components.size(); i++) {<br />            Component component = components.get(i);<br />            setComponentLanguage(component);<br />            if (component.getChildren().size() &gt; 0)<br />                setLanguage(component);<br />        }<br />    }<br />    <br />    private void setComponentLanguage(Component component) {<br />        String path = component.getPage().getRequestPath();<br />        String i18n = Labels.getLabel(path + "/" + component.getId());<br />        if (i18n != null) {<br />            if (component instanceof Label)<br />                ((Label) component).setValue(i18n);<br />            else if (component instanceof Button)<br />                ((Button) component).setLabel(i18n);<br />        }<br />    }<br />    <br />    private void changeLocale(String locale) {<br />        Session session = Sessions.getCurrent();<br />        Locale preferredLocale = Locales.getLocale(locale);<br />        session.setAttribute(Attributes.PREFERRED_LOCALE, preferredLocale);<br />        Locales.setThreadLocal(preferredLocale);<br />        setLanguage(self);<br />    }<br /></pre><br />而 doAfterCompose 方法則修改為以下這樣:<br /><pre class="brush: java">@Override<br />    public void doAfterCompose(Component comp) throws Exception {<br />        super.doAfterCompose(comp);<br />        setLanguage(self);<br />    }<br /></pre><br />現在可以試試打開 index.zul 頁面看看是不是自動加入了文字，成功應該會像以下這樣。<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://3.bp.blogspot.com/_fDN8R2Wgbcs/S9lZ7mwZ27I/AAAAAAAAAew/XaxKTONxtMA/s1600/indexzul.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="100" src="http://3.bp.blogspot.com/_fDN8R2Wgbcs/S9lZ7mwZ27I/AAAAAAAAAew/XaxKTONxtMA/s320/indexzul.png" width="320" /></a></div><br />現在頁上的按鈕還沒有作用，可以加入以下的方法去令按鈕產生作用。<br /><pre class="brush: java">public void onClick$btnChinese(){<br />        changeLocale("zh");<br />    }<br />    <br />    public void onClick$btnEnglish(){<br />        changeLocale("en");<br />    }<br />    <br />    public void onClick$btnJapanese(){<br />        changeLocale("jp");<br />    }<br />    <br />    public void onClick$btnFrench(){<br />        changeLocale("fr");<br />    }<br /></pre><br />完整的 IndexController:<br /><pre class="brush: java">package com.blogspot.lawpronotes.controller;<br /><br />import java.util.List;<br />import java.util.Locale;<br /><br />import org.zkoss.util.Locales;<br />import org.zkoss.util.resource.Labels;<br />import org.zkoss.web.Attributes;<br />import org.zkoss.zk.ui.Component;<br />import org.zkoss.zk.ui.Session;<br />import org.zkoss.zk.ui.Sessions;<br />import org.zkoss.zk.ui.util.GenericForwardComposer;<br />import org.zkoss.zul.Button;<br />import org.zkoss.zul.Label;<br />import org.zkoss.zul.Panel;<br /><br />public class IndexController extends GenericForwardComposer {<br /><br />    private static final long serialVersionUID = 1L;<br /><br />    @Override<br />    public void doAfterCompose(Component comp) throws Exception {<br />        super.doAfterCompose(comp);<br />        setLanguage(self);<br />    }<br />    <br />    public void onClick$btnChinese(){<br />        changeLocale(&quot;zh&quot;);<br />    }<br />    <br />    public void onClick$btnEnglish(){<br />        changeLocale(&quot;en&quot;);<br />    }<br />    <br />    public void onClick$btnJapanese(){<br />        changeLocale(&quot;jp&quot;);<br />    }<br />    <br />    public void onClick$btnFrench(){<br />        changeLocale(&quot;fr&quot;);<br />    }<br /><br />    @SuppressWarnings(&quot;unchecked&quot;)<br />    private void setLanguage(Component rootComponent) {<br />        List&lt;Component&gt; components = (List&lt;Component&gt;) rootComponent<br />                .getChildren();<br />        for (int i = 0; i &lt; components.size(); i++) {<br />            Component component = components.get(i);<br />            setComponentLanguage(component);<br />            if (component.getChildren().size() &gt; 0)<br />                setLanguage(component);<br />        }<br />    }<br />    <br />    private void setComponentLanguage(Component component) {<br />        String path = component.getPage().getRequestPath();<br />        String i18n = Labels.getLabel(path + &quot;/&quot; + component.getId());<br />        if (i18n != null) {<br />            if (component instanceof Label)<br />                ((Label) component).setValue(i18n);<br />            else if (component instanceof Button)<br />                ((Button) component).setLabel(i18n);<br />        }<br />    }<br />    <br />    private void changeLocale(String locale) {<br />        Session session = Sessions.getCurrent();<br />        Locale preferredLocale = Locales.getLocale(locale);<br />        session.setAttribute(Attributes.PREFERRED_LOCALE, preferredLocale);<br />        Locales.setThreadLocal(preferredLocale);<br />        setLanguage(self);<br />    }<br />}<br /></pre><br />現在應該能夠立即轉換頁面語言了。<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://1.bp.blogspot.com/_fDN8R2Wgbcs/S9lcWZ9K87I/AAAAAAAAAe0/ztSTI798GD8/s1600/indexzul2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="100" src="http://1.bp.blogspot.com/_fDN8R2Wgbcs/S9lcWZ9K87I/AAAAAAAAAe0/ztSTI798GD8/s320/indexzul2.png" width="320" /></a></div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/_fDN8R2Wgbcs/S9lcW_yfv9I/AAAAAAAAAe4/HDigy1dHC8A/s1600/indexzul3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="99" src="http://2.bp.blogspot.com/_fDN8R2Wgbcs/S9lcW_yfv9I/AAAAAAAAAe4/HDigy1dHC8A/s320/indexzul3.png" width="320" /></a></div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/_fDN8R2Wgbcs/S9lcXagDotI/AAAAAAAAAe8/T4_zfh-EBTA/s1600/indexzul4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="99" src="http://2.bp.blogspot.com/_fDN8R2Wgbcs/S9lcXagDotI/AAAAAAAAAe8/T4_zfh-EBTA/s320/indexzul4.png" width="320" /></a></div><br /><br />其實還有方法可令轉換語言更好，不用每一個 Controller 也有相同的方法，<strike>遲一點再補上來</strike>。<br /><a href="http://pro.ctlok.com/2010/07/zk-i18n-advanced.html">ZK I18N Advanced</a><br /><br />範例下載: <a href="http://sites.google.com/site/lawrencespace/lawpronotes/download/i18n.7z?attredirects=0&d=1">i18n.7z</a> (密碼:lawpronotes)<br /><br /></strong>因 ZK Library 太大，請自行加入 ZK 5.0.1 Library 到 /WEB-INF/lib 下。<br /><br />相關書籍: <a href="http://www.amazon.com/Developers-Guide-Developing-applications-development/dp/1847192009?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="ZK Developer's Guide: Developing responsive user interfaces for web applications using Ajax, XUL, and the open source ZK rich web client development framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=1847192009&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=1847192009" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/ZK-Ajax-without-Javascript-Framework/dp/1590599012?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="ZK: Ajax without the Javascript Framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=1590599012&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=1590599012" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Head-First-Java-Kathy-Sierra/dp/0596009208?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Head First Java, 2nd Edition" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=0596009208&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=0596009208" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-8904115902016697427?l=pro.ctlok.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[自動將 Spring Bean 注入到 ZK Controller 內]]></title>
    <link href="http://lawrence0819.github.com/2010/03/spring-bean-zk-conttroller.html"/>
    <updated>2010-03-01T12:59:00+08:00</updated>
    <id>http://lawrence0819.github.com/2010/03/spring-bean-zk-conttroller</id>
    <content type="html"><![CDATA[<p>ZK 能夠自動根據 Spring Bean 的名稱注入相對應的變數內，而且非常簡單。<br />首先制作一個 Spring Bean，命名為 com.blogspot.lawpronotes.beans.HelloBean。<br /><br />HelloBean 程式碼:<br /><pre class="brush: java">package com.blogspot.lawpronotes.beans;<br /><br />public class HelloBean {<br />    public String sayHello(){<br />        return "Hello";<br />    }<br />}<br /></pre><br />在 applicationContext.xml 內加上以下內容:<br /><pre class="brush: xml">&lt;bean id="hello" class="com.blogspot.lawpronotes.beans.HelloBean" /&gt;<br /></pre><br />新增 index.zul 並加入以下內容:<br /><pre class="brush: xml">&lt;?page title="Index" contentType="text/html;charset=UTF-8"?&gt;<br />&lt;?variable-resolver class="org.zkoss.zkplus.spring.DelegatingVariableResolver"?&gt;<br />&lt;zk&gt;<br />    &lt;window title="Index" border="normal"<br />        apply="com.blogspot.lawpronotes.web.ui.IndexController"&gt;<br />        &lt;button id="btn1" label="Say Hello" /&gt;<br />        &lt;label id="labMessage" /&gt;<br />    &lt;/window&gt;<br />&lt;/zk&gt;<br /></pre><br />其中這句是關鍵，沒有引入這個類別將不能夠自動將 bean 注入。<br /><pre class="brush: xml">&lt;?variable-resolver class="org.zkoss.zkplus.spring.DelegatingVariableResolver"?&gt;<br /></pre><br />現在新增 com.blogspot.lawpronotes.web.ui.IndexController，將以下程式碼貼上。<br /><pre class="brush: java">package com.blogspot.lawpronotes.web.ui;<br /><br />import org.zkoss.zk.ui.Component;<br />import org.zkoss.zk.ui.util.GenericForwardComposer;<br />import org.zkoss.zul.Button;<br />import org.zkoss.zul.Label;<br /><br />import com.blogspot.lawpronotes.beans.HelloBean;<br /><br />public class IndexController extends GenericForwardComposer{<br />    //Spring Bean<br />    private HelloBean hello;<br />    <br />    //ZK Component<br />    private Button btn1;<br />    private Label labMessage;<br />    <br />    @Override<br />    public void doAfterCompose(Component comp) throws Exception {<br />        super.doAfterCompose(comp);<br />    }<br />    <br />    public void onClick$btn1(){<br />        labMessage.setValue(hello.sayHello());<br />    }<br />}<br /></pre><br />可以是私有變數，ZK 一樣可以將 bean 注入，但有一點要注意，其中<br /><pre class="brush: java">private HelloBean hello;<br /></pre><pre class="brush: xml">&lt;bean id="hello" class="com.blogspot.lawpronotes.beans.HelloBean" /&gt;<br /></pre>變數名稱一定要跟定義 bean 時的 id 一樣，不一樣會注入失敗。即是不可以是以下這種情況:<br /><pre class="brush: java">private HelloBean helloBean;<br /></pre><pre class="brush: xml">&lt;bean id="hello" class="com.blogspot.lawpronotes.beans.HelloBean" /&gt;<br /></pre>這樣便會注入失敗。<br /><br />除了自動注入，亦可用以下方法將 bean 注入。<br /><pre class="brush: java">public void onClick$btn1(){<br />    Object obj = org.zkoss.zkplus.spring.SpringUtil.getBean("hello");<br />    if (obj instanceof HelloBean){<br />        HelloBean helloBean = (HelloBean)obj;<br />        labMessage.setValue(helloBean.sayHello());<br />    }else<br />        labMessage.setValue("HelloBean not found");<br />}<br /></pre><br />現在用瀏覽器打開 index.zul，按下按鈕會顯示 Hello 字樣。<br /><br />相關書籍: <a href="http://www.amazon.com/ZK-Ajax-without-Javascript-Framework/dp/1590599012?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="ZK: Ajax without the Javascript Framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=1590599012&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=1590599012" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Developers-Guide-Developing-applications-development/dp/1847192009?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="ZK Developer's Guide: Developing responsive user interfaces for web applications using Ajax, XUL, and the open source ZK rich web client development framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=1847192009&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=1847192009" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Spring-Recipes-Problem-Solution-Gary-Mak/dp/1590599799?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Spring Recipes: A Problem-Solution Approach" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=1590599799&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=1590599799" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-5757064165076384826?l=pro.ctlok.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ZK 利用 GenericForwardComposer 來達到 MVC 結構]]></title>
    <link href="http://lawrence0819.github.com/2010/02/zk-genericforwardcomposer-mvc.html"/>
    <updated>2010-02-26T15:08:00+08:00</updated>
    <id>http://lawrence0819.github.com/2010/02/zk-genericforwardcomposer-mvc</id>
    <content type="html"><![CDATA[<p>MVC 的好處是于不必在視圖插入控制的程式碼，令視圖專是去做顯示的工作，而且更容易維護程式。ZK 也可以做到視圖和控制程式碼分離。<br /><br />首先制作一個 index.zul<br /><pre class="brush: xml">&lt;?page title=&quot;Index&quot; contentType=&quot;text/html;charset=UTF-8&quot;?&gt;<br />&lt;zk&gt;<br />    &lt;window title=&quot;Index&quot; border=&quot;normal&quot;&gt;<br />        &lt;button id=&quot;btn&quot; label=&quot;Say Hello World&quot; /&gt;<br />    &lt;/window&gt;<br />&lt;/zk&gt;<br /></pre><br />然後新增一個 Class <br />package com.blogspot.lawpronotes.web.ui.IndexController<br /><pre class="brush: java">package com.blogspot.lawpronotes.web.ui;<br /><br />import org.zkoss.zk.ui.Component;<br />import org.zkoss.zk.ui.util.GenericForwardComposer;<br />import org.zkoss.zul.Button;<br />import org.zkoss.zul.Label;<br /><br />public class IndexController extends GenericForwardComposer{<br /><br />    private static final long serialVersionUID = 1L;<br />    <br />    //ZK Component<br />    private Button btn;<br />    <br />    private Label lb;<br />    <br />    public IndexController(){<br />        lb = new Label();<br />    }<br />    <br />    @Override<br />    public void doAfterCompose(Component comp) throws Exception {<br />        super.doAfterCompose(comp);<br />    }<br />    <br />    public void onClick$btn(){<br />        lb.setValue(&quot;Hello World&quot;);<br />        self.appendChild(lb);<br />    }<br />}<br /></pre><br />Controller 要 extends GenericForwardComposer 去令 ZK Engine 知道這是個 Controller。(雖然還有其他方法去實現 MVC，但個人覺得用 extends GenericForwardComposer 這個方式是最好的)<br /><br />在 IndexController 這個 Class 內有一個 Button btn，而這個 btn 是 index.zul 內的 &lt;button id=&quot;btn&quot; label=&quot;Say Hello World&quot;/&gt;，btn 這個名字一定要跟 index.zul 的 button  id 一模一樣，ZK Engine 會根據這個名稱自動將<br />&lt;button id=&quot;btn&quot; label=&quot;Say Hello World&quot;/&gt; 注入到 Button btn 內。<br /><br />doAfterCompose(Component comp) 這個方法在頁面組成後會由 ZK Engine 自動去執行，你可以在 super.doAfterCompose(comp); 這句後加入一些頁面設定的程式碼。<br /><br />public void onClick$btn() 是事件的 function，[事件]$[物件] 這樣的模式去令 ZK Engine 知道這是什麼物件的事件。<br /><br />現在修改 index.zul 去令視圖和控制器連接，將 <br /><pre class="brush: xml">&lt;window title=&quot;Index&quot; border=&quot;normal&quot;&gt; <br /></pre>改為 <br /><pre class="brush: xml">&lt;window title=&quot;Index&quot; border=&quot;normal&quot; apply=&quot;com.blogspot.lawpronotes.web.ui.IndexController&quot;&gt;<br /></pre>這樣便可以將 window 這個物件和控制器連接起來，而控制器可以控制 window 內的所有物件。<br /><br />完整 index.zul<br /><pre class="brush: xml">&lt;?page title=&quot;Index&quot; contentType=&quot;text/html;charset=UTF-8&quot;?&gt;<br />&lt;zk&gt;<br />    &lt;window title=&quot;Index&quot; border=&quot;normal&quot;<br />        apply=&quot;com.blogspot.lawpronotes.web.ui.IndexController&quot;&gt;<br />        &lt;button id=&quot;btn&quot; label=&quot;Say Hello World&quot; /&gt;<br />    &lt;/window&gt;<br />&lt;/zk&gt;<br /></pre><br />現在用瀏覽器打開 index.zul 頁面，按一下按鈕便會出現 Hello World。<br /><br />相關書籍: <a imageanchor="1" target="_blank"  href="http://www.amazon.com/ZK-Ajax-without-Javascript-Framework/dp/1590599012?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="ZK: Ajax without the Javascript Framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=1590599012&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=1590599012" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Developers-Guide-Developing-applications-development/dp/1847192009?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="ZK Developer&#39;s Guide: Developing responsive user interfaces for web applications using Ajax, XUL, and the open source ZK rich web client development framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=1847192009&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=1847192009" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Effective-Java-2nd-Joshua-Bloch/dp/0321356683?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Effective Java (2nd Edition)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0321356683&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0321356683" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-7897084862206083823?l=pro.ctlok.com' alt='' /></div></p>
]]></content>
  </entry>
  
</feed>
