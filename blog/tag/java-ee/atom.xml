<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Java EE | Programming Design Notes]]></title>
  <link href="http://pro.ctlok.com/blog/tag/java-ee/atom.xml" rel="self"/>
  <link href="http://pro.ctlok.com/"/>
  <updated>2012-04-03T10:20:27+08:00</updated>
  <id>http://pro.ctlok.com/</id>
  <author>
    <name><![CDATA[Lawrence Cheung]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Guice + Jersey 打造 RESTful 應用程式]]></title>
    <link href="http://pro.ctlok.com/2011/09/guice-jersey-restful-application.html"/>
    <updated>2011-09-08T14:46:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/09/guice-jersey-restful-application</id>
    <content type="html"><![CDATA[<p>以前我喜歡使用 <b>Spring + Spring Web MVC</b> 來打造 <b>RESTful</b> 應用程式，但 <b>Spring</b> 的起動有點慢，如果放上 <b>Google App Engine</b> 上經常令用戶等待很久才載入到頁面。<br /><br />今次選用了 <b>Guice + Jersey</b> 的組合。<b>Guice</b> 是一個輕量級的容器，設定上比起 <b>Spring</b> 更簡單，起動或注入速度亦比 <b>Spring</b> 快。而 <b>Jersey</b> 則是一個為 <b>RESTful web service</b> 而設的一個 <b>Framework</b>。<br /><br /><b>Gucie</b> 官方網址: <a href="http://code.google.com/p/google-guice/">http://code.google.com/p/google-guice/</a><br /><b>Jersey</b> 官方網址: <a href="http://jersey.java.net/">http://jersey.java.net/</a><br /><br />因為手上的電腦沒有安裝 <b>Application Server</b>，只好拿 <b>GAE</b> 的 <b>Development Server</b> 來測試。<br /><br />首先下載 <b>Guice</b> : <a href="http://code.google.com/p/google-guice/downloads/detail?name=guice-3.0.zip&can=2&q=">http://code.google.com/p/google-guice/downloads/detail?name=guice-3.0.zip&amp;can=2&amp;q=</a> (現時為止最新版本為 3.0)<br /><br />打開後將 <b>aopalliance.jar, guice-3.0.jar, guice-servlet-3.0.jar</b> 和 <b>javax.inject.jar</b> 加到 <b>WEB-INF/lib</b> 中並加到 <b>Class path</b>。<br /><br />然後下載 <b>Jersey</b> 所需的 <b>Jar</b> (現時為止最新版本為 1.9):<br /><ol><li><a href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&g=com.sun.jersey&a=jersey-server&v=1.9&e=jar">jersey-server.jar</a></li><li><a href="https://maven.java.net/service/local/artifact/maven/redirect?r=releases&g=com.sun.jersey&a=jersey-core&v=1.9&e=jar">jersey-core.jar</a></li><li><a href="http://repo1.maven.org/maven2/asm/asm/3.1/asm-3.1.jar">asm.jar</a></li><li><a href="http://download.java.net/maven/2/com/sun/jersey/contribs/jersey-guice/1.9-SNAPSHOT/jersey-guice-1.9-SNAPSHOT.jar">jersey-guice-1.9-SNAPSHOT.jar</a></li></ol><br />將以上的檔案一樣是放到 WEB-INF/lib 並加到 <b>Class path</b>。<br /><br />首先建立一個 <b>class</b>，每一次連接 <b>http://www.xyzdomainname.com</b> 都會顯示 <b>I am Index page</b>:<br /><pre class="brush: java">package com.ctlok.pro.controller;<br /><br />import javax.ws.rs.GET;<br />import javax.ws.rs.Path;<br />import javax.ws.rs.Produces;<br />import javax.ws.rs.core.MediaType;<br /><br />@Path(&quot;/&quot;)<br />public class CommonController {<br /><br />    @GET<br />    @Produces(MediaType.TEXT_PLAIN)<br />    public String index(){<br />        return &quot;I am Index page&quot;;<br />    }<br />    <br />}<br /></pre><br /><b>@Path</b> 是設定這個 <b>class</b> 會處理的 <b>URL</b>，可以放在 <b>Class</b> 或 <b>Method</b>。而 <b>Jersey</b> 會搜尋出在 <b>Class</b> 上有 <b>@Path</b> 的類別然後處理。<br /><b>@GET</b> 是設定這個 <b>Method</b> 處理那一種請求，一共有 5 種方式: <b>GET, POST, HEAD, PUT, DELETE</b>。<br /><b>@Produces</b> 則是回傳資料的類型，可以是 Text, XML, JSON, HTML 等等。<br /><br />然後再去建立一個 <b>Guice</b> 的 <b>Module class</b> 並設定 <b>Jersey</b>:<br /><pre class="brush:java">package com.ctlok.pro;<br /><br />import java.util.HashMap;<br />import java.util.Map;<br /><br />import com.ctlok.pro.controller.CommonController;<br />import com.google.inject.servlet.RequestScoped;<br />import com.google.inject.servlet.ServletModule;<br />import com.sun.jersey.guice.spi.container.servlet.GuiceContainer;<br /><br />public class WebModule extends ServletModule {<br /><br />    @Override<br />    protected void configureServlets(){<br />        bind(CommonController.class).in(RequestScoped.class);<br />        <br />        Map&lt;String, String&gt; parameters = new HashMap&lt;String, String&gt;(); <br />        parameters.put(&quot;com.sun.jersey.config.property.packages&quot;, &quot;com.ctlok.pro.controller&quot;);<br />        serve(&quot;/<em>&quot;).with(GuiceContainer.class, parameters);<br />    }<br />    <br />}<br /></pre><br />然後設定 <b>Guice</b> 起動時的注入器:<br /><pre class="brush: java">package com.ctlok.pro;<br /><br />import com.google.inject.Guice;<br />import com.google.inject.Injector;<br />import com.google.inject.servlet.GuiceServletContextListener;<br /><br />public class AppConfig extends GuiceServletContextListener{<br /><br />    @Override<br />    protected Injector getInjector() {<br />        return Guice.createInjector(new WebModule());<br />    }<br /><br />}<br /></pre><br />在 web.xml 設定好 <b>Guice Filter</b>和 <b>Listener</b>:<br /><pre class="brush: xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;<br />&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br />xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;<br />xmlns:web=&quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;<br />xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee<br />http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; version=&quot;2.5&quot;&gt;<br /> &lt;listener&gt;<br />  &lt;listener-class&gt;com.ctlok.pro.AppConfig&lt;/listener-class&gt;<br /> &lt;/listener&gt;<br /> &lt;filter&gt;<br />  &lt;filter-name&gt;guiceFilter&lt;/filter-name&gt;<br />  &lt;filter-class&gt;com.google.inject.servlet.GuiceFilter&lt;/filter-class&gt;<br /> &lt;/filter&gt;<br /> &lt;filter-mapping&gt;<br />  &lt;filter-name&gt;guiceFilter&lt;/filter-name&gt;<br />  &lt;url-pattern&gt;/</em>&lt;/url-pattern&gt;<br /> &lt;/filter-mapping&gt;<br />&lt;/web-app&gt;<br /></pre><br />打開 http://localhost:8888 後即可看到 "I am Index page".<br /><br />如要增加 URL，可以在 CommonController 加入:<br /><pre class="brush: java">@GET<br />@Path(&quot;user/{userId}/{userName}&quot;)<br />@Produces(MediaType.TEXT_PLAIN)<br />public String getUser(@PathParam(&quot;userId&quot;) String userId, @PathParam(&quot;userName&quot;) String userName){<br />    return &quot;User ID: &quot; + userId + &quot;, user name: &quot; + userName;<br />}<br /></pre><br />你可能有點疑問，<b>@Path</b> 在 Class 已經設家了，現在又有一個 <b>@Path</b> 在 <b>method</b> 上，那 Jersey 會怎麼決定。<br />其實 <b>Jersey</b> 會將 <b>class</b> 的 <b>@Path value</b> 加上 method 的 <b>@Path value</b>，即是 "/" + "user/{userId}/{userName}"。<br /><br />打開 http://localhost:8888/user/123/lawrence 顯示:User ID: 123, user name: lawrence<br /><br />其實 <b>Jersey</b> 的 <b>Method</b> 不一定返回 <b>String</b> 可以是一個 <b>Object</b> 或 <b>Jersey</b> 定義 的 <b>Response</b>。以下例字示範如何顯示一個 <b>JSP</b> 頁面，並由 <b>Controller</b> 將 <b>Model</b> 傳給 <b>View (JSP)</b>:<br /><br />先在 WEB-INF 新增一個 <b>views</b> 資料夾並新增一個 <b>example.jsp</b>，<b>JSP</b> 內容如下:<br /><pre class="brush: xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;<br />&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=utf-8&quot; pageEncoding=&quot;utf-8&quot;%&gt;<br />&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;<br />&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;<br />&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br /> &lt;head&gt;<br />  &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;<br />  &lt;title&gt;Guice + Jersey + JSP&lt;/title&gt;<br /> &lt;/head&gt;<br /> &lt;body&gt;<br />  &lt;c:out value=&quot;${it.msg}&quot; /&gt;<br /> &lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br />在 <b>Controller</b> 內也增加一個 <b>Method</b>:<br /><pre class="brush: java">@GET<br />@Path(&quot;jsp&quot;)<br />@Produces(MediaType.TEXT_HTML)<br />public Response getJsp(){<br />    Map&lt;String, Object&gt; model = new HashMap&lt;String, Object&gt;();<br />    model.put(&quot;msg&quot;, &quot;Hello World!&quot;);<br />    return Response.ok(new Viewable(&quot;/WEB-INF/views/example.jsp&quot;, model)).build();<br />}<br /></pre><br />打開 http://localhost:8888/jsp 顯示: Hello World!<br /><br />完整的 CommonController:<br /><pre class="brush: java">package com.ctlok.pro.controller;<br /><br />import java.util.HashMap;<br />import java.util.Map;<br /><br />import javax.ws.rs.GET;<br />import javax.ws.rs.Path;<br />import javax.ws.rs.PathParam;<br />import javax.ws.rs.Produces;<br />import javax.ws.rs.core.MediaType;<br />import javax.ws.rs.core.Response;<br /><br />import com.sun.jersey.api.view.Viewable;<br /><br />@Path(&quot;/&quot;)<br />public class CommonController {<br /><br />    @GET<br />    @Produces(MediaType.TEXT_PLAIN)<br />    public String index() {<br />        return &quot;I am Index page&quot;;<br />    }<br /><br />    @GET<br />    @Path(&quot;user/{userId}/{userName}&quot;)<br />    @Produces(MediaType.TEXT_PLAIN)<br />    public String getUser(@PathParam(&quot;userId&quot;) String userId,<br />            @PathParam(&quot;userName&quot;) String userName) {<br />        return &quot;User ID: &quot; + userId + &quot;, user name: &quot; + userName;<br />    }<br /><br />    @GET<br />    @Path(&quot;jsp&quot;)<br />    @Produces(MediaType.TEXT_HTML)<br />    public Response getJsp() {<br />        Map&lt;String, Object&gt; model = new HashMap&lt;String, Object&gt;();<br />        model.put(&quot;msg&quot;, &quot;Hello World!&quot;);<br />        return Response.ok(new Viewable(&quot;/WEB-INF/views/example.jsp&quot;, model))<br />                .build();<br />    }<br /><br />}<br /></pre><br />範例: <a href="https://sites.google.com/site/lawrencespace/lawpronotes/download/Guice-Jersey.zip?attredirects=0&d=1">Guice-Jersey.zip</a><br />密碼: <b>pro.ctlok.com</b>  相關書籍: <a imageanchor="1" target="_blank"  href="http://www.amazon.com/Dependency-Injection-Dhanji-R-Prasanna/dp/193398855X?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Dependency Injection" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=193398855X&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=193398855X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Google-Guice-Lightweight-Dependency-ebook/dp/B001BYBU80?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Google Guice: Agile Lightweight Dependency Injection Framework" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=B001BYBU80&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=B001BYBU80" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/RESTful-Java-Jax-RS-Animal-Guide/dp/0596158041?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="RESTful Java with Jax-RS (Animal Guide)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0596158041&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0596158041" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-4420115334139656989?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JSF + RichFaces 做成 Session Memory Leak]]></title>
    <link href="http://pro.ctlok.com/2011/06/jsf-richfaces-session-memory-leak.html"/>
    <updated>2011-06-24T11:34:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/06/jsf-richfaces-session-memory-leak</id>
    <content type="html"><![CDATA[<p>在公司有個項目是使用 <b>JSF</b> 作為 <b>View</b>，感覺十分差。<b>JSF</b> 給我的感覺: 運行慢，吃資源，限制又多。實在不太喜歡 <b>JSF</b>。<br /><br />在進行 <b>Street Test</b> 時，發覺 <b>Server</b> 上的 <b>Memory</b> 用得異常地多。經調查後發現 <b>RichFaces</b> 其中一個 <b>Object - AjaxStateHolder</b> 佔用大量 <b>Memory</b>。如果是使用 <b>3.2.0.SR1</b> 之前的版本更加嚴重，<b>Session</b> 隨時佔用 <b>1 Gigabytes</b> 的 <b>Memory</b>。<br /><br />解決方法就是在 <b>web.xml</b> 加入以下設定:<br /><pre class="brush: xml">&lt;context-param&gt;<br />    &lt;param-name&gt;com.sun.faces.numberOfViewsInSession&lt;/param-name&gt;<br />    &lt;param-value&gt;1&lt;/param-value&gt;<br />&lt;/context-param&gt;<br /><br />&lt;context-param&gt;<br />    &lt;param-name&gt;com.sun.faces.numberOfLogicalViews&lt;/param-name&gt;<br />    &lt;param-value&gt;1&lt;/param-value&gt;<br />&lt;/context-param&gt;<br /></pre><br />因為每運行一次 <b>JSF</b> 的 <b>View</b> 時都會將這個 <b>View</b> 放到 <b>Session</b> 內，而且同一個 <b>View</b> 亦會再儲存多一次在 <b>Session</b>，因為這些 <b>Session</b> 仍然在使用中，<b>JVM GC</b> 無法將不用的 <b>View</b> 回收，做成 <b>Memory</b> 使用量不斷增加。<br /><br />限制 <b>View</b> 數量後就可以解決這個問題。<br /><br />RichFaces bug: <a href="https://issues.jboss.org/browse/RF-3878">https://issues.jboss.org/browse/RF-3878</a><br /><br />相關書籍: <a imageanchor="1" target="_blank"  href="http://www.amazon.com/Core-JavaServer-Faces-David-Geary/dp/0137012896?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Core JavaServer Faces (3rd Edition)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0137012896&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0137012896" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/JavaServer-Faces-2-0-Complete-Reference/dp/0071625097?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="JavaServer Faces 2.0, The Complete Reference" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0071625097&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0071625097" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Beginning-JSP-JSF-Tomcat-Development/dp/1590599047?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Beginning JSP, JSF and Tomcat Web Development: From Novice to Professional" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=1590599047&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=1590599047" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-1311980917431620043?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java 使用 Top Down 和 JAX-WS 來部署 Web Service Provider]]></title>
    <link href="http://pro.ctlok.com/2011/06/top-down-jax-ws-web-service-provider.html"/>
    <updated>2011-06-23T17:38:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/06/top-down-jax-ws-web-service-provider</id>
    <content type="html"><![CDATA[<p>上一篇已經介紹過使用 <b>Bottom Up</b> 的方法來開發 <b>Web Service</b>: <a href="http://pro.ctlok.com/2011/06/java-bottom-up-jax-ws-web-service.html">Java 使用 Bottom Up 和 JAX-WS 來部署 Web Service</a>。今次當然是使用 <b>Top Down</b> 的方法，個人認為 <b>Top Down</b> 其實比 <b>Bottom Up</b> 方法更好，原因是自動產生出來的 <b>XML Schema</b> 和 <b>WSDL</b> 不太好。雖然是方便，但有很多細節地方不能自己操作到，所以我是比較喜歡 <b>Top Down</b> 的。<br /><br /><div style="clear: both;"></div><br />使用 <b>Top Down</b> 一定要懂 <b>XML Schema</b> 和 <b>Web Services Description Language</b>。<br /><br /><b>XML Schema</b>: <a href="http://www.w3schools.com/schema/default.asp">http://www.w3schools.com/schema/default.asp</a><br /><b>Web Services Description Language</b>: <a href="http://www.w3schools.com/WSDL/default.asp">http://www.w3schools.com/WSDL/default.asp</a><br /><br />這次的 <b>Web Service</b> 功能是客戶端 (<b>Web service client</b>) 送出一個 Employee Id list 到 服務器端 (<b>Web service provider</b>)。<br /><br />首先建立一個 <b>WAR project</b>，然後在 <b>web root</b> 目錄 加入 <b>company.xsd</b> 和 <b>company.wsdl</b>。<br /><br />以下是 <b>company.xsd</b>:<br /><pre class="brush: xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"<br />    targetNamespace="http://pro.ctlok.com/company" xmlns:tns="http://pro.ctlok.com/company"<br />    elementFormDefault="qualified"&gt;<br /><br />    &lt;xs:simpleType name="EmployeeId"&gt;<br />        &lt;xs:restriction base="xs:string"&gt;<br />            &lt;xs:length value="7" /&gt;<br />            &lt;xs:pattern value="E[0-9]{7}" /&gt;<br />        &lt;/xs:restriction&gt;<br />    &lt;/xs:simpleType&gt;<br /><br />    &lt;xs:simpleType name="EmployeeTitle"&gt;<br />        &lt;xs:restriction base="xs:string"&gt;<br />            &lt;xs:enumeration value="CEO" /&gt;<br />            &lt;xs:enumeration value="Manger" /&gt;<br />            &lt;xs:enumeration value="Supervisor" /&gt;<br />            &lt;xs:enumeration value="Clerk" /&gt;<br />        &lt;/xs:restriction&gt;<br />    &lt;/xs:simpleType&gt;<br /><br />    &lt;xs:complexType name="EmployeeInfo"&gt;<br />        &lt;xs:sequence&gt;<br />            &lt;xs:element name="eid" type="tns:EmployeeId"<br />                minOccurs="0" nillable="false" /&gt;<br />            &lt;xs:element name="firstName" type="xs:string"<br />                minOccurs="0" nillable="false" /&gt;<br />            &lt;xs:element name="lastName" type="xs:string"<br />                minOccurs="0" nillable="false" /&gt;<br />            &lt;xs:element name="age" type="xs:unsignedShort"<br />                minOccurs="0" nillable="false" /&gt;<br />            &lt;xs:element name="title" type="tns:EmployeeTitle"<br />                minOccurs="0" nillable="false" /&gt;<br />        &lt;/xs:sequence&gt;<br />    &lt;/xs:complexType&gt;<br /><br />    &lt;xs:complexType name="EmployeeInfoWrapper"&gt;<br />        &lt;xs:sequence&gt;<br />            &lt;xs:element name="employeeInfo" type="tns:EmployeeInfo"<br />                minOccurs="0" maxOccurs="unbounded" nillable="false" /&gt;<br />        &lt;/xs:sequence&gt;<br />    &lt;/xs:complexType&gt;<br /><br />    &lt;xs:complexType name="EmployeeIdWrapper"&gt;<br />        &lt;xs:sequence&gt;<br />            &lt;xs:element name="eid" type="tns:EmployeeId"<br />                minOccurs="0" maxOccurs="unbounded" nillable="false" /&gt;<br />        &lt;/xs:sequence&gt;<br />    &lt;/xs:complexType&gt;<br /><br />    &lt;xs:element name="EmployeeIdList" type="tns:EmployeeIdWrapper" /&gt;<br />    &lt;xs:element name="EmployeeInfoList" type="tns:EmployeeInfoWrapper" /&gt;<br /><br />&lt;/xs:schema&gt;<br /></pre><br />以下則是 <b>company.wsdl</b>:<br /><pre class="brush: xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;wsdl:definitions name="Company" targetNamespace="http://pro.ctlok.com/company"<br />    xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:tns="http://pro.ctlok.com/company"<br />    xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;<br />    <br />    &lt;wsdl:types&gt;<br />        &lt;xsd:schema&gt;<br />            &lt;xsd:import namespace="http://pro.ctlok.com/company"<br />                schemaLocation="company.xsd" /&gt;<br />        &lt;/xsd:schema&gt;<br />    &lt;/wsdl:types&gt;<br />    <br />    &lt;wsdl:message name="employeeLookupRequest"&gt;<br />        &lt;wsdl:part element="tns:EmployeeIdList" name="employeeIdList" /&gt;<br />    &lt;/wsdl:message&gt;<br />    <br />    &lt;wsdl:message name="employeeLookupResponse"&gt;<br />        &lt;wsdl:part element="tns:EmployeeInfoList" name="employeeInfoList" /&gt;<br />    &lt;/wsdl:message&gt;<br />    <br />    &lt;wsdl:portType name="employeeLookupService"&gt;<br />        &lt;wsdl:operation name="employeeLookup"&gt;<br />            &lt;wsdl:input message="tns:employeeLookupRequest" /&gt;<br />            &lt;wsdl:output message="tns:employeeLookupResponse" /&gt;<br />        &lt;/wsdl:operation&gt;<br />    &lt;/wsdl:portType&gt;<br />    <br />    &lt;wsdl:binding name="employeeLookupBinding" type="tns:employeeLookupService"&gt;<br />        &lt;soap:binding style="document"<br />            transport="http://schemas.xmlsoap.org/soap/http" /&gt;<br />        &lt;wsdl:operation name="employeeLookup"&gt;<br />            &lt;soap:operation<br />                soapAction="http://pro.ctlok.com/company/employeeLookup" /&gt;<br />            &lt;wsdl:input&gt;<br />                &lt;soap:body use="literal" /&gt;<br />            &lt;/wsdl:input&gt;<br />            &lt;wsdl:output&gt;<br />                &lt;soap:body use="literal" /&gt;<br />            &lt;/wsdl:output&gt;<br />        &lt;/wsdl:operation&gt;<br />    &lt;/wsdl:binding&gt;<br />    <br />    &lt;wsdl:service name="employeeLookupService"&gt;<br />        &lt;wsdl:port binding="tns:employeeLookupBinding" name="employeeLookupPort"&gt;<br />            &lt;soap:address location="http://localhost:9080/WebService" /&gt;<br />        &lt;/wsdl:port&gt;<br />    &lt;/wsdl:service&gt;<br />    <br />&lt;/wsdl:definitions&gt;<br /></pre><br />現在完成了 <b>Web Service</b> 的介面了，但要將 <b>Web Service</b> 的 <b>Object</b> 轉為 <b>Java Class</b> 才可以。幸好有工具可以替我們完成這項工作，不用一個一個手動建立。使用 <b>JAXB compiler</b> 幫我們將 <b>WSDL</b> 內用到的 <b>Object</b> 轉為 <b>Java Class</b>。在 <b>Windows</b> 打開 <b>CMD</b> 輸入以下指令:<br /><pre class="brush: bat">xjc -wsdl company.wsdl -p com.ctlok.pro.ws.model<br /></pre><br /><strong><em> 如果你不能執行 <b>xjc</b>，請查看 <b>System Path</b> 有沒有加入 <b>%JAVA_HOME%/bin</b> 。 </em></strong><br /><br /><ul><li><b>-wsdl</b> 是 <b>wsdl</b> 檔案存放的位置</li><li><b>-p</b> 是產生出來的 <b>Java class</b> 所在 <b>package</b></li></ul><br />想知更多指令可參考: <a href="http://download.oracle.com/docs/cd/E17802_01/webservices/webservices/docs/1.6/tutorial/doc/JAXBUsing2.html">JAXB Using</a><br /><br />執行指令後會看到有 6 個 .java 檔案，分別是:<br /><ol><li>EmployeeIdWrapper</li><li>EmployeeInfo</li><li>EmployeeInfoWrapper</li><li>EmployeeTitle</li><li>ObjectFactory</li><li>package-info</li></ol><br /><b>EmployeeIdWrapper:</b><br /><pre class="brush: java">//<br />// This file was generated by the JavaTM Architecture for XML Binding(JAXB) Reference Implementation, vJAXB 2.1.3 in JDK 1.6 <br />// See &lt;a href="http://java.sun.com/xml/jaxb"&gt;http://java.sun.com/xml/jaxb&lt;/a&gt; <br />// Any modifications to this file will be lost upon recompilation of the source schema. <br />// Generated on: 2011.06.23 at 04:28:35 PM CST <br />//<br /><br /><br />package com.ctlok.pro.ws.model;<br /><br />import java.util.ArrayList;<br />import java.util.List;<br />import javax.xml.bind.annotation.XmlAccessType;<br />import javax.xml.bind.annotation.XmlAccessorType;<br />import javax.xml.bind.annotation.XmlType;<br /><br /><br />/<strong><br /> * &lt;p&gt;Java class for EmployeeIdWrapper complex type.<br /> * <br /> * &lt;p&gt;The following schema fragment specifies the expected content contained within this class.<br /> * <br /> * &lt;pre&gt;<br /> * &amp;lt;complexType name="EmployeeIdWrapper"&gt;<br /> *   &amp;lt;complexContent&gt;<br /> *     &amp;lt;restriction base="{http://www.w3.org/2001/XMLSchema}anyType"&gt;<br /> *       &amp;lt;sequence&gt;<br /> *         &amp;lt;element name="eid" type="{http://pro.ctlok.com/company}EmployeeId" maxOccurs="unbounded" minOccurs="0"/&gt;<br /> *       &amp;lt;/sequence&gt;<br /> *     &amp;lt;/restriction&gt;<br /> *   &amp;lt;/complexContent&gt;<br /> * &amp;lt;/complexType&gt;<br /> * &lt;/pre&gt;<br /> * <br /> * <br /> */<br />@XmlAccessorType(XmlAccessType.FIELD)<br />@XmlType(name = "EmployeeIdWrapper", propOrder = {<br />    "eid"<br />})<br />public class EmployeeIdWrapper {<br /><br />    protected List&lt;String&gt; eid;<br /><br />    /</strong><br />     * Gets the value of the eid property.<br />     * <br />     * &lt;p&gt;<br />     * This accessor method returns a reference to the live list,<br />     * not a snapshot. Therefore any modification you make to the<br />     * returned list will be present inside the JAXB object.<br />     * This is why there is not a &lt;CODE&gt;set&lt;/CODE&gt; method for the eid property.<br />     * <br />     * &lt;p&gt;<br />     * For example, to add a new item, do as follows:<br />     * &lt;pre&gt;<br />     *    getEid().add(newItem);<br />     * &lt;/pre&gt;<br />     * <br />     * <br />     * &lt;p&gt;<br />     * Objects of the following type(s) are allowed in the list<br />     * {@link String }<br />     * <br />     * <br />     <em>/<br />    public List&lt;String&gt; getEid() {<br />        if (eid == null) {<br />            eid = new ArrayList&lt;String&gt;();<br />        }<br />        return this.eid;<br />    }<br /><br />}<br /></pre><br /><b>EmployeeInfo:</b><br /><pre class="brush: java">//<br />// This file was generated by the JavaTM Architecture for XML Binding(JAXB) Reference Implementation, vJAXB 2.1.3 in JDK 1.6 <br />// See &lt;a href="http://java.sun.com/xml/jaxb"&gt;http://java.sun.com/xml/jaxb&lt;/a&gt; <br />// Any modifications to this file will be lost upon recompilation of the source schema. <br />// Generated on: 2011.06.23 at 04:28:35 PM CST <br />//<br /><br /><br />package com.ctlok.pro.ws.model;<br /><br />import javax.xml.bind.annotation.XmlAccessType;<br />import javax.xml.bind.annotation.XmlAccessorType;<br />import javax.xml.bind.annotation.XmlSchemaType;<br />import javax.xml.bind.annotation.XmlType;<br /><br /><br />/**<br /> * &lt;p&gt;Java class for EmployeeInfo complex type.<br /> * <br /> * &lt;p&gt;The following schema fragment specifies the expected content contained within this class.<br /> * <br /> * &lt;pre&gt;<br /> * &amp;lt;complexType name="EmployeeInfo"&gt;<br /> *   &amp;lt;complexContent&gt;<br /> *     &amp;lt;restriction base="{http://www.w3.org/2001/XMLSchema}anyType"&gt;<br /> *       &amp;lt;sequence&gt;<br /> *         &amp;lt;element name="eid" type="{http://pro.ctlok.com/company}EmployeeId" minOccurs="0"/&gt;<br /> *         &amp;lt;element name="firstName" type="{http://www.w3.org/2001/XMLSchema}string" minOccurs="0"/&gt;<br /> *         &amp;lt;element name="lastName" type="{http://www.w3.org/2001/XMLSchema}string" minOccurs="0"/&gt;<br /> *         &amp;lt;element name="age" type="{http://www.w3.org/2001/XMLSchema}unsignedShort" minOccurs="0"/&gt;<br /> *         &amp;lt;element name="title" type="{http://pro.ctlok.com/company}EmployeeTitle" minOccurs="0"/&gt;<br /> *       &amp;lt;/sequence&gt;<br /> *     &amp;lt;/restriction&gt;<br /> *   &amp;lt;/complexContent&gt;<br /> * &amp;lt;/complexType&gt;<br /> * &lt;/pre&gt;<br /> * <br /> * <br /> </em>/<br />@XmlAccessorType(XmlAccessType.FIELD)<br />@XmlType(name = "EmployeeInfo", propOrder = {<br />    "eid",<br />    "firstName",<br />    "lastName",<br />    "age",<br />    "title"<br />})<br />public class EmployeeInfo {<br /><br />    protected String eid;<br />    protected String firstName;<br />    protected String lastName;<br />    @XmlSchemaType(name = "unsignedShort")<br />    protected Integer age;<br />    protected EmployeeTitle title;<br /><br />    /<strong><br />     * Gets the value of the eid property.<br />     * <br />     * @return<br />     *     possible object is<br />     *     {@link String }<br />     *     <br />     */<br />    public String getEid() {<br />        return eid;<br />    }<br /><br />    /</strong><br />     * Sets the value of the eid property.<br />     * <br />     * @param value<br />     *     allowed object is<br />     *     {@link String }<br />     *     <br />     <em>/<br />    public void setEid(String value) {<br />        this.eid = value;<br />    }<br /><br />    /**<br />     * Gets the value of the firstName property.<br />     * <br />     * @return<br />     *     possible object is<br />     *     {@link String }<br />     *     <br />     </em>/<br />    public String getFirstName() {<br />        return firstName;<br />    }<br /><br />    /<strong><br />     * Sets the value of the firstName property.<br />     * <br />     * @param value<br />     *     allowed object is<br />     *     {@link String }<br />     *     <br />     */<br />    public void setFirstName(String value) {<br />        this.firstName = value;<br />    }<br /><br />    /</strong><br />     * Gets the value of the lastName property.<br />     * <br />     * @return<br />     *     possible object is<br />     *     {@link String }<br />     *     <br />     <em>/<br />    public String getLastName() {<br />        return lastName;<br />    }<br /><br />    /**<br />     * Sets the value of the lastName property.<br />     * <br />     * @param value<br />     *     allowed object is<br />     *     {@link String }<br />     *     <br />     </em>/<br />    public void setLastName(String value) {<br />        this.lastName = value;<br />    }<br /><br />    /<strong><br />     * Gets the value of the age property.<br />     * <br />     * @return<br />     *     possible object is<br />     *     {@link Integer }<br />     *     <br />     */<br />    public Integer getAge() {<br />        return age;<br />    }<br /><br />    /</strong><br />     * Sets the value of the age property.<br />     * <br />     * @param value<br />     *     allowed object is<br />     *     {@link Integer }<br />     *     <br />     <em>/<br />    public void setAge(Integer value) {<br />        this.age = value;<br />    }<br /><br />    /**<br />     * Gets the value of the title property.<br />     * <br />     * @return<br />     *     possible object is<br />     *     {@link EmployeeTitle }<br />     *     <br />     </em>/<br />    public EmployeeTitle getTitle() {<br />        return title;<br />    }<br /><br />    /<strong><br />     * Sets the value of the title property.<br />     * <br />     * @param value<br />     *     allowed object is<br />     *     {@link EmployeeTitle }<br />     *     <br />     */<br />    public void setTitle(EmployeeTitle value) {<br />        this.title = value;<br />    }<br /><br />}<br /></pre><br /><b>EmployeeInfoWrapper:</b><br /><pre class="brush: java">//<br />// This file was generated by the JavaTM Architecture for XML Binding(JAXB) Reference Implementation, vJAXB 2.1.3 in JDK 1.6 <br />// See &lt;a href="http://java.sun.com/xml/jaxb"&gt;http://java.sun.com/xml/jaxb&lt;/a&gt; <br />// Any modifications to this file will be lost upon recompilation of the source schema. <br />// Generated on: 2011.06.23 at 04:28:35 PM CST <br />//<br /><br /><br />package com.ctlok.pro.ws.model;<br /><br />import java.util.ArrayList;<br />import java.util.List;<br />import javax.xml.bind.annotation.XmlAccessType;<br />import javax.xml.bind.annotation.XmlAccessorType;<br />import javax.xml.bind.annotation.XmlType;<br /><br /><br />/</strong><br /> * &lt;p&gt;Java class for EmployeeInfoWrapper complex type.<br /> * <br /> * &lt;p&gt;The following schema fragment specifies the expected content contained within this class.<br /> * <br /> * &lt;pre&gt;<br /> * &amp;lt;complexType name="EmployeeInfoWrapper"&gt;<br /> *   &amp;lt;complexContent&gt;<br /> *     &amp;lt;restriction base="{http://www.w3.org/2001/XMLSchema}anyType"&gt;<br /> *       &amp;lt;sequence&gt;<br /> *         &amp;lt;element name="employeeInfo" type="{http://pro.ctlok.com/company}EmployeeInfo" maxOccurs="unbounded" minOccurs="0"/&gt;<br /> *       &amp;lt;/sequence&gt;<br /> *     &amp;lt;/restriction&gt;<br /> *   &amp;lt;/complexContent&gt;<br /> * &amp;lt;/complexType&gt;<br /> * &lt;/pre&gt;<br /> * <br /> * <br /> <em>/<br />@XmlAccessorType(XmlAccessType.FIELD)<br />@XmlType(name = "EmployeeInfoWrapper", propOrder = {<br />    "employeeInfo"<br />})<br />public class EmployeeInfoWrapper {<br /><br />    protected List&lt;EmployeeInfo&gt; employeeInfo;<br /><br />    /**<br />     * Gets the value of the employeeInfo property.<br />     * <br />     * &lt;p&gt;<br />     * This accessor method returns a reference to the live list,<br />     * not a snapshot. Therefore any modification you make to the<br />     * returned list will be present inside the JAXB object.<br />     * This is why there is not a &lt;CODE&gt;set&lt;/CODE&gt; method for the employeeInfo property.<br />     * <br />     * &lt;p&gt;<br />     * For example, to add a new item, do as follows:<br />     * &lt;pre&gt;<br />     *    getEmployeeInfo().add(newItem);<br />     * &lt;/pre&gt;<br />     * <br />     * <br />     * &lt;p&gt;<br />     * Objects of the following type(s) are allowed in the list<br />     * {@link EmployeeInfo }<br />     * <br />     * <br />     </em>/<br />    public List&lt;EmployeeInfo&gt; getEmployeeInfo() {<br />        if (employeeInfo == null) {<br />            employeeInfo = new ArrayList&lt;EmployeeInfo&gt;();<br />        }<br />        return this.employeeInfo;<br />    }<br /><br />}<br /></pre><br /><b>EmployeeTitle:</b><br /><pre class="brush: java">//<br />// This file was generated by the JavaTM Architecture for XML Binding(JAXB) Reference Implementation, vJAXB 2.1.3 in JDK 1.6 <br />// See &lt;a href="http://java.sun.com/xml/jaxb"&gt;http://java.sun.com/xml/jaxb&lt;/a&gt; <br />// Any modifications to this file will be lost upon recompilation of the source schema. <br />// Generated on: 2011.06.23 at 04:28:35 PM CST <br />//<br /><br /><br />package com.ctlok.pro.ws.model;<br /><br />import javax.xml.bind.annotation.XmlEnum;<br />import javax.xml.bind.annotation.XmlEnumValue;<br />import javax.xml.bind.annotation.XmlType;<br /><br /><br />/<strong><br /> * &lt;p&gt;Java class for EmployeeTitle.<br /> * <br /> * &lt;p&gt;The following schema fragment specifies the expected content contained within this class.<br /> * &lt;p&gt;<br /> * &lt;pre&gt;<br /> * &amp;lt;simpleType name="EmployeeTitle"&gt;<br /> *   &amp;lt;restriction base="{http://www.w3.org/2001/XMLSchema}string"&gt;<br /> *     &amp;lt;enumeration value="CEO"/&gt;<br /> *     &amp;lt;enumeration value="Manger"/&gt;<br /> *     &amp;lt;enumeration value="Supervisor"/&gt;<br /> *     &amp;lt;enumeration value="Clerk"/&gt;<br /> *   &amp;lt;/restriction&gt;<br /> * &amp;lt;/simpleType&gt;<br /> * &lt;/pre&gt;<br /> * <br /> */<br />@XmlType(name = "EmployeeTitle")<br />@XmlEnum<br />public enum EmployeeTitle {<br /><br />    CEO("CEO"),<br />    @XmlEnumValue("Manger")<br />    MANGER("Manger"),<br />    @XmlEnumValue("Supervisor")<br />    SUPERVISOR("Supervisor"),<br />    @XmlEnumValue("Clerk")<br />    CLERK("Clerk");<br />    private final String value;<br /><br />    EmployeeTitle(String v) {<br />        value = v;<br />    }<br /><br />    public String value() {<br />        return value;<br />    }<br /><br />    public static EmployeeTitle fromValue(String v) {<br />        for (EmployeeTitle c: EmployeeTitle.values()) {<br />            if (c.value.equals(v)) {<br />                return c;<br />            }<br />        }<br />        throw new IllegalArgumentException(v);<br />    }<br /><br />}<br /></pre><br /><b>ObjectFactory:</b><br /><pre class="brush: java">//<br />// This file was generated by the JavaTM Architecture for XML Binding(JAXB) Reference Implementation, vJAXB 2.1.3 in JDK 1.6 <br />// See &lt;a href="http://java.sun.com/xml/jaxb"&gt;http://java.sun.com/xml/jaxb&lt;/a&gt; <br />// Any modifications to this file will be lost upon recompilation of the source schema. <br />// Generated on: 2011.06.23 at 04:28:35 PM CST <br />//<br /><br /><br />package com.ctlok.pro.ws.model;<br /><br />import javax.xml.bind.JAXBElement;<br />import javax.xml.bind.annotation.XmlElementDecl;<br />import javax.xml.bind.annotation.XmlRegistry;<br />import javax.xml.namespace.QName;<br /><br /><br />/</strong><br /> * This object contains factory methods for each <br /> * Java content interface and Java element interface <br /> * generated in the com.ctlok.pro.ws.model package. <br /> * &lt;p&gt;An ObjectFactory allows you to programatically <br /> * construct new instances of the Java representation <br /> * for XML content. The Java representation of XML <br /> * content can consist of schema derived interfaces <br /> * and classes representing the binding of schema <br /> * type definitions, element declarations and model <br /> * groups.  Factory methods for each of these are <br /> * provided in this class.<br /> * <br /> <em>/<br />@XmlRegistry<br />public class ObjectFactory {<br /><br />    private final static QName <em>EmployeeIdList_QNAME = new QName("http://pro.ctlok.com/company", "EmployeeIdList");<br />    private final static QName </em>EmployeeInfoList_QNAME = new QName("http://pro.ctlok.com/company", "EmployeeInfoList");<br /><br />    /**<br />     * Create a new ObjectFactory that can be used to create new instances of schema derived classes for package: com.ctlok.pro.ws.model<br />     * <br />     </em>/<br />    public ObjectFactory() {<br />    }<br /><br />    /<strong><br />     * Create an instance of {@link EmployeeIdWrapper }<br />     * <br />     */<br />    public EmployeeIdWrapper createEmployeeIdWrapper() {<br />        return new EmployeeIdWrapper();<br />    }<br /><br />    /</strong><br />     * Create an instance of {@link EmployeeInfoWrapper }<br />     * <br />     <em>/<br />    public EmployeeInfoWrapper createEmployeeInfoWrapper() {<br />        return new EmployeeInfoWrapper();<br />    }<br /><br />    /**<br />     * Create an instance of {@link EmployeeInfo }<br />     * <br />     </em>/<br />    public EmployeeInfo createEmployeeInfo() {<br />        return new EmployeeInfo();<br />    }<br /><br />    /<strong><br />     * Create an instance of {@link JAXBElement }{@code &lt;}{@link EmployeeIdWrapper }{@code &gt;}}<br />     * <br />     */<br />    @XmlElementDecl(namespace = "http://pro.ctlok.com/company", name = "EmployeeIdList")<br />    public JAXBElement&lt;EmployeeIdWrapper&gt; createEmployeeIdList(EmployeeIdWrapper value) {<br />        return new JAXBElement&lt;EmployeeIdWrapper&gt;(_EmployeeIdList_QNAME, EmployeeIdWrapper.class, null, value);<br />    }<br /><br />    /</strong><br />     * Create an instance of {@link JAXBElement }{@code &lt;}{@link EmployeeInfoWrapper }{@code &gt;}}<br />     * <br />     */<br />    @XmlElementDecl(namespace = "http://pro.ctlok.com/company", name = "EmployeeInfoList")<br />    public JAXBElement&lt;EmployeeInfoWrapper&gt; createEmployeeInfoList(EmployeeInfoWrapper value) {<br />        return new JAXBElement&lt;EmployeeInfoWrapper&gt;(_EmployeeInfoList_QNAME, EmployeeInfoWrapper.class, null, value);<br />    }<br /><br />}<br /></pre><br /><b>package-info:</b><br /><pre class="brush: java">//<br />// This file was generated by the JavaTM Architecture for XML Binding(JAXB) Reference Implementation, vJAXB 2.1.3 in JDK 1.6 <br />// See &lt;a href="http://java.sun.com/xml/jaxb"&gt;http://java.sun.com/xml/jaxb&lt;/a&gt; <br />// Any modifications to this file will be lost upon recompilation of the source schema. <br />// Generated on: 2011.06.23 at 04:28:35 PM CST <br />//<br /><br />@javax.xml.bind.annotation.XmlSchema(namespace = "http://pro.ctlok.com/company", elementFormDefault = javax.xml.bind.annotation.XmlNsForm.QUALIFIED)<br />package com.ctlok.pro.ws.model;<br /></pre><br />將這些 <b>Java Class</b> 複製到 <b>WAR project</b> 內。<br /><br />再建立一個 <b>Java Class - EmployeeLookupService:</b><br /><pre class="brush: java">package com.ctlok.pro.ws;<br /><br />import java.util.HashMap;<br />import java.util.Map;<br /><br />import javax.jws.WebMethod;<br />import javax.jws.WebParam;<br />import javax.jws.WebResult;<br />import javax.jws.WebService;<br />import javax.jws.soap.SOAPBinding;<br />import javax.xml.bind.annotation.XmlSeeAlso;<br /><br />import com.ctlok.pro.ws.model.EmployeeIdWrapper;<br />import com.ctlok.pro.ws.model.EmployeeInfo;<br />import com.ctlok.pro.ws.model.EmployeeInfoWrapper;<br />import com.ctlok.pro.ws.model.EmployeeTitle;<br />import com.ctlok.pro.ws.model.ObjectFactory;<br /><br />@WebService(<br />        name = "employeeLookupService", <br />        serviceName = "employeeLookupService", <br />        portName = "employeeLookupPort", <br />        targetNamespace= "http://pro.ctlok.com/company",<br />        wsdlLocation = "company.wsdl")<br />@SOAPBinding(parameterStyle = SOAPBinding.ParameterStyle.BARE)<br />@XmlSeeAlso({ObjectFactory.class})<br />public class EmployeeLookupService {<br />    <br />    private Map&lt;String, EmployeeInfo&gt; infoMap;<br />    <br />    public EmployeeLookupService(){<br />        infoMap = new HashMap&lt;String, EmployeeInfo&gt;();<br />        <br />        EmployeeInfo info1 = new EmployeeInfo();<br />        info1.setEid("E1000000");<br />        info1.setFirstName("Lawrence");<br />        info1.setLastName("Cheung");<br />        info1.setAge(24);<br />        info1.setTitle(EmployeeTitle.CEO);<br />        <br />        EmployeeInfo info2 = new EmployeeInfo();<br />        info2.setEid("E1524125");<br />        info2.setFirstName("Tom");<br />        info2.setLastName("Wong");<br />        info2.setAge(22);<br />        info2.setTitle(EmployeeTitle.CLERK);<br />        <br />        EmployeeInfo info3 = new EmployeeInfo();<br />        info3.setEid("E7452145");<br />        info3.setFirstName("John");<br />        info3.setLastName("Lee");<br />        info3.setAge(29);<br />        info3.setTitle(EmployeeTitle.MANGER);<br />        <br />        EmployeeInfo info4 = new EmployeeInfo();<br />        info4.setEid("E6523547");<br />        info4.setFirstName("Katty");<br />        info4.setLastName("Choi");<br />        info4.setAge(24);<br />        info4.setTitle(EmployeeTitle.SUPERVISOR);<br />        <br />        <br />        infoMap.put(info1.getEid(), info1);<br />        infoMap.put(info2.getEid(), info2);<br />        infoMap.put(info3.getEid(), info3);<br />        infoMap.put(info4.getEid(), info4);<br />    }<br /><br />    @WebMethod(operationName="employeeLookup")<br />    @WebResult(name = "EmployeeInfoList", partName = "employeeInfoList")<br />    public EmployeeInfoWrapper employeeLookup(<br />            @WebParam(name = "EmployeeIdList", partName = "employeeIdList") <br />            EmployeeIdWrapper employeeIdWrapper){<br />        <br />        EmployeeInfoWrapper employeeInfoWrapper = new EmployeeInfoWrapper();<br />        <br />        for (String eid: employeeIdWrapper.getEid()){<br />            EmployeeInfo info = infoMap.get(eid);<br />            <br />            if (info == null)<br />                info = new EmployeeInfo();<br />            <br />            employeeInfoWrapper.getEmployeeInfo().add(info);<br />        }<br />        <br />        return employeeInfoWrapper;<br />        <br />    }<br /><br />}<br /></pre><br />完成了 <b>Web Service Provider</b>。<br /><br /><pre class="brush: java">@SOAPBinding(parameterStyle = SOAPBinding.ParameterStyle.BARE)<br /></pre><br />以上這句注解很重要，預設是 <b>WRAPPED</b>，即是 <b>JAX-WS</b> 會替你自動包裝好 <b>List Object</b>，但我們在 <b>XML Schema</b> 已經設定了 <b>Wrapper</b>，所以不用設定為 <b>WRAPPED</b>。<br /><br />-------------- 分隔線 --------------<br /><br /><pre class="brush: java">@XmlSeeAlso({ObjectFactory.class})<br /></pre><br />以上的注解則是確保 <b>JAXB</b> 正常運作，由 <b>XML</b> 轉為 <b>Object</b> 或 <b>Object</b> 轉為 <b>XML</b>。<br /><br />-------------- 分隔線 --------------<br /><br /><pre class="brush: java">@WebResult(name = "EmployeeInfoList", partName = "employeeInfoList")<br /></pre><br />以上的注解對應 <b>WSDL</b> 內的:<br /><br /><pre class="brush: xml">&lt;wsdl:message name="employeeLookupRequest"&gt;<br />    &lt;wsdl:part element="tns:EmployeeIdList" name="employeeIdList" /&gt;<br />&lt;/wsdl:message&gt;<br /></pre><br />-------------- 分隔線 --------------<br /><br /><pre class="brush: java">@WebResult(name = "EmployeeInfoList", partName = "employeeInfoList")<br /></pre><br />以上的注解則對應 <b>WSDL</b> 內的:<br /><br /><pre class="brush: xml">&lt;wsdl:message name="employeeLookupResponse"&gt;<br />    &lt;wsdl:part element="tns:EmployeeInfoList" name="employeeInfoList" /&gt;<br />&lt;/wsdl:message&gt;<br /></pre><br /><br />現在將 <b>WAR project</b> 放上 <b>Application Server</b> 並運行 <b>http://localhost/employeeLookupService?wsdl</b>。如果發現找不到 <b>wsdl</b> 檔案即是 <b>wsdl</b> 放的位置不正確。<br /><br />成功找到後可以使用 soapUI 去測試一下，傳送以下 <b>SOAP XML</b> 到 <b>Server</b>:<br /><pre class="brush: xml">&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:com="http://pro.ctlok.com/company"&gt;<br />   &lt;soapenv:Header/&gt;<br />   &lt;soapenv:Body&gt;<br />      &lt;com:EmployeeIdList&gt;<br />         &lt;!--Zero or more repetitions:--&gt;<br />         &lt;com:eid&gt;E1000000&lt;/com:eid&gt;<br />         &lt;com:eid&gt;E1524125&lt;/com:eid&gt;<br />      &lt;/com:EmployeeIdList&gt;<br />   &lt;/soapenv:Body&gt;<br />&lt;/soapenv:Envelope&gt;<br /></pre><br /><b>Server</b> 回傳以下 <b>XML</b> 即代表成功設定:<br /><pre class="brush: xml">&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"&gt;<br />   &lt;soapenv:Body&gt;<br />      &lt;EmployeeInfoList xmlns="http://pro.ctlok.com/company"&gt;<br />         &lt;employeeInfo&gt;<br />            &lt;eid&gt;E1000000&lt;/eid&gt;<br />            &lt;firstName&gt;Lawrence&lt;/firstName&gt;<br />            &lt;lastName&gt;Cheung&lt;/lastName&gt;<br />            &lt;age&gt;24&lt;/age&gt;<br />            &lt;title&gt;CEO&lt;/title&gt;<br />         &lt;/employeeInfo&gt;<br />         &lt;employeeInfo&gt;<br />            &lt;eid&gt;E1524125&lt;/eid&gt;<br />            &lt;firstName&gt;Tom&lt;/firstName&gt;<br />            &lt;lastName&gt;Wong&lt;/lastName&gt;<br />            &lt;age&gt;22&lt;/age&gt;<br />            &lt;title&gt;Clerk&lt;/title&gt;<br />         &lt;/employeeInfo&gt;<br />      &lt;/EmployeeInfoList&gt;<br />   &lt;/soapenv:Body&gt;<br />&lt;/soapenv:Envelope&gt;<br /></pre><br />有時間再講解一下 <b>Java Web Service Client</b> 如何設定。<br /><br />相閞書籍: <a href="http://www.amazon.com/Java-Web-Services-Up-Running/dp/059652112X?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Java Web Services: Up and Running" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=059652112X&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=059652112X" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Java-Soa-Cookbook-Eben-Hewitt/dp/0596520727?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Java Soa Cookbook" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=0596520727&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=0596520727" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><a href="http://www.amazon.com/Java-Web-Services-Running-ebook/dp/B0026OR35I?ie=UTF8&amp;tag=program06-20&amp;link_code=bil&amp;camp=213689&amp;creative=392969" imageanchor="1" target="_blank"><img alt="Java Web Services: Up and Running" src="http://ws.amazon.com/widgets/q?MarketPlace=US&amp;ServiceVersion=20070822&amp;ID=AsinImage&amp;WS=1&amp;Format=_SL160_&amp;ASIN=B0026OR35I&amp;tag=program06-20" /></a><img alt="" border="0" height="1" src="http://www.assoc-amazon.com/e/ir?t=program06-20&amp;l=bil&amp;camp=213689&amp;creative=392969&amp;o=1&amp;a=B0026OR35I" style="border: none !important; margin: 0px !important; padding: 0px !important;" width="1" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-8108643057802063028?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java 使用 Bottom Up 和 JAX-WS 來部署 Web Service Provider]]></title>
    <link href="http://pro.ctlok.com/2011/06/java-bottom-up-jax-ws-web-service.html"/>
    <updated>2011-06-17T17:52:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/06/java-bottom-up-jax-ws-web-service</id>
    <content type="html"><![CDATA[<p>網路上關於 <b>Web Service</b> 的資訊不是很多，中文的 <b>Web Service</b> 資源更是少之有少，可能是因為部署 <b>Web Service</b> 是一件麻煩的事，而且性能又不是太好，但 <b>Web Service</b> 也有很多好處。不用同一種程式語言也可以互相交換數據，執行程序，有標準的格式，大多數語言都提供了 <b>Library</b> 去操作。<b>Web Service</b> 大多數用於對外的對像，例如: 銀行和銀行之間的數據交換亦可以通過 <b>Web Service</b> 做到。<br /><br />有 2 種主要的方式去設計一個 <b>Web Service</b>，就是 <b>Top Down</b> 和 <b>Bottom Up</b>，究竟有什麼分別呢?<br /><br /><b>Top Down</b> 是由定義 <b>Object</b> (物件) 和 <b>Interface</b> (介面) 做起的，<b>Object</b> (物件) 你可以想像為傳遞數據的一個容器，而這個物件是由 <b>XML Schema</b> <b>(XSD)</b> 去描述的。<b>Interface</b> (介面) 則是描述這個 <b>Web Service</b> 提供什麼服務，服務需要傳入一個什麼 <b>Object</b> (物件) 和 返回一個什麼 <b>Object</b> (物件)等等描述，這些都是由 <b>Web Services Description Language</b> <b>(WSDL)</b> 去描述的。做好這 2 項工作後就需要製作和 <b>XML Schema</b> 描述一樣的 <b>Object Class</b>，亦要製作和 <b>Web Services Description Language</b> 描述一樣的 <b>Functional Class</b>。最後當然要寫程式式碼和放上 <b>Application Server</b>。<br /><br /><b>Bottom Up</b> 就比較簡單了，是由 <b>Object Class</b> 和 <b>Functional Class</b> 先做起，做起後放上 <b>Application Server</b> 由 <b>Application Server</b> 自動產生出 <b>XML Schema</b> <b>(XSD)</b> 和 <b>Web Services Description Language</b> <b>(WSDL)</b>。不懂得 <b>XML Schema</b> 和 <b>Web Services Description Language</b> 也一樣可以製作出一個 <b>Web Service</b>。<br /><br />最好當然是對 <b>XML Schema</b> 和 <b>Web Services Description Language</b> 有一點認識。<br /><b>XML Schema</b>: <a href="http://www.w3schools.com/schema/default.asp">http://www.w3schools.com/schema/default.asp</a><br /><b>Web Services Description Language</b>: <br /><a href="http://www.w3schools.com/WSDL/default.asp">http://www.w3schools.com/WSDL/default.asp</a><br /><br />首先當然講解一下最簡單的 <b>Bottom Up</b> 方法，首先要在 <b>IDE</b> 建立一個 <b>WAR project</b>，加入一個 <b>Java Class</b>:<br /><pre class="brush: java">package sample.ws;<br /><br />import javax.jws.WebMethod;<br />import javax.jws.WebService;<br /><br />@WebService(<br />        name = &quot;CalculaterService&quot;, <br />        serviceName = &quot;CalculaterService&quot;, <br />        portName = &quot;CalculaterServicePort&quot;, <br />        targetNamespace = &quot;http://pro.ctlok.com/CalculaterService/&quot;)<br />public class CalculaterService {<br /><br />    @WebMethod<br />    public int add(int i, int k) {<br />        return i + k;<br />    }<br /><br />    @WebMethod<br />    public int subtract(int i, int k) {<br />        return i - k;<br />    }<br /><br />}<br /></pre><br />就這樣完成了一個最簡單的 <b>Web Service</b>。<br /><br /><pre class="brush: java">@WebService(<br />        name = &quot;CalculaterService&quot;, <br />        serviceName = &quot;CalculaterService&quot;, <br />        portName = &quot;CalculaterServicePort&quot;, <br />        targetNamespace = &quot;http://pro.ctlok.com/CalculaterService/&quot;)<br /></pre><br />用於通知 <b>Java EE</b> 容器識別這個 <b>Class</b> 是一個 <b>Web Service</b>。<br /><br /><ul><li><b>name</b>: 是在 <b>Application Server</b> 上的名稱</li><li><b>serviceName</b>: 是在 <b>URL</b> 和 <b>WSDL</b> 上顯示的名稱</li><li><b>portName</b>: 是在 <b>WSDL</b> 上顯示的名稱</li><li><b>targetNamespace </b>: 是在 <b>WSDL</b> 上顯示的命名空間，令 <b>XML</b> 內的名稱不會相同</li></ul><br /><pre class="brush: java">@WebMethod<br /></pre><br />是指定這個 <b>Method</b> 是 <b>Web Service</b> 的其中一個 <b>Function</b>。<br /><br /><b>CalculaterService</b> 亦可以是一個 <b>EJB Session Bean</b>:<br /><br /><pre class="brush: java">package sample.ws;<br /><br />@Local<br />public interface CalculaterService{<br /><br />    public int add(int i, int k);<br />    public int subtract(int i, int k);<br /><br />}<br /></pre><br /><pre class="brush: java">package sample.ws;<br /><br />import javax.jws.WebMethod;<br />import javax.jws.WebService;<br /><br />@Stateless<br />@WebService(<br />        name = &quot;CalculaterService&quot;, <br />        serviceName = &quot;CalculaterService&quot;, <br />        portName = &quot;CalculaterServicePort&quot;, <br />        targetNamespace = &quot;http://pro.ctlok.com/CalculaterService/&quot;)<br />public class CalculaterServiceBean implements CalculaterService{<br /><br />    @WebMethod<br />    public int add(int i, int k) {<br />        return i + k;<br />    }<br /><br />    @WebMethod<br />    public int subtract(int i, int k) {<br />        return i - k;<br />    }<br /><br />}<br /></pre><br />放上 Application Server 後使用瀏覽器開啟: <b>http://localhost/CalculaterService?wsdl</b> 會顯示出以下的 <b>WSDL</b><br /><pre class="brush: xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br />&lt;definitions name=&quot;CalculaterService&quot; targetNamespace=&quot;http://pro.ctlok.com/CalculaterService/&quot;<br />    xmlns=&quot;http://schemas.xmlsoap.org/wsdl/&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;<br />    xmlns:tns=&quot;http://pro.ctlok.com/CalculaterService/&quot; xmlns:soap=&quot;http://schemas.xmlsoap.org/wsdl/soap/&quot;&gt;<br /><br />    &lt;types&gt;<br />        &lt;xsd:schema&gt;<br />            &lt;xsd:import namespace=&quot;http://pro.ctlok.com/CalculaterService/&quot;<br />                schemaLocation=&quot;CalculaterService_schema1.xsd&quot; /&gt;<br />        &lt;/xsd:schema&gt;<br />    &lt;/types&gt;<br /><br />    &lt;message name=&quot;addResponse&quot;&gt;<br />        &lt;part name=&quot;parameters&quot; element=&quot;tns:addResponse&quot;&gt;<br />        &lt;/part&gt;<br />    &lt;/message&gt;<br /><br />    &lt;message name=&quot;add&quot;&gt;<br />        &lt;part name=&quot;parameters&quot; element=&quot;tns:add&quot;&gt;<br />        &lt;/part&gt;<br />    &lt;/message&gt;<br /><br />    &lt;message name=&quot;subtractResponse&quot;&gt;<br />        &lt;part name=&quot;parameters&quot; element=&quot;tns:subtractResponse&quot;&gt;<br />        &lt;/part&gt;<br />    &lt;/message&gt;<br /><br />    &lt;message name=&quot;subtract&quot;&gt;<br />        &lt;part name=&quot;parameters&quot; element=&quot;tns:subtract&quot;&gt;<br />        &lt;/part&gt;<br />    &lt;/message&gt;<br /><br />    &lt;portType name=&quot;CalculaterService&quot;&gt;<br />        &lt;operation name=&quot;add&quot;&gt;<br />            &lt;input message=&quot;tns:add&quot;&gt;<br />            &lt;/input&gt;<br />            &lt;output message=&quot;tns:addResponse&quot;&gt;<br />            &lt;/output&gt;<br />        &lt;/operation&gt;<br /><br />        &lt;operation name=&quot;subtract&quot;&gt;<br />            &lt;input message=&quot;tns:subtract&quot;&gt;<br />            &lt;/input&gt;<br />            &lt;output message=&quot;tns:subtractResponse&quot;&gt;<br />            &lt;/output&gt;<br />        &lt;/operation&gt;<br />    &lt;/portType&gt;<br /><br />    &lt;binding name=&quot;CalculaterServicePortBinding&quot; type=&quot;tns:CalculaterService&quot;&gt;<br />        &lt;soap:binding style=&quot;document&quot;<br />            transport=&quot;http://schemas.xmlsoap.org/soap/http&quot; /&gt;<br />        &lt;operation name=&quot;add&quot;&gt;<br />            &lt;soap:operation soapAction=&quot;&quot; /&gt;<br />            &lt;input&gt;<br />                &lt;soap:body use=&quot;literal&quot; /&gt;<br />            &lt;/input&gt;<br />            &lt;output&gt;<br />                &lt;soap:body use=&quot;literal&quot; /&gt;<br />            &lt;/output&gt;<br />        &lt;/operation&gt;<br />        &lt;operation name=&quot;subtract&quot;&gt;<br />            &lt;soap:operation soapAction=&quot;&quot; /&gt;<br />            &lt;input&gt;<br />                &lt;soap:body use=&quot;literal&quot; /&gt;<br />            &lt;/input&gt;<br />            &lt;output&gt;<br />                &lt;soap:body use=&quot;literal&quot; /&gt;<br />            &lt;/output&gt;<br />        &lt;/operation&gt;<br />    &lt;/binding&gt;<br /><br />    &lt;service name=&quot;CalculaterService&quot;&gt;<br />        &lt;port name=&quot;CalculaterServicePort&quot; binding=&quot;tns:CalculaterServicePortBinding&quot;&gt;<br />            &lt;soap:address<br />                location=&quot;http://localhost/CalculaterService&quot; /&gt;<br />        &lt;/port&gt;<br />    &lt;/service&gt;<br />&lt;/definitions&gt;<br /></pre><br /><b>Application Server</b> 除了自動產生出 <b>WSDL</b> 外，亦會產生出 <b>XML Schema</b>。<br /><br />使用瀏覽器開啟: <b>http://localhost/CalculaterService/CalculaterService_schema1.xsd</b> 會顯示出以下的 <b>XML Schema</b>:<br /><pre class="brush: xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;<br />&lt;xs:schema xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;<br />    xmlns:tns=&quot;http://pro.ctlok.com/CalculaterService/&quot; version=&quot;1.0&quot;<br />    targetNamespace=&quot;http://pro.ctlok.com/CalculaterService/&quot;&gt;<br /><br />    &lt;xs:element name=&quot;add&quot; type=&quot;tns:add&quot;&gt;&lt;/xs:element&gt;<br />    &lt;xs:element name=&quot;addResponse&quot; type=&quot;tns:addResponse&quot;&gt;&lt;/xs:element&gt;<br />    &lt;xs:element name=&quot;subtract&quot; type=&quot;tns:subtract&quot;&gt;&lt;/xs:element&gt;<br />    &lt;xs:element name=&quot;subtractResponse&quot; type=&quot;tns:subtractResponse&quot;&gt;&lt;/xs:element&gt;<br /><br />    &lt;xs:complexType name=&quot;add&quot;&gt;<br />        &lt;xs:sequence&gt;<br />            &lt;xs:element name=&quot;arg0&quot; type=&quot;xs:int&quot;&gt;&lt;/xs:element&gt;<br />            &lt;xs:element name=&quot;arg1&quot; type=&quot;xs:int&quot;&gt;&lt;/xs:element&gt;<br />        &lt;/xs:sequence&gt;<br />    &lt;/xs:complexType&gt;<br /><br />    &lt;xs:complexType name=&quot;addResponse&quot;&gt;<br />        &lt;xs:sequence&gt;<br />            &lt;xs:element name=&quot;return&quot; type=&quot;xs:int&quot;&gt;&lt;/xs:element&gt;<br />        &lt;/xs:sequence&gt;<br />    &lt;/xs:complexType&gt;<br /><br />    &lt;xs:complexType name=&quot;subtract&quot;&gt;<br />        &lt;xs:sequence&gt;<br />            &lt;xs:element name=&quot;arg0&quot; type=&quot;xs:int&quot;&gt;&lt;/xs:element&gt;<br />            &lt;xs:element name=&quot;arg1&quot; type=&quot;xs:int&quot;&gt;&lt;/xs:element&gt;<br />        &lt;/xs:sequence&gt;<br />    &lt;/xs:complexType&gt;<br /><br />    &lt;xs:complexType name=&quot;subtractResponse&quot;&gt;<br />        &lt;xs:sequence&gt;<br />            &lt;xs:element name=&quot;return&quot; type=&quot;xs:int&quot;&gt;&lt;/xs:element&gt;<br />        &lt;/xs:sequence&gt;<br />    &lt;/xs:complexType&gt;<br />&lt;/xs:schema&gt;<br /></pre><br />看到這是資料即是成功部署到 <b>Web Service</b>，接下來使用 <a href="http://www.soapui.org/">soapUI</a> 來模擬 <b>Web Service Client</b>。<br /><br /><b>soapUI</b> 下載地址: <a href="http://sourceforge.net/projects/soapui/files/">http://sourceforge.net/projects/soapui/files/</a><br /><br />請選擇安裝程式去下載，完成安裝後打開 <b>soapUI</b>:<br /><ol><li><b>File</b> -> <b>New soapUI Project</b></li><li>在 <b>Project name</b> 輸入 <b>localhost</b> 後按 <b>OK</b></li><li>在 <b>Project</b> 上按滑鼠加鍵 -> <b>Add WSDL</b></li><li>在 <b>WSDL Location</b> 輸入 <b>http://localhost/CalculaterService/CalculaterService.wsdl</b></li></ol><br />現在應該看得到 2 個 Method 名稱，分別為 <b>add</b> 和 <b>subtract</b>。<br />打開 <b>add</b> 的 <b>Request 1</b> 左邊顯示以下資料:<br /><pre class="brush: xml">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;<br />    xmlns:ws=&quot;http://pro.ctlok.com/CalculaterService/&quot;&gt;<br />    &lt;soapenv:Header /&gt;<br />    &lt;soapenv:Body&gt;<br />        &lt;ws:add&gt;<br />            &lt;arg0&gt;?&lt;/arg0&gt;<br />            &lt;arg1&gt;?&lt;/arg1&gt;<br />        &lt;/ws:add&gt;<br />    &lt;/soapenv:Body&gt;<br />&lt;/soapenv:Envelope&gt;<br /></pre><br />改為:<br /><pre class="brush: xml">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;<br />    xmlns:ws=&quot;http://pro.ctlok.com/CalculaterService/&quot;&gt;<br />    &lt;soapenv:Header /&gt;<br />    &lt;soapenv:Body&gt;<br />        &lt;ws:add&gt;<br />            &lt;arg0&gt;1&lt;/arg0&gt;<br />            &lt;arg1&gt;2&lt;/arg1&gt;<br />        &lt;/ws:add&gt;<br />    &lt;/soapenv:Body&gt;<br />&lt;/soapenv:Envelope&gt;<br /></pre><br />然後傳送出去，右邊會顯示出以下 <b>XML</b> 即代表成功:<br /><pre class="brush: xml">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;<br />    &lt;soapenv:Body&gt;<br />        &lt;dlwmin:addResponse xmlns:dlwmin=&quot;http://pro.ctlok.com/CalculaterService/&quot;&gt;<br />            &lt;return&gt;3&lt;/return&gt;<br />        &lt;/dlwmin:addResponse&gt;<br />    &lt;/soapenv:Body&gt;<br />&lt;/soapenv:Envelope&gt;<br /></pre><br />其實在 <b>Web Service</b> 的 <b>Function</b> 不一定要傳入或返回基本型態 (short, int, long, float, double, char, byte, boolean)，可以傳入或返回 <b>Object</b> (物件)，例如:<br /><br /><b>Object Class</b>:<br /><pre class="brush: java">package sample.ws;<br /><br />public class Info{<br /><br />    private String firstName;<br />    private String lastName;<br /><br />    public String getFirstName(){<br />        return firstName;<br />    }<br /><br />    public String getLastName(){<br />        return lastName;<br />    }<br /><br />    public void setFirstName(String firstName){<br />        this.firstName = firstName;<br />    }<br /><br />    public void setLastName(String lastName){<br />        this.lastName = lastName;<br />    }<br /><br />}<br /></pre><br /><b>Web Service</b>:<br /><pre class="brush: java">@WebMethod<br />public String sayHello(Info info) {<br />    return &quot;Hello! &quot; + info.getFirstName() <br />            + &quot; &quot; + info.getLastName();<br />}<br /><br />@WebMethod<br />public Info getInfo(int id){<br />    return findInfo(id);<br />}<br /></pre><br />有時間會再講解 <b>Top Down</b> 的做法。<br /><br />相關書籍: <a imageanchor="1" target="_blank"  href="http://www.amazon.com/Java-Web-Services-Up-Running/dp/059652112X?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Java Web Services: Up and Running" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=059652112X&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=059652112X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Java-Soa-Cookbook-Eben-Hewitt/dp/0596520727?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Java Soa Cookbook" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0596520727&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0596520727" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Building-Web-Services-Java-Making/dp/0672326418?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Building Web Services with Java: Making Sense of XML, SOAP, WSDL, and UDDI (2nd Edition)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0672326418&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0672326418" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-3470714314351219743?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Seam 2 in Websphere 7 EJB JNDI Setting]]></title>
    <link href="http://pro.ctlok.com/2011/06/seam-2-in-websphere-7-ejb-jndi-setting.html"/>
    <updated>2011-06-14T10:44:00+08:00</updated>
    <id>http://pro.ctlok.com/2011/06/seam-2-in-websphere-7-ejb-jndi-setting</id>
    <content type="html"><![CDATA[<p><b>Seam</b> 在 <b>JBoss Application Server</b> 上將 <b>EJB session bean</b> 設為 <b>Seam Component</b> 根本不需要特地去設定 <b>JNDI</b>，<b>Seam</b> 自然地找到相對應的 <b>Session bean</b>。<br /><br />但在 <b>Websphere 7 Application Server</b> 上就不是這回事了，需要自行設定 <b>JNDI</b> 讓 <b>Seam</b> 找得到 (將 <b>EJB session bean</b> 設為 <b>Seam Component</b> 才需要更改 <b>JNDI</b>，純 <b>EJB session bean</b> 不需要作出任何更改)<br /><br />這篇文章只使用我認為最好的方法。<br /><br />首先到 <b>web.xml</b> 加上以下設定:<br /><br /><pre class="brush: xml">&lt;ejb-local-ref&gt;<br />    &lt;ejb-ref-name&gt;ejblocal:EjbSynchronizations&lt;/ejb-ref-name&gt;<br />    &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;<br />    &lt;local-home&gt;&lt;/local-home&gt;<br />    &lt;local&gt;org.jboss.seam.transaction.LocalEjbSynchronizations&lt;/local&gt;<br />&lt;/ejb-local-ref&gt;<br /></pre><br />然後在 <b>WEB-INF/classes</b> 加入一個 <b>seam-jndi.prpperties</b>:<br /><pre class="brush: text">com.ibm.websphere.naming.hostname.normalizer=com.ibm.ws.naming.util.DefaultHostnameNormalizer<br />java.naming.factory.initial=com.ibm.websphere.naming.WsnInitialContextFactory<br />com.ibm.websphere.naming.name.syntax=jndi<br />com.ibm.websphere.naming.namespace.connection=lazy<br />com.ibm.ws.naming.ldap.ldapinitctxfactory=com.sun.jndi.ldap.LdapCtxFactory<br />com.ibm.websphere.naming.jndicache.cacheobject=populated<br />com.ibm.websphere.naming.namespaceroot=defaultroot<br />com.ibm.ws.naming.wsn.factory.initial=com.ibm.ws.naming.util.WsnInitCtxFactory<br />com.ibm.websphere.naming.jndicache.maxcachelife=0<br />com.ibm.websphere.naming.jndicache.maxentrylife=0<br />com.ibm.websphere.naming.jndicache.cachename=providerURL<br />java.naming.provider.url=corbaloc:rir:/NameServiceServerRoot<br />java.naming.factory.url.pkgs=com.ibm.ws.runtime\:com.ibm.ws.naming<br /></pre><br />再將 <b>WEB-INF/components.xml</b> 內的 <b>jndi-pattern</b> 更改為:<br /><pre class="brush: xml">&lt;core:init <br />    jndi-pattern=&quot;ejblocal:#{ejbName}&quot; <br />    debug=&quot;false&quot; /&gt;<br /></pre><br />最後就是設定 <b>Websphere</b> 的 <b>EJB session bean JNDI</b>，在 <b>EJB Project</b> 內的 <b>META-INF</b> 加入 <b>ibm-ejb-jar-bnd.xml</b>:<br /><pre class="brush: xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br />&lt;ejb-jar-bnd xmlns=&quot;http://websphere.ibm.com/xml/ns/javaee&quot;<br />    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br />    xsi:schemaLocation=&quot;http://websphere.ibm.com/xml/ns/javaee <br />                      http://websphere.ibm.com/xml/ns/javaee/ibm-ejb-jar-bnd_1_0.xsd&quot;<br />    version=&quot;1.0&quot;&gt;<br /><br />    &lt;session name=&quot;MyBean&quot; simple-binding-name=&quot;MyBean&quot; /&gt;<br /><br />&lt;/ejb-jar-bnd&gt;<br /></pre><br /><b>simple-binding-name</b> 就是 <b>JNDI</b>，這樣 <b>Seam</b> 會照著 <b>components.xml</b> 內的 <b>jndi-pattern</b> 去使用以下的 <b>JNDI</b> 找到 <b>EJB session bean</b>:<br /><pre class="brush: text">ejblocal:MyBean<br /></pre><br />如果 <b>components.xml</b> 內的 <b>jndi-pattern</b> 改變了，亦要去更改 <b>simple-binding-name</b>。<br />例如:<br /><pre class="brush: xml">&lt;core:init <br />    jndi-pattern=&quot;ejblocal:myModule/#{ejbName}&quot; <br />    debug=&quot;false&quot; /&gt;<br /></pre><br /><b>simple-binding-name</b> 亦要更改為:<br /><pre class="brush: xml">&lt;session name=&quot;MyBean&quot; <br />    simple-binding-name=&quot;MyModule/myBean&quot; /&gt;<br /></pre><br />相關書籍: <a imageanchor="1" target="_blank"  href="http://www.amazon.com/Seam-Action-Dan-Allen/dp/1933988401?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Seam in Action" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=1933988401&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=1933988401" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/Seam-Framework-Experience-Evolution-Java/dp/0137129394?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Seam Framework: Experience the Evolution of Java EE (2nd Edition)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=0137129394&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=0137129394" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><a imageanchor="1" target="_blank"  href="http://www.amazon.com/WebSphere-Application-Server-Internals-Professionals/dp/1430219580?ie=UTF8&tag=program06-20&link_code=bil&camp=213689&creative=392969"><img alt="Pro IBM WebSphere Application Server 7 Internals (Books for Professionals by Professionals)" src="http://ws.amazon.com/widgets/q?MarketPlace=US&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL160_&ASIN=1430219580&tag=program06-20" /></a><img src="http://www.assoc-amazon.com/e/ir?t=program06-20&l=bil&camp=213689&creative=392969&o=1&a=1430219580" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; padding: 0px !important" /><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/5998578522192555089-7344194767850097008?l=lawpronotes.blogspot.com' alt='' /></div></p>
]]></content>
  </entry>
  
</feed>
